<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="From Spring Boot Bean Validation to Python Wrapper" /><meta name="author" content="MijazzChan" /><meta property="og:locale" content="en" /><meta name="description" content="Keywords in this post are as follows." /><meta property="og:description" content="Keywords in this post are as follows." /><link rel="canonical" href="https://mijazzchan.github.io/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/" /><meta property="og:url" content="https://mijazzchan.github.io/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/" /><meta property="og:site_name" content="Mijazz Chan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-03T12:59:54+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="From Spring Boot Bean Validation to Python Wrapper" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@MijazzChan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"MijazzChan"},"headline":"From Spring Boot Bean Validation to Python Wrapper","dateModified":"2022-01-11T07:45:22+08:00","datePublished":"2021-06-03T12:59:54+08:00","description":"Keywords in this post are as follows.","url":"https://mijazzchan.github.io/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/","mainEntityOfPage":{"@type":"WebPage","@id":"https://mijazzchan.github.io/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>From Spring Boot Bean Validation to Python Wrapper | Mijazz Chan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mijazz Chan"><meta name="application-name" content="Mijazz Chan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatars/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mijazz Chan</a></div><div class="site-subtitle font-italic">Code with Passion</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/MijazzChan" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/%E9%99%88%E6%B5%A9%E9%AA%8F-mijazz/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mijazz','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>From Spring Boot Bean Validation to Python Wrapper</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>From Spring Boot Bean Validation to Python Wrapper</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/MijazzChan">Mijazz Chan</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2021-06-03 12:59:54 +0800" data-toggle="tooltip" data-placement="bottom" title="Thu, Jun 3, 2021, 12:59 PM +0800" >Jun 3, 2021</em> </span> <span> Updated <em class="timeago" date="2022-01-11 07:45:22 +0800 " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 11, 2022, 7:45 AM +0800" >Jan 11</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1865 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>Keywords in this post are as follows.</p><ul><li>Spring Boot Bean Validation<li><code class="language-plaintext highlighter-rouge">JSR-303/349/380</code>: Bean Validation Related Topic JSR<li>Java Annotation Processing<li>Custom Annotation<li>Java <code class="language-plaintext highlighter-rouge">Reflection</code> API (<code class="language-plaintext highlighter-rouge">java.lang.reflect</code>)<li>Python Function Wrapper</ul><p>Prerequisite.</p><ul><li>Basic Spring Boot 2 knowledge(IoC)</ul><h2 id="bean-validation-scenario">Bean Validation Scenario<a href="#bean-validation-scenario" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="spring-boot-code-example">Spring boot code example<a href="#spring-boot-code-example" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>If you have encountered with Java Bean Validation or Field Validation, then you may be familiar with the following pattern.</p><p><code class="language-plaintext highlighter-rouge">pom.xml(Maven3)</code></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-validation<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></table></code></div></div><p>This is our Controller’s incoming query payload class. (Query Object)</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// Lombok enabled.</span>
<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyQueryObject</span><span class="o">{</span>
    <span class="nd">@Min</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="nd">@Max</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">queryNumberInstance</span><span class="o">;</span>

    <span class="nd">@Pattern</span><span class="o">(</span><span class="n">regexp</span> <span class="o">=</span> <span class="s">"^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">hexColorValue</span><span class="o">;</span>

    <span class="c1">// getter, setter, ... handled by Lombok.</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Now the controller itself.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyControllerDemo</span><span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/some/path"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="s">"application/json"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">someQuery</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nd">@RequestBody</span> <span class="nc">MyQueryObject</span> <span class="n">queryObj</span><span class="o">){</span>
        <span class="c1">// ...</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">(</span><span class="s">"Here u go."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>If the query object itself fails the validation check, a <code class="language-plaintext highlighter-rouge">MethodArgumentNotValidException</code> will be generated, and by default, <code class="language-plaintext highlighter-rouge">spring</code> will translate that exception into <code class="language-plaintext highlighter-rouge">HTTP STATUS - 400(BAD REQUEST)</code>.</p><h3 id="spring-boot-test-example">Spring boot test example<a href="#spring-boot-test-example" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Provided by <code class="language-plaintext highlighter-rouge">spring-test</code> itself, <code class="language-plaintext highlighter-rouge">MockMvc</code> can be instanized to perform mock POST request easily. Let’s write up a simple spring boot test, shall we?</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="nd">@SpringBootTest</span>
<span class="nd">@AutoConfigureMockMvc</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QueryObjectValidationTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">passValidQueryObject_to_MyControllerDemo</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">MediaType</span> <span class="n">mediaType</span> <span class="o">=</span> <span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">;</span>

        <span class="c1">// This payload will not cause any exception.</span>
        <span class="nc">String</span> <span class="n">validPayload</span> <span class="o">=</span> <span class="s">"{\"queryNumberInstance\": 69, \"hexColorValue\" : \"#282a36\"}"</span><span class="o">;</span>
        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="nc">MockMvcRequestBuilders</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/some/path"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">validPayload</span><span class="o">)</span>
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">mediaType</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="nc">MockMvcResultMatchers</span><span class="o">.</span><span class="na">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="nc">MockMvcResultMatchers</span><span class="o">.</span><span class="na">content</span><span class="o">().</span><span class="na">contentType</span><span class="o">(</span><span class="n">mediaType</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">mvcResult</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">mvcResult</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getContentAsString</span><span class="o">()));</span>

        <span class="c1">// This payload will definitely trigger exception,</span>
        <span class="c1">// and spring will handle it with BAD_REQUEST.</span>
        <span class="nc">String</span> <span class="n">invalidPayload</span> <span class="o">=</span> <span class="s">"{\"queryNumberInstance\": 96, \"hexColorValue\" : \"#Z10RYP\"}"</span><span class="o">;</span>
        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="nc">MockMvcRequestBuilders</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/some/path"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">invalidPayload</span><span class="o">)</span>
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">mediaType</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="nc">MockMvcResultMatchers</span><span class="o">.</span><span class="na">status</span><span class="o">().</span><span class="na">isBadRequest</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">mvcResult</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">mvcResult</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getStatus</span><span class="o">()))));</span>
    <span class="o">}</span>
</pre></table></code></div></div><blockquote><p>Test provided above passed without exception.</p></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>2021-06-03 15:35:56.324  INFO 15821 --- [           main] i.m.t.QueryObjectValidationTest : Here u go.
2021-06-03 15:35:56.344  WARN 15821 --- [           main] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.web.bind.MethodArgumentNotValidException: Validation failed for argument [0] in public org.springframework.http.ResponseEntity&lt;java.lang.String&gt; icu.mijazz.temporaryspringbootdemo.controller.Demo2Controller.someQuery(icu.mijazz.temporaryspringbootdemo.qo.MyQueryObject): [Field error in object 'myQueryObject' on field 'hexColorValue': rejected value [#Z10RYP]; codes [Pattern.myQueryObject.hexColorValue,Pattern.hexColorValue,Pattern.java.lang.String,Pattern]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [myQueryObject.hexColorValue,hexColorValue]; arguments []; default message [hexColorValue],[Ljavax.validation.constraints.Pattern$Flag;@7ac058a0,^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$]; default message [must match "^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$"]] ]
2021-06-03 15:35:56.347  INFO 15821 --- [           main] i.m.t.QueryObjectValidationTest  : 400 BAD_REQUEST
</pre></table></code></div></div><h3 id="exception-handlingadditional">Exception Handling(Additional)<a href="#exception-handlingadditional" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>A digression into irrelevant details.</p></blockquote><p><code class="language-plaintext highlighter-rouge">@ExceptionHandler</code> annotation</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="nc">MethodArgumentNotValidException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">invalidQueryHandler</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Do Whatever.</span>
    <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">I_AM_A_TEAPOT</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="s">"Handled."</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="other-scenario">Other Scenario<a href="#other-scenario" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>You may also find it common for developers to have validation-annotation in Persistence Layer Entity. By default, <code class="language-plaintext highlighter-rouge">Spring Data</code> uses <code class="language-plaintext highlighter-rouge">Hibernate</code> underneath, which supports Bean Validation. However, Validations done in persistence layer act only as a anti data-corruption method. They can effectively stop invalid data from being written to DB, yet have little effect on the protection of parameter Injection based attack.</p><h2 id="custom-validator">Custom Validator<a href="#custom-validator" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>**You may wonder why I wrote a complete example just to illustrate how the spring boot validator’ s approach on parameter validation. **</p><p><strong>Because besides that, spring boot also offers a approach to customize and realize your data validator just by minor implementation.</strong></p><h3 id="construct-a-custom-annotation">Construct a Custom Annotation<a href="#construct-a-custom-annotation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Remember how we validate the <code class="language-plaintext highlighter-rouge">MyQueryObject.hexColorValue</code> above? We use a <code class="language-plaintext highlighter-rouge">@Pattern</code> with a <code class="language-plaintext highlighter-rouge">regex</code> . What if we can create our own annotation <code class="language-plaintext highlighter-rouge">@HexColorValue</code> to validate every occurrence of Hex Color Value inside our project. It will improve our code readability significantly.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@Target</span><span class="o">(</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">)</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Constraint</span><span class="o">(</span><span class="n">validatedBy</span> <span class="o">=</span> <span class="nc">HexColorValueValidator</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">HexColorValue</span> <span class="o">{</span>
    
    <span class="nc">String</span> <span class="nf">message</span><span class="o">()</span> <span class="k">default</span> <span class="s">"{HexColorValue.inValid}"</span><span class="o">;</span>

    <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">groups</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>

    <span class="nc">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">Payload</span><span class="o">&gt;[]</span> <span class="nf">payload</span><span class="o">()</span> <span class="k">default</span> <span class="o">{};</span>
    
<span class="o">}</span>
</pre></table></code></div></div><p>Note that <code class="language-plaintext highlighter-rouge">@Constraint</code> is provided by <code class="language-plaintext highlighter-rouge">javax.validation.Constraint</code>. **Unlike the common scenario of creating custom annotation from stretch, this annotation with corresponding validator class will save us some trouble creating our own Annotation Processor using <code class="language-plaintext highlighter-rouge">Java Reflection API</code>. **</p><p><strong>We only need to use <code class="language-plaintext highlighter-rouge">@Constraint</code> to explicitly point out which class is our validation handler, spring will automatically instantiate a instace. Validator discussed in this scope should have an implementation of <code class="language-plaintext highlighter-rouge">interface ConstraintValidator&lt;A extends Annotation, T&gt;</code>, in this case, which is <code class="language-plaintext highlighter-rouge">ConstraintValidator&lt;HexColorValue, String&gt;</code>.</strong></p><blockquote><p><code class="language-plaintext highlighter-rouge">message()</code> =&gt; <code class="language-plaintext highlighter-rouge">ValidationMessages.properties</code></p><p>The <code class="language-plaintext highlighter-rouge">ValidationMessages</code> resource bundle and the locale variants of this resource bundle contain strings that override the default validation messages. The <code class="language-plaintext highlighter-rouge">ValidationMessages</code> resource bundle is typically a properties file, <code class="language-plaintext highlighter-rouge">ValidationMessages.properties</code>, in the default package of an application.</p></blockquote><p>### Implement ConstraintValidator</p><p>After creating our own <code class="language-plaintext highlighter-rouge">@HexColorValue</code> and pointing validator class using <code class="language-plaintext highlighter-rouge">@Constraint</code>. We will implement <code class="language-plaintext highlighter-rouge">HexColorValueValidator</code> as follows.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HexColorValueValidator</span> <span class="kd">implements</span> <span class="nc">ConstraintValidator</span><span class="o">&lt;</span><span class="nc">HexColorValue</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Pattern</span> <span class="n">hexColorValuePattern</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$"</span><span class="o">);</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">,</span> <span class="nc">ConstraintValidatorContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">hexColorValuePattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">value</span><span class="o">).</span><span class="na">matches</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><h3 id="substitute-pattern-with-hexcolorvalue">Substitute <code class="language-plaintext highlighter-rouge">@Pattern</code> with <code class="language-plaintext highlighter-rouge">@HexColorValue</code><a href="#substitute-pattern-with-hexcolorvalue" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyQueryObject</span><span class="o">{</span>
    <span class="c1">// ......</span>
    <span class="c1">// No longer need @Pattern</span>
    <span class="c1">// @Pattern(regexp = "^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$") </span>
    
    <span class="nd">@HexColorValue</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">hexColorValue</span><span class="o">;</span>

<span class="o">}</span>
</pre></table></code></div></div><p>Everything will work smoothly as it used to be.</p><h3 id="invoke-validation-manually">Invoke Validation Manually<a href="#invoke-validation-manually" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Since we have already created a custom validator class for HexColorValue, what if we need to re-use that validator code to validate String on the fly.</p><p>You may think of using <code class="language-plaintext highlighter-rouge">HexColorValueValidator.isValid(String hexValue) -&gt; boolean</code>. However, Raw usage of this method is not recommended. <del>(I just cannot find the way to explicitly invoke that exact method without providing a self ConstraintValidatorContext context…)</del>. <strong>Spring got us covered by using it perfect dependency injection technique.</strong></p><h4 id="bean-tweak">Bean Tweak<a href="#bean-tweak" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><blockquote><p>implements <code class="language-plaintext highlighter-rouge">Serializable</code>(Optional).</p></blockquote><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyQueryObject</span> <span class="kd">implements</span> <span class="nc">Serializable</span>
</pre></table></code></div></div><h4 id="service-ify-the-manual-validator-with-generic-class-support">Service-ify the manual validator with Generic Class Support<a href="#service-ify-the-manual-validator-with-generic-class-support" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><blockquote><p><code class="language-plaintext highlighter-rouge">Validation</code>, <code class="language-plaintext highlighter-rouge">ValidatorFactory</code>, <code class="language-plaintext highlighter-rouge">Validator</code> …</p><p><code class="language-plaintext highlighter-rouge">validator.validate()</code> will automatically locate the field that needs to be validated.(Annotated with registered with @Constraint), then invoke the corresponding method inside the registered validation handler class to proceed.</p></blockquote><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ValidationService</span><span class="o">&lt;</span><span class="no">A</span> <span class="kd">extends</span> <span class="nc">Serializable</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ValidatorFactory</span> <span class="n">validatorFactory</span> <span class="o">=</span> <span class="nc">Validation</span><span class="o">.</span><span class="na">buildDefaultValidatorFactory</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">validatorFactory</span><span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="no">A</span> <span class="n">objectPendingValidate</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">ConstraintViolation</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;&gt;</span> <span class="n">violations</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">objectPendingValidate</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">violations</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>with the validation class being <code class="language-plaintext highlighter-rouge">@Service</code>-ify, now we can use <code class="language-plaintext highlighter-rouge">@Autowired</code> to inject <code class="language-plaintext highlighter-rouge">ValidationService</code> project-wisely.</p><h4 id="test-drive-our-validationservice">Test-Drive our <code class="language-plaintext highlighter-rouge">ValidationService</code><a href="#test-drive-our-validationservice" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>    <span class="nd">@Autowired</span>
    <span class="nc">ValidationService</span><span class="o">&lt;</span><span class="nc">MyQueryObject</span><span class="o">&gt;</span> <span class="n">qoValidationService</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">customValidationService_on_MyQueryObject</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">MyQueryObject</span> <span class="n">validQueryObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyQueryObject</span><span class="o">();</span>
        <span class="n">validQueryObject</span><span class="o">.</span><span class="na">setQueryNumberInstance</span><span class="o">(</span><span class="mi">69</span><span class="o">);</span>
        <span class="n">validQueryObject</span><span class="o">.</span><span class="na">setHexColorValue</span><span class="o">(</span><span class="s">"#2B2C2D"</span><span class="o">);</span>

        <span class="nc">MyQueryObject</span> <span class="n">invalidQueryObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyQueryObject</span><span class="o">();</span>
        <span class="n">invalidQueryObject</span><span class="o">.</span><span class="na">setQueryNumberInstance</span><span class="o">(</span><span class="mi">96</span><span class="o">);</span>
        <span class="n">invalidQueryObject</span><span class="o">.</span><span class="na">setHexColorValue</span><span class="o">(</span><span class="s">"#ZSDZXF"</span><span class="o">);</span>

        <span class="n">assertTrue</span><span class="o">(</span><span class="n">qoValidationService</span><span class="o">.</span><span class="na">isValid</span><span class="o">(</span><span class="n">validQueryObject</span><span class="o">));</span>
        <span class="n">assertFalse</span><span class="o">(</span><span class="n">qoValidationService</span><span class="o">.</span><span class="na">isValid</span><span class="o">(</span><span class="n">invalidQueryObject</span><span class="o">));</span>
        <span class="c1">// Test passed.</span>
    <span class="o">}</span>
</pre></table></code></div></div><h4 id="strict-validation">Strict Validation<a href="#strict-validation" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>Here’s an interesting point. When we call the constructor of <code class="language-plaintext highlighter-rouge">MyQueryObject</code> to initialize an instance, instead of letting spring handle the bean via dependency injection, the validation strategy will not kick in.</p><p>Look at <code class="language-plaintext highlighter-rouge">invalidQueryObject.setHexColorValue("#ZSDZXF");</code>. We just throw a invalid value to a setter. What if we are in a situation when all the bean existence should be <strong>“strictly valid”</strong>?</p><p>Well, this perhaps goes a little bit off the track of this post original purpose. You can always make some validation implementations in the <code class="language-plaintext highlighter-rouge">setter</code> or <code class="language-plaintext highlighter-rouge">getter</code>.</p><h2 id="python-wrapper-approach">Python Wrapper Approach<a href="#python-wrapper-approach" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="introduction">Introduction<a href="#introduction" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>If you are not familiar with python wrapper pattern or how does it work in python, it will not matter. If you ever coded in python, it wouldn’t be hard for you to understanding the following pattern. Remember how <code class="language-plaintext highlighter-rouge">%timeit</code> works in Jupyter Notebook?</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span><span class="n">function_instance</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">time_start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">function_instance</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">time_stop</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'{} second(s) taken up to execute function {}'</span> \
            <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">time_stop</span> <span class="o">-</span> <span class="n">time_start</span><span class="p">,</span> <span class="n">function_instance</span><span class="p">.</span><span class="n">__name__</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="o">@</span><span class="n">timeit</span>
<span class="k">def</span> <span class="nf">yell_out_shit</span><span class="p">(</span><span class="n">slogan</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">slogan</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">yell_out_shit</span><span class="p">(</span><span class="s">"PHP is the best language!"</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>❯ python /home/mijazz/Dev/pyworkspace/temp.py
PHP is the best language!
1.5018470287322998 second(s) taken up to execute function yell_out_shit
</pre></table></code></div></div><p><strong>But how come this ever get related in Java Bean Validation?</strong></p><h3 id="scene-re-appearance">Scene Re-appearance<a href="#scene-re-appearance" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">math_func_need_positiveNumber</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">input</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">'Invalid input in {} with {}'</span>\
            <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">math_func_need_positiveNumber</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>
    <span class="c1"># bla, bla, bla
</span>    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">math_func_need_negativeNumber</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">input</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">'Invalid input in {} with {}'</span>\
            <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">math_func_need_negativeNumber</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">func_need_num_in_range</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">input</span> <span class="o">&lt;</span> <span class="mi">69</span> <span class="ow">or</span> <span class="nb">input</span> <span class="o">&gt;</span> <span class="mi">96</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">'Invalid input in {} with {}'</span>\
            <span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">func_need_num_in_range</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">input</span><span class="p">))</span>
    <span class="k">pass</span>
</pre></table></code></div></div><p>For coder just need python for some simple math calculation, it is not uncommon to see this type of code…However, to state my point, I am not saying this code style is bad or something, a quick and dirty fix can simply be realized by python wrapper.</p><h3 id="implement-our-own-range-annotation">Implement our own <code class="language-plaintext highlighter-rouge">@Range()</code> annotation<a href="#implement-our-own-range-annotation" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>In our <code class="language-plaintext highlighter-rouge">MyQueryObject.queryNumberInstance</code>, I use <code class="language-plaintext highlighter-rouge">@Min(1)</code>, <code class="language-plaintext highlighter-rouge">@Max(100)</code> annotations to specify a range. But just so you know, <code class="language-plaintext highlighter-rouge">org.hibernate.validator.constraints.Range</code> is also out of the box. <code class="language-plaintext highlighter-rouge">@Range(min=1, max=100)</code> will be like the exact same.</p></blockquote><p>Let’s start with the <code class="language-plaintext highlighter-rouge">Range</code> method first.</p><p>a little heads up.</p><ul><li><code class="language-plaintext highlighter-rouge">*annotion_args</code> is positional args given in decorator. They are <strong>decorator/wrapper</strong> params.<li><code class="language-plaintext highlighter-rouge">**annotation_kargs</code> is keyword args given in decorator. They are <strong>decorator/wrapper</strong> params.<li><code class="language-plaintext highlighter-rouge">*func_args</code> is the positional args given into the function itself. They are <strong>function</strong> params.<li><code class="language-plaintext highlighter-rouge">**func_kargs</code> is the keyword args given into the function itself. They are <strong>function</strong> params.</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">Range</span><span class="p">(</span><span class="o">*</span><span class="n">annotation_args</span><span class="p">,</span> <span class="o">**</span><span class="n">annotation_kargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">on_invoke</span><span class="p">(</span><span class="o">*</span><span class="n">func_args</span><span class="p">,</span> <span class="o">**</span><span class="n">func_kargs</span><span class="p">):</span>
            <span class="c1"># Keyword args processing
</span>            <span class="k">for</span> <span class="p">(</span><span class="n">arg_key</span><span class="p">,</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">))</span> <span class="ow">in</span> <span class="n">annotation_kargs</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">func_kargs</span><span class="p">[</span><span class="n">arg_key</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">low</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">'{} - Limit exceeded.'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">func_kargs</span><span class="p">[</span><span class="n">arg_position</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">high</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">func_kargs</span><span class="p">[</span><span class="n">arg_key</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">high</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">'{} + Bound exceeded.'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">func_kargs</span><span class="p">[</span><span class="n">arg_position</span><span class="p">]))</span>

            <span class="c1"># Positional args processing
</span>            <span class="k">for</span> <span class="p">(</span><span class="n">arg_position</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span> <span class="ow">in</span> <span class="n">annotation_args</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">func_args</span><span class="p">[</span><span class="n">arg_position</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">low</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">'{} - Limit exceeded.'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">func_args</span><span class="p">[</span><span class="n">arg_position</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">high</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">func_args</span><span class="p">[</span><span class="n">arg_position</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">high</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="nb">AssertionError</span><span class="p">(</span><span class="s">'{} + Bound exceeded.'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">func_args</span><span class="p">[</span><span class="n">arg_position</span><span class="p">]))</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">func_args</span><span class="p">,</span> <span class="o">**</span><span class="n">func_kargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">on_invoke</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></table></code></div></div><h3 id="usage">Usage<a href="#usage" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>Let’s see how this puppy works. Derive a function of common usage.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">@</span><span class="n">Range</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">positive</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">some_func</span><span class="p">(</span><span class="n">negative</span><span class="p">,</span> <span class="n">ZERO</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">(0, None, 0)</code> and <code class="language-plaintext highlighter-rouge">(1, 0, 1)</code> are <code class="language-plaintext highlighter-rouge">*annotion_args</code>, which represents that <code class="language-plaintext highlighter-rouge">function_arg[0] &lt;=&gt; negative</code> should have <code class="language-plaintext highlighter-rouge">None</code> as low limit, <code class="language-plaintext highlighter-rouge">0</code> as upper bound; <code class="language-plaintext highlighter-rouge">Function_args[1] &lt;=&gt; ZERO</code> should have <code class="language-plaintext highlighter-rouge">0</code> as low limit, <code class="language-plaintext highlighter-rouge">1</code> as upper bound.</ul><p>In general.</p><ul><li><code class="language-plaintext highlighter-rouge">(0, None, 0)</code> =&gt; <code class="language-plaintext highlighter-rouge">0th</code> positional arg should be in <code class="language-plaintext highlighter-rouge">[-inf, 0)</code>.<li><code class="language-plaintext highlighter-rouge">(1, 0, 1)</code> =&gt; <code class="language-plaintext highlighter-rouge">1st</code> positional arg should be in <code class="language-plaintext highlighter-rouge">[0, 1)</code>.<li><code class="language-plaintext highlighter-rouge">positive=(1, None)</code> =&gt; keyword arg <code class="language-plaintext highlighter-rouge">positive</code> should be in <code class="language-plaintext highlighter-rouge">[1, +inf)</code>.</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">some_func</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span> <span class="c1"># Smooth.
</span><span class="n">some_func</span><span class="p">(</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>          <span class="c1"># positive not given.
</span><span class="n">some_func</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span> <span class="c1"># 10 + Upper bound exceeded.
</span></pre></table></code></div></div><h3 id="thoughts">Thoughts<a href="#thoughts" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>You can even use the same technique to do a argument Type Check, instead of using a regular one. (Back in python2 style ??? or pythonic???).</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">ForceType</span><span class="p">(</span><span class="o">**</span><span class="n">annotation_kargs</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">on_invoke</span><span class="p">(</span><span class="o">**</span><span class="n">function_kargs</span><span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">argname</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">in</span> <span class="n">annotation_kargs</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function_kargs</span><span class="p">[</span><span class="n">argname</span><span class="p">],</span> <span class="nb">type</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">function_kargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">on_invoke</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="o">@</span><span class="n">ForceType</span><span class="p">(</span><span class="n">Integer</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">String</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">another_func</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">another_func</span><span class="p">(</span><span class="n">Integer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">String</span><span class="o">=</span><span class="s">"2"</span><span class="p">)</span> <span class="c1"># Smooth
</span><span class="n">another_func</span><span class="p">(</span><span class="n">Integer</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">String</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># TypeError
</span></pre></table></code></div></div><p>Once you figure out the underlying pattern of the example provided above, it’s easy to implement other feature like <code class="language-plaintext highlighter-rouge">str</code> length check.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a>, <a href='/categories/design/'>Design</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/python/" class="post-tag no-text-decoration" >python</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/annotation/" class="post-tag no-text-decoration" >annotation</a> <a href="/tags/wrapper/" class="post-tag no-text-decoration" >wrapper</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://telegram.me/share?text=From Spring Boot Bean Validation to Python Wrapper - Mijazz Chan&url=https://mijazzchan.github.io/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://twitter.com/intent/tweet?text=From Spring Boot Bean Validation to Python Wrapper - Mijazz Chan&url=https://mijazzchan.github.io/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://mijazzchan.github.io/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=From Spring Boot Bean Validation to Python Wrapper - Mijazz Chan&url=https://mijazzchan.github.io/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Documentation-for-cloudflare-ddns-edgeos/">Documentation for cloudflare-ddns-edgeos</a><li><a href="/posts/Utility-Functions-While-Leetcoding/">Some Utility Functions While Leetcoding</a><li><a href="/posts/Store-Multiple-Booleans-Using-Byte/">Store Multiple Booleans Using Single Variable</a><li><a href="/posts/Decision-Tree-Wine-Classification/">Decision Tree Wine Classification</a><li><a href="/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/">From Spring Boot Bean Validation to Python Wrapper</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/annotation/">annotation</a> <a class="post-tag" href="/tags/code/">code</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/pandas/">pandas</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Validate-Object-Using-Reflection-Inspired-by-Spring/"><div class="card-body"> <em class="timeago small" date="2021-06-06 15:15:27 +0800" >Jun 6, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Validate Object Using Reflection Inspired by Spring</h3><div class="text-muted small"><p> Inspired by Spring’s excellent dependency injection way of handling bean validation, after reading some official java documentations and Spring Docs, I decided to find a way of achieving the purpos...</p></div></div></a></div><div class="card"> <a href="/posts/Store-Multiple-Booleans-Using-Byte/"><div class="card-body"> <em class="timeago small" date="2021-04-18 17:14:49 +0800" >Apr 18, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Store Multiple Booleans Using Single Variable</h3><div class="text-muted small"><p> Intro Inspired by a stackoverflow answer which is more than a decade old. StackOverflow-Answer1, StackOverflow - Answer2 @Jon Skeet there provide a way of measuring how much memory do byte, int a...</p></div></div></a></div><div class="card"> <a href="/posts/Some-Neat-Design-Patterns-Effective-Java-reading-notes/"><div class="card-body"> <em class="timeago small" date="2021-06-10 00:22:19 +0800" >Jun 10, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Some Neat Design Patterns - Effective Java reading notes</h3><div class="text-muted small"><p> Builder Pattern Simple Builder Pattern without considering Hierarchy Generic Type Builder Pattern (suits to class hierarchies) ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Decision-Tree-Wine-Classification/" class="btn btn-outline-primary" prompt="Older"><p>Decision Tree Wine Classification</p></a> <a href="/posts/Validate-Object-Using-Reflection-Inspired-by-Spring/" class="btn btn-outline-primary" prompt="Newer"><p>Validate Object Using Reflection Inspired by Spring</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/MijazzChan">Mijazz Chan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/annotation/">annotation</a> <a class="post-tag" href="/tags/code/">code</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/pandas/">pandas</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
