<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual)" /><meta property="og:locale" content="en" /><meta name="description" content="Intro" /><meta property="og:description" content="Intro" /><link rel="canonical" href="https://mijazzchan.github.io/posts/clean-pacman-yay-package-cache-on-manjaro-automation-manual/" /><meta property="og:url" content="https://mijazzchan.github.io/posts/clean-pacman-yay-package-cache-on-manjaro-automation-manual/" /><meta property="og:site_name" content="Mijazz Chan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-09T12:36:23+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual)" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual)","dateModified":"2022-01-09T12:36:23+08:00","datePublished":"2022-01-09T12:36:23+08:00","description":"Intro","url":"https://mijazzchan.github.io/posts/clean-pacman-yay-package-cache-on-manjaro-automation-manual/","mainEntityOfPage":{"@type":"WebPage","@id":"https://mijazzchan.github.io/posts/clean-pacman-yay-package-cache-on-manjaro-automation-manual/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual) | Mijazz Chan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mijazz Chan"><meta name="application-name" content="Mijazz Chan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatars/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mijazz Chan</a></div><div class="site-subtitle font-italic">Code with Passion</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/MijazzChan" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/%E9%99%88%E6%B5%A9%E9%AA%8F-mijazz/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mijazz','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual)</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/MijazzChan">Mijazz Chan</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-09 12:36:23 +0800" data-toggle="tooltip" data-placement="bottom" title="Sun, Jan 9, 2022, 12:36 PM +0800" >Jan 9</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1190 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h2 id="intro">Intro<a href="#intro" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>After several months of using Manjaro Linux(Arch Based Distro), I feel like getting attracted to its package manager <code class="language-plaintext highlighter-rouge">pacman</code> and its Rolling Release pattern.</p><p>Most of the time, Arch has vanilla packages (not as heavily modified as the Ubuntu/Debian based distros) that you can directly compile or install by just using <code class="language-plaintext highlighter-rouge">pacman</code>. It really save the day when you don’t have to worry about some OS specific workaround. Tweaking/Messing with dotfile while configuring a freshly installed non-functional package is a nightmare to me.</p><p>Arch or AUR, often ships the newest/latest software with just-right-open-the-box experience.</p><p>However, with all these upsides, we will also face some downsides.</p><h2 id="reproduce-the-scenario">Reproduce the Scenario<a href="#reproduce-the-scenario" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>I didn’t notice my disk usage until I have to meet a specific project requirements(machine learning) which needs installing <code class="language-plaintext highlighter-rouge">cuda</code> and <code class="language-plaintext highlighter-rouge">tensorflow</code> manually. Then I found out that my <code class="language-plaintext highlighter-rouge">/var/cache/pacman/pkg</code> ate up almost 20GB of my storage space, which results that my <code class="language-plaintext highlighter-rouge">/</code> barely have enough space to fit my new packages in. (<del>Don’t buy Solid-State-Drive smaller than 512GB, and definitely don’t throw a Windows on it…</del>)</p><p>Because I am using <code class="language-plaintext highlighter-rouge">pacman</code> and <code class="language-plaintext highlighter-rouge">yay</code> to manage my system packages and never bother to clean them manually. It grows up in size. Browsing on <a href="https://wiki.archlinux.org/title/pacman">ArchWiki</a>, turns out that <code class="language-plaintext highlighter-rouge">pacman</code> will not automatically clean the package cache after installing/upgrading package in case users need to downgrade to a lower version of that.</p><p>Although <code class="language-plaintext highlighter-rouge">pacman</code> do provide <code class="language-plaintext highlighter-rouge">cli</code> parameters to remove (un)installed package cache,</p><blockquote><ul><li><code class="language-plaintext highlighter-rouge">pacman -Sc</code> to clean cache of the uninstalled packages.<li><code class="language-plaintext highlighter-rouge">pacman -Scc</code> to clean all cache despite their state of installing.</ul></blockquote><p>It’s still worth keeping 1 or 2 cached packages of each (un)installed software in case of emergency.</p><h2 id="clean-pacman-cache">Clean <code class="language-plaintext highlighter-rouge">pacman</code> cache<a href="#clean-pacman-cache" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Generally located in <code class="language-plaintext highlighter-rouge">/var/cache/pacman/pkg</code>. If altered, pass param <code class="language-plaintext highlighter-rouge">-c</code> or <code class="language-plaintext highlighter-rouge">--cachedir</code> to specify different cache directory.</p></blockquote><p>With the help of <code class="language-plaintext highlighter-rouge">paccache</code>, we can easily achieve the goal/purpose mentioned above.</p><blockquote><p>Note that <code class="language-plaintext highlighter-rouge">paccache</code> is now come from package called <code class="language-plaintext highlighter-rouge">pacman-contrib</code>, it originally ships with <code class="language-plaintext highlighter-rouge">pacman</code> till it became a tool component split into the <code class="language-plaintext highlighter-rouge">...-contrib</code> package alongside with <code class="language-plaintext highlighter-rouge">pacdiff</code>, <code class="language-plaintext highlighter-rouge">paclist</code>, <code class="language-plaintext highlighter-rouge">rankmirrors</code>, etc. See also <a href="https://archlinux.org/packages/community/x86_64/pacman-contrib/">Community/pacman-contrib</a>.</p></blockquote><p><strong>For documentation/man of <code class="language-plaintext highlighter-rouge">paccache</code>, click <a href="https://man.archlinux.org/man/paccache.8">here</a></strong>.</p><p><strong>TLDR?</strong></p><p>Check dependency first, find out whether <code class="language-plaintext highlighter-rouge">pacman-contrib</code> is installed or not.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pacman <span class="nt">-Q</span> pacman-contrib
</pre></table></code></div></div><p>To list out the cache that needs to be cleaned, follow steps below.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>paccache <span class="nt">-dvk2</span>
<span class="c"># This line above list out the packages which are flagged</span>
<span class="c"># to delete. (but keep 2 versions of each of them.)</span>
<span class="c"># paccache --dryrun --verbose --keep 2</span>

paccache <span class="nt">-dvuk1</span>
<span class="c"># This line above list out the already uninstalled packages </span>
<span class="c"># which are flagged to delete. (but keep 1 version of each of</span>
<span class="c"># them.)</span>
<span class="c"># paccache --dryrun --verbose --uninstalled --keep 1</span>
</pre></table></code></div></div><p>To clean up the cache, follow steps below.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>paccache <span class="nt">-rvk2</span> <span class="o">&amp;&amp;</span> paccache <span class="nt">-rvuk1</span>
<span class="c"># paccache --remove --verbose --keep 2 </span>
<span class="c"># paccache --remove --verbose --uninstalled --keep 1</span>
<span class="c"># which does the same trick.</span>
</pre></table></code></div></div><h2 id="clean-yay-cache">Clean <code class="language-plaintext highlighter-rouge">yay</code> cache<a href="#clean-yay-cache" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Generally located in <code class="language-plaintext highlighter-rouge">/home/$(whoami)/.cache/yay</code>. If altered, pass param <code class="language-plaintext highlighter-rouge">-c</code> or <code class="language-plaintext highlighter-rouge">--cachedir</code> to specify different cache directory.</p></blockquote><p>Using the same <code class="language-plaintext highlighter-rouge">paccache</code> approach mentioned above can also be useful when it comes to <code class="language-plaintext highlighter-rouge">yay</code> cache. Point the cache directory to <code class="language-plaintext highlighter-rouge">/home/$(whoami)/.cache/yay/*/</code> by passing <code class="language-plaintext highlighter-rouge">-c /home/mijazz/.cache/yay/*/</code>(in my case).</p><p>Also, to list’em out</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>paccache <span class="nt">-c</span> /home/<span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span>/.cache/yay/<span class="k">*</span>/ <span class="nt">-dvk2</span>
<span class="c"># paccache -cachedir /home/$(whoami)/.cache/yay/*/ --dryrun --verbose --keep 2</span>

paccache <span class="nt">-c</span> /home/<span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span>/.cache/yay/<span class="k">*</span>/ <span class="nt">-dvuk1</span>
<span class="c"># paccache -c /home/$(whoami)/.cache/yay/*/  --dryrun --verbose --uninstalled --keep 1</span>
</pre></table></code></div></div><p>to clean’em</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>paccache <span class="nt">-c</span> /home/<span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span>/.cache/yay/<span class="k">*</span>/ <span class="nt">-rvk2</span>
<span class="c"># paccache -cachedir /home/$(whoami)/.cache/yay/*/ --remove --verbose --keep 2</span>

paccache <span class="nt">-c</span> /home/<span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span>/.cache/yay/<span class="k">*</span>/ <span class="nt">-rvuk1</span>
<span class="c"># paccache -c /home/$(whoami)/.cache/yay/*/  --remove --verbose --uninstalled --keep 1</span>
</pre></table></code></div></div><h3 id="yays--approach-to-clean"><code class="language-plaintext highlighter-rouge">yay</code>’s approach to clean<a href="#yays--approach-to-clean" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>Not recommended. (Interactive prompt in shell.)</p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>yay <span class="nt">-Scc</span>

Cache directory: /var/cache/pacman/pkg/
:: Do you want to remove ALL files from cache? <span class="o">[</span>y/N] N

Database directory: /var/lib/pacman/
:: Do you want to remove unused repositories? <span class="o">[</span>Y/n] N

Build directory: /home/mijazz/.cache/yay
<span class="o">==&gt;</span> Do you want to remove ALL AUR packages from cache? <span class="o">[</span>Y/n] y
removing AUR packages from cache...

</pre></table></code></div></div><h2 id="achieve-automation-via-hooks">Achieve Automation via Hooks<a href="#achieve-automation-via-hooks" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Automatically clean cache after each package transaction can be achieved given you are familiar with <code class="language-plaintext highlighter-rouge">alpm-hooks</code>.</p><p>It provides the ability to run hooks before or after package transaction based on the packages and/or files being modified.</p><p>You can custom the trigger of the hook whether it will run <code class="language-plaintext highlighter-rouge">[ before | after ]</code> the <code class="language-plaintext highlighter-rouge">[ specific | * ]</code>package <code class="language-plaintext highlighter-rouge">[ Install | Upgrade | Remove ]</code> transaction.</p><p>In this specific scenario this post focusing on, a <strong>cleaning-hook</strong> triggered <strong>after</strong> package wildcard <strong>*** being **upgraded</strong> or <strong>uninstalled</strong> will be perfectly suitable.</p><blockquote><p>Hooks are written in alpm hook file format, <a href="https://man.archlinux.org/man/alpm-hooks.5">ArchWiki - alpm-hooks</a></p><p>Default hook files location is <code class="language-plaintext highlighter-rouge">/usr/share/libalpm/hooks</code>, and <code class="language-plaintext highlighter-rouge">/etc/pacman.d/hooks</code>, additionally it can be customized via <code class="language-plaintext highlighter-rouge">/etc/pacman.conf</code> - <code class="language-plaintext highlighter-rouge">HookDir</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>#
# /etc/pacman.conf
#
# See the pacman.conf(5) manpage for option and repository directives

#
# GENERAL OPTIONS
#
[options]
# The following paths are commented out with their default values listed.
# If you wish to use different paths, uncomment and update the paths.
#RootDir     = /
#DBPath      = /var/lib/pacman/
CacheDir = /var/cache/pacman/pkg/
#LogFile     = /var/log/pacman.log
#GPGDir      = /etc/pacman.d/gnupg/
#HookDir     = /etc/pacman.d/hooks/
</pre></table></code></div></div><p>More details can be found at <a href="https://wiki.archlinux.org/title/Pacman#Hooks">ArchWiki - Pacman #Hooks</a></p></blockquote><p>Start with cleaning script. Name it <code class="language-plaintext highlighter-rouge">/home/$(whoami)/.local/bin/cleaning-automation</code><del>(whatever)</del>, just don’t forget to <code class="language-plaintext highlighter-rouge">chmod +x</code>.</p><div file="cleaning-automation" class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="cleaning-automation"><i class="far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="c">#!/usr/bin/env bash</span>

<span class="c"># Clean cache upgrade/uninstall at PostTransaction</span>
<span class="c"># /home/mijazz/.local/bin/cleaning-automation</span>
<span class="c"># Hook starts here</span>

<span class="c"># Suppose you run yay with your user account id 1000</span>
<span class="nv">yay_running_on_behalf</span><span class="o">=</span><span class="si">$(</span><span class="nb">id</span> <span class="nt">-nu</span> 1000<span class="si">)</span>
<span class="nv">yay_cache_dir</span><span class="o">=</span><span class="s2">"/home/</span><span class="nv">$yay_running_on_behalf</span><span class="s2">/.cache/yay/"</span>

<span class="nv">pkg_cache_dir</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>find <span class="nv">$yay_cache_dir</span> <span class="nt">-mindepth</span> 1 <span class="nt">-maxdepth</span> 1 <span class="nt">-type</span> d | xargs <span class="nt">-r</span> <span class="nb">printf</span> <span class="s2">"-c %s "</span><span class="si">)</span><span class="s2">"</span>

<span class="nb">echo</span> <span class="s2">"Removing cached packages, keeping latest 2 versions of each one."</span>
/usr/bin/paccache <span class="nt">-rk2</span>
/usr/bin/paccache <span class="nt">-rk2</span> <span class="nv">$pkg_cache_dir</span>

<span class="nb">echo</span> <span class="s2">"Removing cached uninstalled packages, keeping latest 1 versions of each one."</span>
/usr/bin/paccache <span class="nt">-ruk1</span>
/usr/bin/paccache <span class="nt">-ruk1</span> <span class="nv">$pkg_cache_dir</span>
</pre></table></code></div></div><p>then the hook. Place it under <code class="language-plaintext highlighter-rouge">/etc/pacman.d/hooks</code>(if this specific directory doesn’t exist, just <code class="language-plaintext highlighter-rouge">mkdir</code> it). <strong>Do remember that hook’s filename must look like <code class="language-plaintext highlighter-rouge">*.hook</code></strong>.</p><blockquote><p>File SYNOPSIS:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>[Trigger] (Required, Repeatable)
Operation = Install|Upgrade|Remove (Required, Repeatable)
Type = Path|Package (Required)
Target = &lt;Path|PkgName&gt; (Required, Repeatable)
[Action] (Required)
Description = ... (Optional)
When = PreTransaction|PostTransaction (Required)
Exec = &lt;Command&gt; (Required)
Depends = &lt;PkgName&gt; (Optional)
AbortOnFail (Optional, PreTransaction only)
NeedsTargets (Optional)
</pre></table></code></div></div></blockquote><div file="cleaning-automation.hook" class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="cleaning-automation.hook"><i class="far fa-file-code"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre># Pacman Cache Cleaning Hook

# /etc/pacman.d/hooks/cleaning-automation.hook

[Trigger]
Operation = Upgrade
Operation = Remove
Type = Package
Target = *

[Action]
Description = Pacman Cache Cleaning Hook
When = PostTransaction
Exec = /home/mijazz/.local/bin/cleaning-automation
Depends = pacman-contrib
</pre></table></code></div></div><h2 id="conclusion">Conclusion<a href="#conclusion" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Using <code class="language-plaintext highlighter-rouge">PostTransaction</code> hook to achieve this automation is perfectly suitable for those folks who don’t have big <code class="language-plaintext highlighter-rouge">/</code> disk space but daily drive Arch based Linux. However, keeping extra versions of cache packages also benefits Linux user to some extend, in case you need to roll back some packages to previous version in order to prevent crashing or mis-behavior of the latest one.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/linux/'>Linux</a>, <a href='/categories/management/'>Management</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/manjaro/" class="post-tag no-text-decoration" >manjaro</a> <a href="/tags/pacman/" class="post-tag no-text-decoration" >pacman</a> <a href="/tags/yay/" class="post-tag no-text-decoration" >yay</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://telegram.me/share?text=Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual) - Mijazz Chan&url=https://mijazzchan.github.io/posts/clean-pacman-yay-package-cache-on-manjaro-automation-manual/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://twitter.com/intent/tweet?text=Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual) - Mijazz Chan&url=https://mijazzchan.github.io/posts/clean-pacman-yay-package-cache-on-manjaro-automation-manual/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://mijazzchan.github.io/posts/clean-pacman-yay-package-cache-on-manjaro-automation-manual/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Clean Pacman/Yay Package Cache on Manjaro or Arch-based Distros (Automation/Manual) - Mijazz Chan&url=https://mijazzchan.github.io/posts/clean-pacman-yay-package-cache-on-manjaro-automation-manual/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Documentation-for-cloudflare-ddns-edgeos/">Documentation for cloudflare-ddns-edgeos</a><li><a href="/posts/Utility-Functions-While-Leetcoding/">Some Utility Functions While Leetcoding</a><li><a href="/posts/Store-Multiple-Booleans-Using-Byte/">Store Multiple Booleans Using Single Variable</a><li><a href="/posts/Decision-Tree-Wine-Classification/">Decision Tree Wine Classification</a><li><a href="/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/">From Spring Boot Bean Validation to Python Wrapper</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/annotation/">annotation</a> <a class="post-tag" href="/tags/code/">code</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/pandas/">pandas</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ssh-proxycommand-nc-error/"><div class="card-body"> <em class="timeago small" date="2020-11-24 21:51:37 +0800" >Nov 24, 2020</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SSH ProxyCommand NC ERROR</h3><div class="text-muted small"><p> SSH ProxyCommand NC ERROR Description Platform: Manjaro 20 Configuration reference: using-proxy-for-git-or-github.md Error: Couldn&#39;t resolve host &quot;x.x.x.x:8888&quot; kex_exchange_identificatio...</p></div></div></a></div><div class="card"> <a href="/posts/Documentation-for-cloudflare-ddns-edgeos/"><div class="card-body"> <em class="timeago small" date="2022-03-02 16:32:09 +0800" >Mar 2</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Documentation for cloudflare-ddns-edgeos</h3><div class="text-muted small"><p> About this project Inspired by rehiy/dnspod-shell, I wrote this project. At the beginning, this is just a random script I wrote and configured it on my router with crontab, all because of my...</p></div></div></a></div><div class="card"> <a href="/posts/Dockerize-My-Network/"><div class="card-body"> <em class="timeago small" date="2021-03-29 16:51:49 +0800" >Mar 29, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dockerize My Network</h3><div class="text-muted small"><p> Current network architecture Visual diagram Just a sketch. So-called safe LAN, in which there will be no unexpected public traffic inbound under normal circumstances. In local LAN, us...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Functional-Interface-and-its-Underlying-Pattern/" class="btn btn-outline-primary" prompt="Older"><p>Functional Interface and its Underlying Pattern - Effective Java reading notes</p></a> <a href="/posts/Documentation-for-cloudflare-ddns-edgeos/" class="btn btn-outline-primary" prompt="Newer"><p>Documentation for cloudflare-ddns-edgeos</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/MijazzChan">Mijazz Chan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/annotation/">annotation</a> <a class="post-tag" href="/tags/code/">code</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/pandas/">pandas</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
