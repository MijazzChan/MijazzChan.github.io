<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Try Understanding Lombok" /><meta name="author" content="MijazzChan" /><meta property="og:locale" content="en" /><meta name="description" content="Try Understanding Lombok" /><meta property="og:description" content="Try Understanding Lombok" /><link rel="canonical" href="https://mijazzchan.github.io/posts/Try-Understanding-Lombok/" /><meta property="og:url" content="https://mijazzchan.github.io/posts/Try-Understanding-Lombok/" /><meta property="og:site_name" content="Mijazz Chan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-09T16:49:56+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Try Understanding Lombok" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@MijazzChan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"MijazzChan"},"headline":"Try Understanding Lombok","dateModified":"2022-01-11T07:45:22+08:00","datePublished":"2020-12-09T16:49:56+08:00","description":"Try Understanding Lombok","url":"https://mijazzchan.github.io/posts/Try-Understanding-Lombok/","mainEntityOfPage":{"@type":"WebPage","@id":"https://mijazzchan.github.io/posts/Try-Understanding-Lombok/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>Try Understanding Lombok | Mijazz Chan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mijazz Chan"><meta name="application-name" content="Mijazz Chan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatars/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mijazz Chan</a></div><div class="site-subtitle font-italic">Code with Passion</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/MijazzChan" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/%E9%99%88%E6%B5%A9%E9%AA%8F-mijazz/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mijazz','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Try Understanding Lombok</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Try Understanding Lombok</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/MijazzChan">Mijazz Chan</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2020-12-09 16:49:56 +0800" data-toggle="tooltip" data-placement="bottom" title="Wed, Dec 9, 2020, 4:49 PM +0800" >Dec 9, 2020</em> </span> <span> Updated <em class="timeago" date="2022-01-11 07:45:22 +0800 " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 11, 2022, 7:45 AM +0800" >Jan 11</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2544 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><h1 id="try-understanding-lombok">Try Understanding Lombok</h1><h2 id="what-is-lombok">What is Lombok<a href="#what-is-lombok" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p><a href="https://projectlombok.org/">Project Lombok</a></p><p><a href="https://mvnrepository.com/artifact/org.projectlombok/lombok">MVN Repo</a></p></blockquote><p>大概一年多以前我接触<code class="language-plaintext highlighter-rouge">Sping Boot</code>的设计模式时, 了解到<code class="language-plaintext highlighter-rouge">Entity</code>, <code class="language-plaintext highlighter-rouge">Service</code>, <code class="language-plaintext highlighter-rouge">Repository</code>, 等层次设计的时候, <code class="language-plaintext highlighter-rouge">POJO</code>什么的.</p><p>当时的项目用的是<code class="language-plaintext highlighter-rouge">Spring Data JPA</code>做的持久层, 中间经过几层的数据, 对象传递. 同时也为了方便调试, 产生了很多无用的<code class="language-plaintext highlighter-rouge">field.getter()</code>, <code class="language-plaintext highlighter-rouge">field.setter()</code>, <code class="language-plaintext highlighter-rouge">Object.toString()</code>, <code class="language-plaintext highlighter-rouge">Object.Constructer</code>函数或字段.</p><p><code class="language-plaintext highlighter-rouge">Lombok</code>简单来说就是使用注释引入或者说注入所需的生成的字节码.</p><p>但是如果知道<code class="language-plaintext highlighter-rouge">Annotation</code>的运行原理的话, 也比较难理解其实现方式. 因为<code class="language-plaintext highlighter-rouge">Annotation</code>说白了也只是一个接口. 其下几个相关的</p><ul><li><code class="language-plaintext highlighter-rouge">Target</code> - 规定修饰的类型<li><code class="language-plaintext highlighter-rouge">Retention</code> - 规定策略的类型, 见<code class="language-plaintext highlighter-rouge">RetentionPolicy</code></ul><p>也不直接具有修改注入的能力.</p><h2 id="go-deep">Go Deep?<a href="#go-deep" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>查阅了一些资料后</p><blockquote><p><a href="https://www.runoob.com/w3cnote/java-annotation.html">Java Annotation - runoob</a></p><p><a href="https://github.com/rzwitserloot/lombok">Lombok Github Repo</a></p><p><a href="https://openjdk.java.net/groups/compiler/doc/compilation-overview/index.html">Compilation-Overview - OpenJDK</a></p><p><strong>JSR 269 Pluggable Annotation Processing API</strong></p></blockquote><p>所以说到<code class="language-plaintext highlighter-rouge">Annotation</code>就是一个接口的话, 那么回想被注释的类其实是被<code class="language-plaintext highlighter-rouge">Implement</code>了. 并且被这些注解注释的类, 在<code class="language-plaintext highlighter-rouge">javac</code>对其进行编译过程时, 会拉起他们对应的注解 解释?/执行? 器<code class="language-plaintext highlighter-rouge">Annotation Processor</code>. 在这些注解执行类中, 通过重写<code class="language-plaintext highlighter-rouge">@OverWrite</code>几个关键的执行方法从而达到编译注入的目的.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="cm">/**
 * An abstract annotation processor designed to be a convenient
 * superclass for most concrete annotation processors.  This class
 * examines annotation values to compute the {@linkplain
 * #getSupportedOptions options}, {@linkplain
 * #getSupportedAnnotationTypes annotation types}, and {@linkplain
 * #getSupportedSourceVersion source version} supported by its
 * subtypes.
 *
 * &lt;p&gt;The getter methods may {@linkplain Messager#printMessage issue
 * warnings} about noteworthy conditions using the facilities available
 * after the processor has been {@linkplain #isInitialized
 * initialized}.
 *
 * &lt;p&gt;Subclasses are free to override the implementation and
 * specification of any of the methods in this class as long as the
 * general {@link javax.annotation.processing.Processor Processor}
 * contract for that method is obeyed.
 *
 * @author Joseph D. Darcy
 * @author Scott Seligman
 * @author Peter von der Ah&amp;eacute;
 * @since 1.6
 */</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractProcessor</span> <span class="kd">implements</span> <span class="nc">Processor</span>
</pre></table></code></div></div><p>在Lombok的源码中, 可见其几个Processor的类都是继承自上述这个在<code class="language-plaintext highlighter-rouge">package javax.annotation.processing;</code>中的类的.</p><blockquote><p><a href="https://github.com/rzwitserloot/lombok/blob/master/src/core/lombok/javac/handlers/HandleData.java">core/lombok/javac/handlers/HandleData.java</a></p><p><a href="https://github.com/rzwitserloot/lombok/blob/master/src/core/lombok/javac/handlers/HandleSetter.java">core/lombok/javac/handlers/HandleSetter.java</a></p><p>…</p></blockquote><p>并且采用了一些常用的<strong>反射</strong>和修改AST树来实现功能的.</p><p>这里不细说反射原理, 同时<code class="language-plaintext highlighter-rouge">javac</code>处理<code class="language-plaintext highlighter-rouge">RetentionPolicy</code>的策略属<code class="language-plaintext highlighter-rouge">Java Compilation</code>范畴.</p><p>所以回到代码举个例子</p><blockquote><p>本次工程是Maven同步的, 所以<code class="language-plaintext highlighter-rouge">javac -cp</code>引入<code class="language-plaintext highlighter-rouge">lombok</code>的时候要找到本地maven repo的位置并定位<code class="language-plaintext highlighter-rouge">lombok-xxx.jar</code>, 如果你没修改过默认应该是<code class="language-plaintext highlighter-rouge">~/.m2</code>下的</p></blockquote><p><code class="language-plaintext highlighter-rouge">Contact.java</code></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Contact</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">contactId</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">familyName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">givenName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">mobileNum</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Date</span> <span class="n">birthDay</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">@Data</code> 部分注释, 即是<code class="language-plaintext highlighter-rouge">@Data</code>在被处理时同时引入下列几个</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> <span class="o">*</span> <span class="nd">@see</span> <span class="nc">Getter</span>
 <span class="o">*</span> <span class="nd">@see</span> <span class="nc">Setter</span>
 <span class="o">*</span> <span class="nd">@see</span> <span class="nc">RequiredArgsConstructor</span>
 <span class="o">*</span> <span class="nd">@see</span> <span class="nc">ToString</span>
 <span class="o">*</span> <span class="nd">@see</span> <span class="nc">EqualsAndHashCode</span>
 <span class="o">*</span> <span class="nd">@see</span> <span class="n">lombok</span><span class="o">.</span><span class="na">Value</span>
</pre></table></code></div></div><p>并且观察Lombok的源码也可以发现其拉起了几个Handler</p><p><a href="https://github.com/rzwitserloot/lombok/blob/master/src/core/lombok/javac/handlers/HandleData.java">core/lombok/javac/handlers/HandleData.java</a></p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">handleConstructor</span><span class="o">.</span><span class="na">generateRequiredArgsConstructor</span><span class="o">(</span><span class="n">typeNode</span><span class="o">,</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PUBLIC</span><span class="o">,</span> <span class="n">staticConstructorName</span><span class="o">,</span> <span class="nc">SkipIfConstructorExists</span><span class="o">.</span><span class="na">YES</span><span class="o">,</span> <span class="n">annotationNode</span><span class="o">);</span>
		<span class="n">handleConstructor</span><span class="o">.</span><span class="na">generateExtraNoArgsConstructor</span><span class="o">(</span><span class="n">typeNode</span><span class="o">,</span> <span class="n">annotationNode</span><span class="o">);</span>
		<span class="n">handleGetter</span><span class="o">.</span><span class="na">generateGetterForType</span><span class="o">(</span><span class="n">typeNode</span><span class="o">,</span> <span class="n">annotationNode</span><span class="o">,</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PUBLIC</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="nc">List</span><span class="o">.&lt;</span><span class="nc">JCAnnotation</span><span class="o">&gt;</span><span class="n">nil</span><span class="o">());</span>
		<span class="n">handleSetter</span><span class="o">.</span><span class="na">generateSetterForType</span><span class="o">(</span><span class="n">typeNode</span><span class="o">,</span> <span class="n">annotationNode</span><span class="o">,</span> <span class="nc">AccessLevel</span><span class="o">.</span><span class="na">PUBLIC</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="nc">List</span><span class="o">.&lt;</span><span class="nc">JCAnnotation</span><span class="o">&gt;</span><span class="n">nil</span><span class="o">(),</span> <span class="nc">List</span><span class="o">.&lt;</span><span class="nc">JCAnnotation</span><span class="o">&gt;</span><span class="n">nil</span><span class="o">());</span>
		<span class="n">handleEqualsAndHashCode</span><span class="o">.</span><span class="na">generateEqualsAndHashCodeForType</span><span class="o">(</span><span class="n">typeNode</span><span class="o">,</span> <span class="n">annotationNode</span><span class="o">);</span>
		<span class="n">handleToString</span><span class="o">.</span><span class="na">generateToStringForType</span><span class="o">(</span><span class="n">typeNode</span><span class="o">,</span> <span class="n">annotationNode</span><span class="o">);</span>
</pre></table></code></div></div><p>这里只去看<code class="language-plaintext highlighter-rouge">HandleSetter</code> - <a href="https://github.com/rzwitserloot/lombok/blob/master/src/core/lombok/javac/handlers/HandleSetter.java">HandleSetter - Lombok, 不贴出</a></p><p>通过</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>MijazzChan@R720 MINGW64 /e/JWorkSpace/JSourceCodeLearn/src/main/java/edu/zstu/mijazz/lomboklearn/entity <span class="o">(</span>master<span class="o">)</span>
<span class="nv">$ </span>javac <span class="nt">-cp</span> /c/Dev/Env/m2Repo/org/projectlombok/lombok/1.18.16/lombok-1.18.16.jar ./Contact.java

MijazzChan@R720 MINGW64 /e/JWorkSpace/JSourceCodeLearn/src/main/java/edu/zstu/mijazz/lomboklearn/entity <span class="o">(</span>master<span class="o">)</span>
<span class="nv">$ </span><span class="nb">ls
</span>Contact.class  Contact.java

MijazzChan@R720 MINGW64 /e/JWorkSpace/JSourceCodeLearn/src/main/java/edu/zstu/mijazz/lomboklearn/entity <span class="o">(</span>master<span class="o">)</span>
<span class="nv">$ </span>javap ./Contact.class
Compiled from <span class="s2">"Contact.java"</span>
public class edu.zstu.mijazz.lomboklearn.entity.Contact <span class="o">{</span>
  public edu.zstu.mijazz.lomboklearn.entity.Contact<span class="o">()</span><span class="p">;</span>    / <span class="c"># 不是Lombok的 </span>
  public java.lang.Long getContactId<span class="o">()</span><span class="p">;</span>
  public java.lang.String getFamilyName<span class="o">()</span><span class="p">;</span>
  public java.lang.String getGivenName<span class="o">()</span><span class="p">;</span>
  public java.lang.String getMobileNum<span class="o">()</span><span class="p">;</span>
  public java.util.Date getBirthDay<span class="o">()</span><span class="p">;</span>
  public void setContactId<span class="o">(</span>java.lang.Long<span class="o">)</span><span class="p">;</span>
  public void setFamilyName<span class="o">(</span>java.lang.String<span class="o">)</span><span class="p">;</span>
  public void setGivenName<span class="o">(</span>java.lang.String<span class="o">)</span><span class="p">;</span>
  public void setMobileNum<span class="o">(</span>java.lang.String<span class="o">)</span><span class="p">;</span>
  public void setBirthDay<span class="o">(</span>java.util.Date<span class="o">)</span><span class="p">;</span>
  public boolean equals<span class="o">(</span>java.lang.Object<span class="o">)</span><span class="p">;</span>
  protected boolean canEqual<span class="o">(</span>java.lang.Object<span class="o">)</span><span class="p">;</span>
  public int hashCode<span class="o">()</span><span class="p">;</span>
  public java.lang.String toString<span class="o">()</span><span class="p">;</span>
<span class="o">}</span>

</pre></table></code></div></div><p>可以看到<code class="language-plaintext highlighter-rouge">lombok</code>注入的方法是可以通过反编译类看到的, 如果你想看到更详细的类内步骤, 可以用<code class="language-plaintext highlighter-rouge">IntelliJ IDEA</code>打开反编译.</p><blockquote><p>这里额外提一下, <code class="language-plaintext highlighter-rouge">@Data</code>不会注入无参Constructor, 这里之所以有无参构造器, 是因为JDK自动会根据其超类-Object自动创建, 这个在Java文档<a href="https://docs.oracle.com/javase/tutorial/java/javaOO/constructors.html">Constructor</a>中有提到.</p><p>如果需要自定义一个属于自己的类的无参构造器, 你需要<code class="language-plaintext highlighter-rouge">@NoArgsConstructor</code>.</p></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>You don't have to provide any constructors for your class, but you must be careful when doing this. The compiler automatically provides a no-argument, default constructor for any class without constructors. This default constructor will call the no-argument constructor of the superclass. In this situation, the compiler will complain if the superclass doesn't have a no-argument constructor so you must verify that it does. If your class has no explicit superclass, then it has an implicit superclass of Object, which does have a no-argument constructor
</pre></table></code></div></div><h2 id="raising-another-question">Raising Another Question<a href="#raising-another-question" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>既然解决了<code class="language-plaintext highlighter-rouge">javac</code>的问题, 那另一个问题, javac是编译时是有AST的, 也就是<code class="language-plaintext highlighter-rouge">Abstract Syntax Tree</code>.</p><p>反编译出来的文件中存在Lombok加入的方法, 那么在编译时, 这些方法就会有对应的AST节点.</p><p>如果能够把注入前的AST通过静态代码抽象出来, 若静态代码的AST树不包含这些新加入方法的AST节点, 那么就可以判定Lombok的确是在编译时通过修改并补全AST来实现字节码更改的.</p><p>引入<code class="language-plaintext highlighter-rouge">javaparser</code>的Maven依赖</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.github.javaparser<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>javaparser-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.18.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></table></code></div></div><p>写一个简单的工具类</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavacCompileUtil</span> <span class="o">{</span>
    <span class="nd">@SneakyThrows</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">CompilationUnit</span> <span class="n">compilationUnit</span> <span class="o">=</span>
                <span class="nc">StaticJavaParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"$$CHANGE HERE TO CLASS FILE PATH"</span><span class="o">));</span>
        <span class="nc">YamlPrinter</span> <span class="n">yamlPrinter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">YamlPrinter</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">yamlPrinter</span><span class="o">.</span><span class="na">output</span><span class="o">(</span><span class="n">compilationUnit</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-yaml highlighter-rouge"><div class="code-header"> <span label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
</pre><td class="rouge-code"><pre><span class="nn">---</span>
<span class="na">root(Type=CompilationUnit)</span><span class="pi">:</span> 
    <span class="na">packageDeclaration(Type=PackageDeclaration)</span><span class="pi">:</span> 
        <span class="na">name(Type=Name)</span><span class="pi">:</span> 
            <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">entity"</span>
            <span class="na">qualifier(Type=Name)</span><span class="pi">:</span> 
                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">lomboklearn"</span>
                <span class="na">qualifier(Type=Name)</span><span class="pi">:</span> 
                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mijazz"</span>
                    <span class="na">qualifier(Type=Name)</span><span class="pi">:</span> 
                        <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">zstu"</span>
                        <span class="na">qualifier(Type=Name)</span><span class="pi">:</span> 
                            <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">edu"</span>
    <span class="na">imports</span><span class="pi">:</span> 
        <span class="pi">-</span> <span class="na">import(Type=ImportDeclaration)</span><span class="pi">:</span> 
            <span class="na">isAsterisk</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="na">isStatic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="na">name(Type=Name)</span><span class="pi">:</span> 
                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Data"</span>
                <span class="na">qualifier(Type=Name)</span><span class="pi">:</span> 
                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">lombok"</span>
        <span class="pi">-</span> <span class="na">import(Type=ImportDeclaration)</span><span class="pi">:</span> 
            <span class="na">isAsterisk</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="na">isStatic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="na">name(Type=Name)</span><span class="pi">:</span> 
                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">NoArgsConstructor"</span>
                <span class="na">qualifier(Type=Name)</span><span class="pi">:</span> 
                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">lombok"</span>
        <span class="pi">-</span> <span class="na">import(Type=ImportDeclaration)</span><span class="pi">:</span> 
            <span class="na">isAsterisk</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="na">isStatic</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="na">name(Type=Name)</span><span class="pi">:</span> 
                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Date"</span>
                <span class="na">qualifier(Type=Name)</span><span class="pi">:</span> 
                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">util"</span>
                    <span class="na">qualifier(Type=Name)</span><span class="pi">:</span> 
                        <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">java"</span>
    <span class="na">types</span><span class="pi">:</span> 
        <span class="pi">-</span> <span class="na">type(Type=ClassOrInterfaceDeclaration)</span><span class="pi">:</span> 
            <span class="na">isInterface</span><span class="pi">:</span> <span class="s2">"</span><span class="s">false"</span>
            <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Contact"</span>
            <span class="na">comment(Type=JavadocComment)</span><span class="pi">:</span> 
                <span class="na">content</span><span class="pi">:</span> <span class="s2">"</span><span class="se">\r\n</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">@Time</span><span class="nv"> </span><span class="s">2020-12-09</span><span class="nv"> </span><span class="s">3:54</span><span class="nv"> </span><span class="s">PM</span><span class="se">\r\n</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">@Author</span><span class="nv"> </span><span class="s">MijazzChan</span><span class="se">\r\n</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">Lombok</span><span class="nv"> </span><span class="s">Learn</span><span class="nv"> </span><span class="s">package,</span><span class="nv"> </span><span class="s">ENTITY</span><span class="nv"> </span><span class="s">class,</span><span class="nv"> </span><span class="s">class{Contact}</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">person</span><span class="se">\r\n</span><span class="nv"> </span><span class="s">"</span>
            <span class="na">members</span><span class="pi">:</span> 
                <span class="pi">-</span> <span class="na">member(Type=FieldDeclaration)</span><span class="pi">:</span> 
                    <span class="na">modifiers</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">modifier(Type=Modifier)</span><span class="pi">:</span> 
                            <span class="na">keyword</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PRIVATE"</span>
                    <span class="na">variables</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">variable(Type=VariableDeclarator)</span><span class="pi">:</span> 
                            <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">contactId"</span>
                            <span class="na">type(Type=ClassOrInterfaceType)</span><span class="pi">:</span> 
                                <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Long"</span>
                <span class="pi">-</span> <span class="na">member(Type=FieldDeclaration)</span><span class="pi">:</span> 
                    <span class="na">modifiers</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">modifier(Type=Modifier)</span><span class="pi">:</span> 
                            <span class="na">keyword</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PRIVATE"</span>
                    <span class="na">variables</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">variable(Type=VariableDeclarator)</span><span class="pi">:</span> 
                            <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">familyName"</span>
                            <span class="na">type(Type=ClassOrInterfaceType)</span><span class="pi">:</span> 
                                <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">String"</span>
                <span class="pi">-</span> <span class="na">member(Type=FieldDeclaration)</span><span class="pi">:</span> 
                    <span class="na">modifiers</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">modifier(Type=Modifier)</span><span class="pi">:</span> 
                            <span class="na">keyword</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PRIVATE"</span>
                    <span class="na">variables</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">variable(Type=VariableDeclarator)</span><span class="pi">:</span> 
                            <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">givenName"</span>
                            <span class="na">type(Type=ClassOrInterfaceType)</span><span class="pi">:</span> 
                                <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">String"</span>
                <span class="pi">-</span> <span class="na">member(Type=FieldDeclaration)</span><span class="pi">:</span> 
                    <span class="na">modifiers</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">modifier(Type=Modifier)</span><span class="pi">:</span> 
                            <span class="na">keyword</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PRIVATE"</span>
                    <span class="na">variables</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">variable(Type=VariableDeclarator)</span><span class="pi">:</span> 
                            <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">mobileNum"</span>
                            <span class="na">type(Type=ClassOrInterfaceType)</span><span class="pi">:</span> 
                                <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">String"</span>
                <span class="pi">-</span> <span class="na">member(Type=FieldDeclaration)</span><span class="pi">:</span> 
                    <span class="na">modifiers</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">modifier(Type=Modifier)</span><span class="pi">:</span> 
                            <span class="na">keyword</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PRIVATE"</span>
                    <span class="na">variables</span><span class="pi">:</span> 
                        <span class="pi">-</span> <span class="na">variable(Type=VariableDeclarator)</span><span class="pi">:</span> 
                            <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">birthDay"</span>
                            <span class="na">type(Type=ClassOrInterfaceType)</span><span class="pi">:</span> 
                                <span class="na">name(Type=SimpleName)</span><span class="pi">:</span> 
                                    <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Date"</span>
            <span class="na">modifiers</span><span class="pi">:</span> 
                <span class="pi">-</span> <span class="na">modifier(Type=Modifier)</span><span class="pi">:</span> 
                    <span class="na">keyword</span><span class="pi">:</span> <span class="s2">"</span><span class="s">PUBLIC"</span>
            <span class="na">annotations</span><span class="pi">:</span> 
                <span class="pi">-</span> <span class="na">annotation(Type=MarkerAnnotationExpr)</span><span class="pi">:</span> 
                    <span class="na">name(Type=Name)</span><span class="pi">:</span> 
                        <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Data"</span>
                <span class="pi">-</span> <span class="na">annotation(Type=MarkerAnnotationExpr)</span><span class="pi">:</span> 
                    <span class="na">name(Type=Name)</span><span class="pi">:</span> 
                        <span class="na">identifier</span><span class="pi">:</span> <span class="s2">"</span><span class="s">NoArgsConstructor"</span>
<span class="nn">...</span>
</pre></table></code></div></div><p>可以很清楚的看到, 在针对<code class="language-plaintext highlighter-rouge">Contact.java</code>的AST树中, 并不存在有关Lombok注入方法的节点.</p><h2 id="back-to-documentation">Back to Documentation<a href="#back-to-documentation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>通过了解AST在<code class="language-plaintext highlighter-rouge">javac</code>里的作用后, 几乎可以确定Lombok是编译时通过修改AST树并补全相应节点, 来实现方法的注入的.</p><p>即 <code class="language-plaintext highlighter-rouge">Source ClassFile</code> -&gt; <code class="language-plaintext highlighter-rouge">Parse</code> -&gt; <code class="language-plaintext highlighter-rouge">AST</code> -&gt; <code class="language-plaintext highlighter-rouge">Handle Annotation</code> -&gt; <code class="language-plaintext highlighter-rouge">Call/Find Annotation Handler</code> -&gt; <code class="language-plaintext highlighter-rouge">Lombok Annotation Processor - handle/modify AST</code> -&gt; <code class="language-plaintext highlighter-rouge">Analyze/Fill AST node</code> -&gt; <code class="language-plaintext highlighter-rouge">New/Modified AST </code> -&gt; <code class="language-plaintext highlighter-rouge">Byte Code</code></p><p><img data-src="https://openjdk.java.net/groups/compiler/doc/compilation-overview/javac-flow.png" alt="Java Compile Process" data-proofer-ignore></p><p>上述编译过程中, Lombok对应的即是<code class="language-plaintext highlighter-rouge">Annotation Processing</code>这一步. 详细可以参考<code class="language-plaintext highlighter-rouge">JSR-269</code></p><p>同时也在<a href="https://github.com/rzwitserloot/lombok/blob/master/src/utils/lombok/javac/JavacTreeMaker.java">src/utils/lombok/javac/JavacTreeMaker.java</a>找到了相应对AST进行操作的代码.</p><p><strong>至于为什么在Lombok下搜索<code class="language-plaintext highlighter-rouge">Processor</code>会出现多个Annotation Processor相关的类呢, 官网也给出了解释.</strong></p><ul><li><code class="language-plaintext highlighter-rouge">src/core/lombok/core/AnnotationProcessor.java</code><li><code class="language-plaintext highlighter-rouge">src/core/lombok/javac/apt/Processor.java</code><li><code class="language-plaintext highlighter-rouge">src/core/lombok/javac/apt/LombokProcessor.java</code><li><code class="language-plaintext highlighter-rouge">src/launch/lombok/launch/AnnotationProcessor.java</code></ul><p><code class="language-plaintext highlighter-rouge">lombok.launch.AnnotationProcessorHider$AnnotationProcessor</code>作为入口, 被javac在执行<code class="language-plaintext highlighter-rouge">Annotation Processing</code>这一步拉起. 它将被实例化并且执行<code class="language-plaintext highlighter-rouge">init()</code>. 它会开始寻找lombok的Jar File, 注: 这里的Jar包并不是<code class="language-plaintext highlighter-rouge">.jar</code>结尾的, 而是<code class="language-plaintext highlighter-rouge">.SCL.lombok</code>, 并且通过ClassLoader开始加载lombok的core包.</p><p><code class="language-plaintext highlighter-rouge">lombok.core.AnnotationProcessor</code>会是接下来core中先执行的类, 它也是一个入口类. 它根据运行环境是否是javac或者是eclipse ecj, 来选择对应的<code class="language-plaintext highlighter-rouge">Annotation Processor</code>来进一步处理.</p><p>最终<code class="language-plaintext highlighter-rouge">lombok.javac.apt.LombokProcessor</code>才是操作并处理注入的<code class="language-plaintext highlighter-rouge">Annotation Processor</code>.</p><p><strong>同时你在Jar File处看不到Lombok的源码也有其原因的</strong></p><p>书写代码时, IDE会根据Jar包中索引到的类对你进行代码提示, 但是由于Lombok工程的特殊性, 你只需要在编译时需要其Jar包的依赖.</p><p>对于未编译层面的Java语句来说, 如果包在这个层级可见, 会在代码提示中或索引里增加很多你可能不需要的类.</p><p>所以Lombok类在<code class="language-plaintext highlighter-rouge">Java-the-language</code>是不可见的, 但在<code class="language-plaintext highlighter-rouge">Java-the-JVM</code>是可见的.</p><p>同时上面也说到<code class="language-plaintext highlighter-rouge">lombok.launch</code>作为入口处, 其寻找<code class="language-plaintext highlighter-rouge">.SCL.lombok</code>结尾的包, 使用ClassLoader运行时才加载, 这种反常规甚至奇妙的方式(官方用的convoluted trick)也可以避免其被索引所带来的麻烦.</p><blockquote><p>https://projectlombok.org/contributing/lombok-execution-path</p><p>With <code class="language-plaintext highlighter-rouge">javac</code> (and netbeans, maven, gradle, and most other build systems), lombok runs as an annotation processor.</p><p>Lombok is on the classpath, and <code class="language-plaintext highlighter-rouge">javac</code> will load every <code class="language-plaintext highlighter-rouge">META-INF/services/javax.annotation.processing.Processor</code> file on the classpath it can find, reading each line and loading that class, then executing it as an annotation processor. <code class="language-plaintext highlighter-rouge">lombok.jar</code> has this file, it lists <code class="language-plaintext highlighter-rouge">lombok.launch.AnnotationProcessorHider$AnnotationProcessor</code> as entry.</p><p>This class is not actually visible (it is public, but its outer class (<code class="language-plaintext highlighter-rouge">AnnotationProcessorHider</code>) is package private, making it invisible to java-the-language), however, it is considered visible for the purposes of java-the-VM and therefore it will run. This convoluted trick is used to ensure that anybody who develops with lombok on the classpath doesn’t get lombok’s classes or lombok’s dependencies injected into their ‘namespace’ (for example, if you add lombok to your project, your IDE will <em>not</em> start suggesting lombok classes for auto-complete dialogs).</p><p>The <code class="language-plaintext highlighter-rouge">lombok.launch.AnnotationProcessorHider$AnnotationProcessor</code> class is loaded by <code class="language-plaintext highlighter-rouge">javac</code>, instantiated, and <code class="language-plaintext highlighter-rouge">init()</code> is called on it. This class starts lombok’s <code class="language-plaintext highlighter-rouge">ShadowClassLoader</code>; it finds the jar file it is in, then will start loading classes from this jar file. It looks not for files ending in <code class="language-plaintext highlighter-rouge">.class</code> like normal loaders, it looks for files ending in <code class="language-plaintext highlighter-rouge">.SCL.lombok</code> instead (this too is for the purpose of hiding lombok’s classes from IDEs and such). Via this classloader, the <em>real</em> annotation processor is launched, which is class <code class="language-plaintext highlighter-rouge">lombok.core.AnnotationProcessor</code>.</p><p>The <code class="language-plaintext highlighter-rouge">lombok.core.AnnotationProcessor</code> is also a delegating processor. It can delegate to one of 2 sub-processors based on the environment lombok finds itself in: If it’s javac, class <code class="language-plaintext highlighter-rouge">lombok.javac.apt.LombokProcessor</code> is used (and if the plexus compiler framework is used, which can be the case when compiling with javac, some extra code runs to patch lombok into its modular classloading architecture). If it’s ecj (eclipse’s compiler, which means we’re either running inside eclipse itself, or being invoked as annotation processor for ecj, the standalone eclipse compiler), errors/warnings are injected into the compilation process to tell the user they should use different parameters to <a href="https://projectlombok.org/setup/ecj">use lombok in eclipse/ecj</a>.</p><p><code class="language-plaintext highlighter-rouge">lombok.javac.apt.LombokProcessor</code> is the ‘real’ annotation processor that does the work of transforming your code.</p></blockquote></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a>, <a href='/categories/design/'>Design</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/lombok/" class="post-tag no-text-decoration" >lombok</a> <a href="/tags/ast/" class="post-tag no-text-decoration" >ast</a> <a href="/tags/reflection/" class="post-tag no-text-decoration" >reflection</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://telegram.me/share?text=Try Understanding Lombok - Mijazz Chan&url=https://mijazzchan.github.io/posts/Try-Understanding-Lombok/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://twitter.com/intent/tweet?text=Try Understanding Lombok - Mijazz Chan&url=https://mijazzchan.github.io/posts/Try-Understanding-Lombok/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://mijazzchan.github.io/posts/Try-Understanding-Lombok/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Try Understanding Lombok - Mijazz Chan&url=https://mijazzchan.github.io/posts/Try-Understanding-Lombok/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Documentation-for-cloudflare-ddns-edgeos/">Documentation for cloudflare-ddns-edgeos</a><li><a href="/posts/Utility-Functions-While-Leetcoding/">Some Utility Functions While Leetcoding</a><li><a href="/posts/Store-Multiple-Booleans-Using-Byte/">Store Multiple Booleans Using Single Variable</a><li><a href="/posts/Decision-Tree-Wine-Classification/">Decision Tree Wine Classification</a><li><a href="/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/">From Spring Boot Bean Validation to Python Wrapper</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/annotation/">annotation</a> <a class="post-tag" href="/tags/code/">code</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/pandas/">pandas</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Validate-Object-Using-Reflection-Inspired-by-Spring/"><div class="card-body"> <em class="timeago small" date="2021-06-06 15:15:27 +0800" >Jun 6, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Validate Object Using Reflection Inspired by Spring</h3><div class="text-muted small"><p> Inspired by Spring’s excellent dependency injection way of handling bean validation, after reading some official java documentations and Spring Docs, I decided to find a way of achieving the purpos...</p></div></div></a></div><div class="card"> <a href="/posts/Store-Multiple-Booleans-Using-Byte/"><div class="card-body"> <em class="timeago small" date="2021-04-18 17:14:49 +0800" >Apr 18, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Store Multiple Booleans Using Single Variable</h3><div class="text-muted small"><p> Intro Inspired by a stackoverflow answer which is more than a decade old. StackOverflow-Answer1, StackOverflow - Answer2 @Jon Skeet there provide a way of measuring how much memory do byte, int a...</p></div></div></a></div><div class="card"> <a href="/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/"><div class="card-body"> <em class="timeago small" date="2021-06-03 12:59:54 +0800" >Jun 3, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>From Spring Boot Bean Validation to Python Wrapper</h3><div class="text-muted small"><p> Keywords in this post are as follows. Spring Boot Bean Validation JSR-303/349/380: Bean Validation Related Topic JSR Java Annotation Processing Custom Annotation Java Reflection API (ja...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Code-Scoping-in-Data-Practicing/" class="btn btn-outline-primary" prompt="Older"><p>Code Scoping in Data Practicing</p></a> <a href="/posts/SpringBoot-Scala-Spark-Dependency-Problem/" class="btn btn-outline-primary" prompt="Newer"><p>SpringBoot Scala Spark Co-Develop Dependency Problem</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/MijazzChan">Mijazz Chan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/annotation/">annotation</a> <a class="post-tag" href="/tags/code/">code</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/pandas/">pandas</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
