<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Test Drive Spark/Hadoop using Chicago Crime Data" /><meta name="author" content="MijazzChan" /><meta property="og:locale" content="en" /><meta name="description" content="Data Practicing-EP0" /><meta property="og:description" content="Data Practicing-EP0" /><link rel="canonical" href="https://mijazzchan.github.io/posts/Test-Drive-Spark-Hadoop-using-Chicago-Crime-Data/" /><meta property="og:url" content="https://mijazzchan.github.io/posts/Test-Drive-Spark-Hadoop-using-Chicago-Crime-Data/" /><meta property="og:site_name" content="Mijazz Chan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-25T17:04:39+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Test Drive Spark/Hadoop using Chicago Crime Data" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@MijazzChan" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"MijazzChan"},"headline":"Test Drive Spark/Hadoop using Chicago Crime Data","dateModified":"2020-11-25T17:04:39+08:00","datePublished":"2020-11-25T17:04:39+08:00","description":"Data Practicing-EP0","url":"https://mijazzchan.github.io/posts/Test-Drive-Spark-Hadoop-using-Chicago-Crime-Data/","mainEntityOfPage":{"@type":"WebPage","@id":"https://mijazzchan.github.io/posts/Test-Drive-Spark-Hadoop-using-Chicago-Crime-Data/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>Test Drive Spark/Hadoop using Chicago Crime Data | Mijazz Chan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Mijazz Chan"><meta name="application-name" content="Mijazz Chan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatars/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Mijazz Chan</a></div><div class="site-subtitle font-italic">Code with Passion</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/MijazzChan" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/%E9%99%88%E6%B5%A9%E9%AA%8F-mijazz/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mijazz','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Test Drive Spark/Hadoop using Chicago Crime Data</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Test Drive Spark/Hadoop using Chicago Crime Data</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/MijazzChan">Mijazz Chan</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2020-11-25 17:04:39 +0800" data-toggle="tooltip" data-placement="bottom" title="Wed, Nov 25, 2020, 5:04 PM +0800" >Nov 25, 2020</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="14477 words"> <em>80 min</em> read</span></div></div></div><div class="post-content"><h1 id="data-practicing-ep0">Data Practicing-EP0</h1><h2 id="before-you-read-this">Before You Read This<a href="#before-you-read-this" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>该文只是一门课程<code class="language-plaintext highlighter-rouge">数据挖掘</code>的大作业记录文, 并不是教程式文章.</p><h2 id="why-this-topic">Why This Topic?<a href="#why-this-topic" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>看了很多人写的技术博客, 发现许多都是基于<code class="language-plaintext highlighter-rouge">Pseudo-Distributed Mode</code>或者<code class="language-plaintext highlighter-rouge">Fully-Distributed Mode</code>. 这两种模式因为资源问题我也只成功搭建并使用过前者, 当时在<code class="language-plaintext highlighter-rouge">Windows10</code>上拖着一个<code class="language-plaintext highlighter-rouge">CentOS8</code>的虚拟机, 因为数据集就快<code class="language-plaintext highlighter-rouge">2GB</code>大小, 一套下来发现虚拟机吃的内存快接近<code class="language-plaintext highlighter-rouge">7G</code>.</p><p><del>又想试试YARN又不想做多机分布式, 那就做单机YARN</del> 关于YARN:官方的也很简明易懂 <a href="https://hadoop.apache.org/docs/r3.1.4/hadoop-yarn/hadoop-yarn-site/YARN.html">Apache Hadoop YARN</a></p><p>毕竟数据集只是几G, python直接上pandas套装估计会更方便.</p><p>抱着入门一下这个技术栈, 完成一下大作业和想拥抱一下Arch社区的心态, 在使用过<code class="language-plaintext highlighter-rouge">LinuxMint</code>和<code class="language-plaintext highlighter-rouge">Fedora</code>的我换到了<code class="language-plaintext highlighter-rouge">Manjaro Linux 20</code>.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~  screenfetch

 ██████████████████  ████████     mijazz@lenovo
 ██████████████████  ████████     OS: Manjaro 20.2 Nibia
 ██████████████████  ████████     Kernel: x86_64 Linux 5.8.18-1-MANJARO
 ██████████████████  ████████     Uptime: 16m
 ████████            ████████     Packages: 1239
 ████████  ████████  ████████     Shell: zsh 5.8
 ████████  ████████  ████████     Resolution: 1920x1080
 ████████  ████████  ████████     DE: KDE 5.76.0 / Plasma 5.20.3
 ████████  ████████  ████████     WM: KWin
 ████████  ████████  ████████     GTK Theme: Breath <span class="o">[</span>GTK2/3]
 ████████  ████████  ████████     Icon Theme: breath2-dark
 ████████  ████████  ████████     Disk: 18G / 102G <span class="o">(</span>19%<span class="o">)</span>
 ████████  ████████  ████████     CPU: Intel Core i5-7300HQ @ 4x 3.5GHz <span class="o">[</span>45.0°C]
 ████████  ████████  ████████     GPU: GeForce GTX 1050
                                  RAM: 2880MiB / 15904MiB
 mijazz@lenovo  ~  <span class="nb">uname</span> <span class="nt">-a</span>   
Linux lenovo 5.8.18-1-MANJARO <span class="c">#1 SMP PREEMPT Sun Nov 1 14:10:04 UTC 2020 x86_64 GNU/Linux</span>
</pre></table></code></div></div><h2 id="prerequisite">Prerequisite<a href="#prerequisite" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><p>Java - OpenJDK8</p><blockquote><p>为了避免奇怪的兼容性问题, 根据<code class="language-plaintext highlighter-rouge">Hadoop</code>官方的<code class="language-plaintext highlighter-rouge">wiki</code>, 其推荐版本是8, 并且更高版本的<code class="language-plaintext highlighter-rouge">Hadoop</code>支持11. 同时明确指明了<code class="language-plaintext highlighter-rouge">OpenJDK8</code>是官方用于其编译的版本. 此处参考: <a href="https://cwiki.apache.org/confluence/display/HADOOP/Hadoop+Java+Versions">cwiki-Apache</a></p></blockquote><p>这里给出<code class="language-plaintext highlighter-rouge">AdoptOpenJDK8</code>的地址</p><blockquote><p>Redhat的, OpenJDK自编译的, 又或者来自<code class="language-plaintext highlighter-rouge">Pacman</code>包管理的都应该不成问题.</p><p>但是我在<code class="language-plaintext highlighter-rouge">CentOS8</code>上首次尝试<code class="language-plaintext highlighter-rouge">Hadoop</code>的时候, <code class="language-plaintext highlighter-rouge">conf</code>里也要多配置一次<code class="language-plaintext highlighter-rouge">$JAVA_HOME</code>有点奇怪</p></blockquote><p><a href="https://github.com/AdoptOpenJDK/openjdk8-binaries/releases/download/jdk8u275-b01/OpenJDK8U-jdk_x64_linux_hotspot_8u275b01.tar.gz">Official URL</a></p><p><a href="https://mirrors.tuna.tsinghua.edu.cn/AdoptOpenJDK/8/jdk/x64/linux/">清华tuna镜像</a></p><li><p>Hadoop - Hadoop 3.1.4 Tarball</p><p><a href="https://www.apache.org/dyn/closer.cgi/hadoop/common">Official URL</a></p><p><a href="https://mirrors.aliyun.com/apache/hadoop/common/hadoop-3.1.4/hadoop-3.1.4.tar.gz">Aliyun Mirrors</a></p><li><p>Spark - Spark 2.4.7 Tarball</p><p>选<code class="language-plaintext highlighter-rouge"> Pre-built with user-provided Apache Hadoop </code> 因采用<code class="language-plaintext highlighter-rouge">YARN</code>部署</p><p><a href="https://www.apache.org/dyn/closer.lua/spark/spark-2.4.7">Official URL</a></p><p><a href="https://mirrors.aliyun.com/apache/spark/spark-2.4.7/spark-2.4.7-bin-without-hadoop.tgz">Aliyun Mirrors</a></p></ul><h2 id="prepare-environment">Prepare Environment<a href="#prepare-environment" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="extract-jdk">Extract JDK<a href="#extract-jdk" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>mijazz@lenovo  ~/devEnvs  ll <span class="nt">-a</span>
total 100M
drwxr-xr-x  6 mijazz mijazz 4.0K Nov 25 15:23 <span class="nb">.</span>
drwx------ 36 mijazz mijazz 4.0K Nov 25 15:24 ..
<span class="nt">-rw-r--r--</span>  1 mijazz mijazz 100M Nov 24 15:20 OpenJDK8U-jdk_x64_linux_hotspot_8u275b01.tar.gz

mijazz@lenovo  ~/devEnvs  <span class="nb">tar</span> <span class="nt">-xf</span> ./OpenJDK8U<span class="k">*</span>.tar.gz                      
mijazz@lenovo  ~/devEnvs  <span class="nb">mv</span> ./jdk8u275-b01 ./OpenJDK8
mijazz@lenovo  ~/devEnvs  <span class="nb">rm</span> ./OpenJDK8U<span class="k">*</span>.tar.gz                           
mijazz@lenovo  ~/devEnvs  ll <span class="nt">-a</span>
total 28K
drwxr-xr-x  7 mijazz mijazz 4.0K Nov 25 15:28 <span class="nb">.</span>
drwx------ 36 mijazz mijazz 4.0K Nov 25 15:28 ..
drwxr-xr-x  8 mijazz mijazz 4.0K Nov  9 20:23 OpenJDK8
</pre></table></code></div></div><h3 id="configure-path">Configure $PATH<a href="#configure-path" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>我使用的是<code class="language-plaintext highlighter-rouge">zsh</code>, 并且不索引<code class="language-plaintext highlighter-rouge">bashrc</code>. 虽然到时候我会在主shell里启动, 但是不保证他会不会在某些部件里调用bash.</p><p>我就把环境变量同时加进<code class="language-plaintext highlighter-rouge">~/.bashrc</code>和<code class="language-plaintext highlighter-rouge">~/.zshrc</code>里了.</p><p>如果你是使用<code class="language-plaintext highlighter-rouge">bash</code>, 只需加进<code class="language-plaintext highlighter-rouge">~/.bashrc</code>, 记得<code class="language-plaintext highlighter-rouge">source</code>或重启shell生效.</p></blockquote><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'# Java Environment Variable'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'export JAVA_HOME="/home/mijazz/devEnvs/OpenJDK8"'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'export JRE_HOME="${JAVA_HOME}/jre"'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'export CLASSPATH=".:${JAVA_HOME}/lib:${JRE_HOME}/lib"'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s1">'export PATH="${JAVA_HOME}/bin:$PATH"'</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="c"># Only if u r using zsh</span>
<span class="nb">echo</span> <span class="s1">'# Java Environment Variable'</span> <span class="o">&gt;&gt;</span> ~/.zshrc
<span class="nb">echo</span> <span class="s1">'export JAVA_HOME="/home/mijazz/devEnvs/OpenJDK8"'</span> <span class="o">&gt;&gt;</span> ~/.zshrc
<span class="nb">echo</span> <span class="s1">'export JRE_HOME="${JAVA_HOME}/jre"'</span> <span class="o">&gt;&gt;</span> ~/.zshrc
<span class="nb">echo</span> <span class="s1">'export CLASSPATH=".:${JAVA_HOME}/lib:${JRE_HOME}/lib"'</span> <span class="o">&gt;&gt;</span> ~/.zshrc
<span class="nb">echo</span> <span class="s1">'export PATH="${JAVA_HOME}/bin:$PATH"'</span> <span class="o">&gt;&gt;</span> ~/.zshrc
</pre></table></code></div></div><h3 id="verify-configuration">Verify Configuration<a href="#verify-configuration" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~  <span class="nb">echo</span> <span class="nv">$JAVA_HOME</span>
/home/mijazz/devEnvs/OpenJDK8
 mijazz@lenovo  ~  java <span class="nt">-version</span>  
openjdk version <span class="s2">"1.8.0_275"</span>
OpenJDK Runtime Environment <span class="o">(</span>AdoptOpenJDK<span class="o">)(</span>build 1.8.0_275-b01<span class="o">)</span>
OpenJDK 64-Bit Server VM <span class="o">(</span>AdoptOpenJDK<span class="o">)(</span>build 25.275-b01, mixed mode<span class="o">)</span>
</pre></table></code></div></div><h3 id="ssh-sshdservice">SSH, sshd.service<a href="#ssh-sshdservice" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p><a href="https://hadoop.apache.org/docs/r3.1.4/hadoop-project-dist/hadoop-common/SingleCluster.html">Hadoop: Setting up a Single Node Cluster.</a></p><p>ssh must be installed and sshd must be running to use the Hadoop scripts that manage remote Hadoop daemons if the optional start and stop scripts are to be used.</p></blockquote><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~  ssh localhost
ssh: connect to host localhost port 22: Connection refused
 mijazz@lenovo  ~  systemctl status sshd
● sshd.service - OpenSSH Daemon
     Loaded: loaded <span class="o">(</span>/usr/lib/systemd/system/sshd.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
     Active: inactive <span class="o">(</span>dead<span class="o">)</span>
</pre></table></code></div></div><p>明显没开, 配置一下sshd和限制root远程登录什么的, 还有只允许公匙登录什么的.</p><p>sshd_config</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>PasswordAuthentication no
PermitEmptyPasswords no
PubkeyAuthentication yes
PermitRootLogin no
</pre></table></code></div></div><p>权限记得设<code class="language-plaintext highlighter-rouge">0600</code>, Unix/Linux对这类权限要求很严格.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-b</span> 4096
<span class="nb">cat</span> ~/.ssh/id_rsa.pub <span class="o">&gt;&gt;</span> ~/.ssh/authorized_keys
<span class="nb">chmod </span>600 ~/.ssh/authorized_keys

 mijazz@lenovo  ~  <span class="nb">sudo </span>systemctl start sshd 
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>mijazz: 
 mijazz@lenovo  ~  <span class="nb">sudo </span>systemctl <span class="nb">enable </span>sshd
Created symlink /etc/systemd/system/multi-user.target.wants/sshd.service → /usr/lib/systemd/system/sshd.service.
 mijazz@lenovo  ~  ssh localhost             
The authenticity of host <span class="s1">'localhost (::1)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:OvL0/qmZWaRDL66+wbprrEiK4XhNgo1FAU/jRoWIsc0.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>localhost<span class="s1">' (ECDSA) to the list of known hosts.
 mijazz@lenovo  ~  exit
Connection to localhost closed.
</span></pre></table></code></div></div><p>公匙免密登录就配置好了</p><h1 id="data-practicing-ep1">Data Practicing-EP1</h1><h2 id="testing-hadoop">Testing Hadoop<a href="#testing-hadoop" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>EP0中给出的<code class="language-plaintext highlighter-rouge">hadoop-3.1.4.tar.gz</code></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs  <span class="nb">tar</span> <span class="nt">-xf</span> ./hadoop-3.1.4.tar.gz
 <span class="c"># 文件结构</span>
 mijazz@lenovo  ~/devEnvs  tree <span class="nt">-L</span> 1 ./hadoop-3.1.4 
./hadoop-3.1.4
├── LICENSE.txt
├── NOTICE.txt
├── README.txt
├── bin  <span class="c"># 可执行</span>
├── etc  <span class="c"># 配置</span>
├── include  
├── lib
├── libexec
├── sbin <span class="c"># 可执行</span>
└── share

7 directories, 3 files
</pre></table></code></div></div><p>严格按着官网给出的doc配置</p><blockquote><p>Unpack the downloaded Hadoop distribution. In the distribution, edit the file etc/hadoop/hadoop-env.sh to define some parameters as follows:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  <span class="nb">export </span><span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/java/latest  <span class="c"># DO NOT ADD THIS LINE</span>
</pre></table></code></div></div><p><a href="https://hadoop.apache.org/docs/r3.1.4/hadoop-project-dist/hadoop-common/SingleCluster.html">Docs</a></p></blockquote><p>也就是让我们在<code class="language-plaintext highlighter-rouge">hadoop</code>下的配置路径下, 在加上一次JAVA_HOME的路径.</p><p><del>严格来讲<code class="language-plaintext highlighter-rouge">~/.bashrc</code> <code class="language-plaintext highlighter-rouge">~/.zshrc</code>环境下有就行</del></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'export JAVA_HOME=/home/mijazz/devEnvs/OpenJDK8'</span> <span class="o">&gt;&gt;</span> ./hadoop-3.1.4/etc/hadoop/hadoop-env.sh
</pre></table></code></div></div><p>然后启动一次<code class="language-plaintext highlighter-rouge">hadoop</code></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/hadoop-3.1.4  ./bin/hadoop
Usage: hadoop <span class="o">[</span>OPTIONS] SUBCOMMAND <span class="o">[</span>SUBCOMMAND OPTIONS]
 or    hadoop <span class="o">[</span>OPTIONS] CLASSNAME <span class="o">[</span>CLASSNAME OPTIONS]
  where CLASSNAME is a user-provided Java class

  OPTIONS is none or any of:

<span class="nt">--config</span> <span class="nb">dir                     </span>Hadoop config directory
<span class="nt">--debug</span>                          turn on shell script debug mode
...............
</pre></table></code></div></div><h2 id="configure-hadoop">Configure Hadoop<a href="#configure-hadoop" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>官方文档推荐在<code class="language-plaintext highlighter-rouge">etc/hadoop/core-site.xml</code>和<code class="language-plaintext highlighter-rouge">etc/hadoop/hdfs-site.xml</code>下各添加一个字段.</p><p>此处不表, 直接贴出上述两个文件.</p></blockquote><p><code class="language-plaintext highlighter-rouge">core-site.xml</code></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>

<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>hadoop.tmp.dir<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>/home/mijazz/devEnvs/hadoop-3.1.4/tmp<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;description&gt;</span>Abase for other temporary directories.<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>fs.defaultFS<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>hdfs://localhost:9000<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">hdfs-site.xml</code></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>

<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.replication<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>1<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.namenode.rpc-bind-host<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>0.0.0.0<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.namenode.servicerpc-bind-host<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>0.0.0.0<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.namenode.http-bind-host<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>0.0.0.0<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>dfs.namenode.https-bind-host<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>0.0.0.0<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></table></code></div></div><blockquote><p>比官网多出来的这几个字段, 方便<code class="language-plaintext highlighter-rouge">interface bind</code>. 也就是都监听.</p><p>因为之前我尝试在虚拟机<code class="language-plaintext highlighter-rouge">(CentOS8: 192.168.123.5/24, 172.16.0.2/24)</code>和宿主机<code class="language-plaintext highlighter-rouge">(Windows10: 192.168.123.2/24, 172.16.0.1/24)</code>和另一台PC<code class="language-plaintext highlighter-rouge">(CentOS7: 192.168.123.4/24, 10.100.0.2/16(OpenVPN-NAT))</code>之间尝试做分布式. 这几个选项对我的<del>恶心人的</del>网络拓扑(又是host-only, bridge, openvpn-nat)很有帮助. 官方文档<a href="https://hadoop.apache.org/docs/r3.1.4/hadoop-project-dist/hadoop-hdfs/HdfsMultihoming.html">HDFS Support for Multihomed Networks</a></p></blockquote><p>避坑环境变量</p><blockquote><p>老样子, 追加<code class="language-plaintext highlighter-rouge">~/.zshrc</code>和<code class="language-plaintext highlighter-rouge">~/.bashrc</code></p></blockquote><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">HADOOP_HOME</span><span class="o">=</span><span class="s2">"/home/mijazz/devEnvs/hadoop-3.1.4"</span>
<span class="nb">export </span><span class="nv">HADOOP_MAPRED_HOME</span><span class="o">=</span><span class="nv">$HADOOP_HOME</span> 
<span class="nb">export </span><span class="nv">HADOOP_COMMON_HOME</span><span class="o">=</span><span class="nv">$HADOOP_HOME</span> 
<span class="nb">export </span><span class="nv">HADOOP_HDFS_HOME</span><span class="o">=</span><span class="nv">$HADOOP_HOME</span> 
<span class="nb">export </span><span class="nv">YARN_HOME</span><span class="o">=</span><span class="nv">$HADOOP_HOME</span> 
<span class="nb">export </span><span class="nv">HADOOP_COMMON_LIB_NATIVE_DIR</span><span class="o">=</span><span class="nv">$HADOOP_HOME</span>/lib/native 
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HADOOP_HOME</span>/sbin:<span class="nv">$HADOOP_HOME</span>/bin 
<span class="nb">export </span><span class="nv">HADOOP_INSTALL</span><span class="o">=</span><span class="nv">$HADOOP_HOME</span> 
</pre></table></code></div></div><h2 id="configure-hdfs">Configure HDFS<a href="#configure-hdfs" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>引用一下官方文档两张简洁明了的图</p><p><a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsUserGuide.html">HDFS Docs</a></p><p><img data-src="https://hadoop.apache.org/docs/r3.1.4/hadoop-project-dist/hadoop-hdfs/images/hdfsarchitecture.png" alt="HDFS-A" data-proofer-ignore></p><p><img data-src="https://hadoop.apache.org/docs/r3.1.4/hadoop-project-dist/hadoop-hdfs/images/hdfsdatanodes.png" alt="HDFS" data-proofer-ignore></p><p>官方文档叙述的架构非常易懂.</p><p>这里只提其对用户暴露出的<code class="language-plaintext highlighter-rouge">Shell Commands</code>接口, 其命令与<code class="language-plaintext highlighter-rouge">Unix/Linux</code>默认文件系统的接口非常类似.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/hadoop-3.1.4  ./bin/hdfs dfs <span class="nt">-help</span>
</pre></table></code></div></div><p>即可获得其描述.</p><p>继续配置<code class="language-plaintext highlighter-rouge">HDFS</code></p><p>先对<code class="language-plaintext highlighter-rouge">NameNode</code>也就是<code class="language-plaintext highlighter-rouge">hdfs</code>的<code class="language-plaintext highlighter-rouge">master</code>做一下格式化</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/hadoop-3.1.4  ./bin/hdfs namenode <span class="nt">-format</span>
WARNING: /home/mijazz/devEnvs/hadoop-3.1.4/logs does not exist. Creating.
2020-11-25 23:49:55,071 INFO namenode.NameNode: STARTUP_MSG: 
/<span class="k">************************************************************</span>
STARTUP_MSG: Starting NameNode
STARTUP_MSG:   host <span class="o">=</span> lenovo/127.0.1.1
STARTUP_MSG:   args <span class="o">=</span> <span class="o">[</span><span class="nt">-format</span><span class="o">]</span>
STARTUP_MSG:   version <span class="o">=</span> 3.1.4
.............
</pre></table></code></div></div><p>然后同时启动<code class="language-plaintext highlighter-rouge">DataNode</code>和<code class="language-plaintext highlighter-rouge">NameNode</code></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/hadoop-3.1.4  ./sbin/start-dfs.sh 
Starting namenodes on <span class="o">[</span>localhost]
Starting datanodes
Starting secondary namenodes <span class="o">[</span>lenovo]
</pre></table></code></div></div><blockquote><p>这里可以看到<code class="language-plaintext highlighter-rouge">NameNode</code>和<code class="language-plaintext highlighter-rouge">DataNode</code>的主机名并不一致, 因为之前配置的ssh登录就是在这里起作用的. 因为<code class="language-plaintext highlighter-rouge">HDFS</code>主要面向集群, 也就是<code class="language-plaintext highlighter-rouge">NameNode-Master</code>和<code class="language-plaintext highlighter-rouge">DataNodes-Slaves</code>大多配置在不同的机器上, 其之间的通信都是通过ssh的. 尽管当前部署是本地单机部署, 他还是会用<code class="language-plaintext highlighter-rouge">ssh</code>和本地的<code class="language-plaintext highlighter-rouge">sshd</code>来进行沟通.</p></blockquote><p>然后访问<a href="http://localhost:9870">http://localhost:9870</a>如果看到hadoop就行.</p><h3 id="可能会遇到的坑">可能会遇到的坑<a href="#可能会遇到的坑" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>启动了上述命令, 但是访问<code class="language-plaintext highlighter-rouge">localhost:9870</code>没反映</p><p>那就尝试做一下问题定位</p><ul><li>先看看其是不是成功启动了, 用<code class="language-plaintext highlighter-rouge">jps</code>看看就行.</ul><p>发现没有<code class="language-plaintext highlighter-rouge">Java</code>进程在运行.</p><p>到<code class="language-plaintext highlighter-rouge">%HADOOP_HOME/logs</code>下找日志就行</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>2020-11-25 23:59:57,076 ERROR org.apache.hadoop.hdfs.server.datanode.DataNode: RECEIVED SIGNAL 1: SIGHUP
2020-11-25 23:59:57,076 ERROR org.apache.hadoop.hdfs.server.datanode.DataNode: RECEIVED SIGNAL 15: SIGTERM
2020-11-25 23:59:57,088 INFO org.apache.hadoop.hdfs.server.datanode.DataNode: SHUTDOWN_MSG: 
/<span class="k">************************************************************</span>
SHUTDOWN_MSG: Shutting down DataNode at lenovo/127.0.1.1
<span class="k">************************************************************</span>/
</pre></table></code></div></div><p>看到了一些奇怪的东西<code class="language-plaintext highlighter-rouge">127.0.1.1</code>. 该指向在默认的<code class="language-plaintext highlighter-rouge">hosts</code>中存在, 具体原因不表, 具体情况因<code class="language-plaintext highlighter-rouge">Linux</code>发行版而异.</p><p>看到这里, 很明显是主机名被解析到了一个不能访问到本机的ip上, 导致是<code class="language-plaintext highlighter-rouge">DataNode</code>和<code class="language-plaintext highlighter-rouge">NameNode</code>之前没心跳.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/hadoop-3.1.4/logs  <span class="nb">cat</span> /etc/hosts
<span class="c"># Host addresses</span>
127.0.0.1  localhost
127.0.1.1  lenovo     <span class="c"># Here</span>
.............
</pre></table></code></div></div><p>简单修改就行.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~  <span class="nb">cat</span> /etc/hosts
<span class="c"># Host addresses</span>
127.0.0.1  localhost
127.0.0.1  lenovo     <span class="c"># 127.0.0.1</span>
............
</pre></table></code></div></div><ul><li><p>还是启动不了, 尝试一下用<code class="language-plaintext highlighter-rouge">hadoop namenode</code>和<code class="language-plaintext highlighter-rouge">hadoop datanode</code>放在<code class="language-plaintext highlighter-rouge">shell</code>里启动. 如果此时<code class="language-plaintext highlighter-rouge">jps</code>能看到活的进程, 并且<code class="language-plaintext highlighter-rouge">curl localhost:9870</code>有返回, 后续可以尝试:</p><blockquote><p>有条件可以去读一下几个启动脚本的源码, 如果启动脚本拉起不了, 既有可能是目录权限问题或者用户权限问题.</p><p>因为官方本就推荐hadoop运行于一个独立的用户/用户组.</p></blockquote><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>stop-all.sh
hadoop-daemon.sh start namenode
hadoop-daemon.sh start datanode
</pre></table></code></div></div></ul><h2 id="configure-yarn">Configure YARN<a href="#configure-yarn" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>YARN = Yet Another Resource Negotiator</p><p>什么是YARN -&gt; <a href="https://hadoop.apache.org/docs/r3.1.4/hadoop-yarn/hadoop-yarn-site/YARN.html">YARN Architechture</a></p></blockquote><p><img data-src="https://hadoop.apache.org/docs/r3.1.4/hadoop-yarn/hadoop-yarn-site/yarn_architecture.gif" alt="YARN" data-proofer-ignore></p><p>继续贴我自己使用的配置文件</p><p><code class="language-plaintext highlighter-rouge">etc/hadoop/mapred-site.xml</code></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="cp">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>mapreduce.framework.name<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>yarn<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>mapreduce.application.classpath<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/*:$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">etc/hadoop/yarn-site.xml</code></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0"?&gt;</span>

<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.nodemanager.aux-services<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>mapreduce_shuffle<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.nodemanager.env-whitelist<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>false<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>yarn.webapp.ui2.enable<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>true<span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>

</pre></table></code></div></div><p>直接用命令拉起<code class="language-plaintext highlighter-rouge">NodeManager</code>和<code class="language-plaintext highlighter-rouge">ResourceManager</code>即可.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/hadoop-3.1.4  start-yarn.sh
</pre></table></code></div></div><h3 id="可能的坑">可能的坑<a href="#可能的坑" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>用该命令拉起尝试即可</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>yarn-daemon.sh start resourcemanager
yarn-daemon.sh start nodemanager
yarn-daemon.sh start historyserver
</pre></table></code></div></div><p>另外定位<code class="language-plaintext highlighter-rouge">%HADOOP_HOME/logs</code>下即可.</p><h2 id="有个隐藏的坑"><del>有个隐藏的坑</del><a href="#有个隐藏的坑" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>随后再更新</p><h2 id="minor-adjustment">Minor Adjustment<a href="#minor-adjustment" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>如果报<code class="language-plaintext highlighter-rouge">Unable to load native-hadoop library for your platform</code></p><p>试着执行</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs  hadoop checknative
</pre></table></code></div></div><p>如果下列是一堆<code class="language-plaintext highlighter-rouge">no</code>, 不要上百度找答案, 百度上还有说不带<code class="language-plaintext highlighter-rouge">lib</code>的.</p><p>只需要在<code class="language-plaintext highlighter-rouge">etc/hadoop/hadoop-env.sh</code>追加一个<code class="language-plaintext highlighter-rouge">JVM</code>参数就行.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">HADOOP_OPTS</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HADOOP_OPTS</span><span class="k">}</span><span class="s2"> -Djava.library.path=</span><span class="k">${</span><span class="nv">HADOOP_HOME</span><span class="k">}</span><span class="s2">/lib/native"</span>
</pre></table></code></div></div><p>随后</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/spark-2.4.7  hadoop checknative
2020-11-27 17:49:39,805 INFO bzip2.Bzip2Factory: Successfully loaded &amp; initialized native-bzip2 library system-native
2020-11-27 17:49:39,809 INFO zlib.ZlibFactory: Successfully loaded &amp; initialized native-zlib library
2020-11-27 17:49:39,817 WARN erasurecode.ErasureCodeNative: ISA-L support is not available <span class="k">in </span>your platform... using builtin-java codec where applicable
2020-11-27 17:49:39,864 INFO nativeio.NativeIO: The native code was built without PMDK support.
Native library checking:
hadoop:  <span class="nb">true</span> /home/mijazz/devEnvs/hadoop-3.1.4/lib/native/libhadoop.so.1.0.0
zlib:    <span class="nb">true</span> /usr/lib/libz.so.1
zstd  :  <span class="nb">true</span> /usr/lib/libzstd.so.1
snappy:  <span class="nb">true</span> /usr/lib/libsnappy.so.1
lz4:     <span class="nb">true </span>revision:10301
bzip2:   <span class="nb">true</span> /usr/lib/libbz2.so.1
openssl: <span class="nb">false </span>EVP_CIPHER_CTX_cleanup
ISA-L:   <span class="nb">false </span>libhadoop was built without ISA-L support
PMDK:    <span class="nb">false </span>The native code was built without PMDK support.
</pre></table></code></div></div><p>再次运行时警告就会消失.</p><h2 id="验证">验证<a href="#验证" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><img data-src="/assets/img/blog/20201127/Screenshot_20201127_171715.png" alt="Hadoop Index Page" data-proofer-ignore></p><ul><li><p>http://your.host.or.ip:9870</p><li><p>http://you.host.or.ip:8088</p><li><p><code class="language-plaintext highlighter-rouge">jps</code></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/hadoop-3.1.4  jps
2160 NameNode
7297 Jps
6084 ApplicationHistoryServer
2551 ResourceManager
2413 NodeManager
2237 DataNode
</pre></table></code></div></div></ul><h1 id="data-practicing-ep2">Data Practicing-EP2</h1><h2 id="testing-spark">Testing Spark<a href="#testing-spark" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>EP0中的spark</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs  ll <span class="nt">-a</span>
total 161M
drwxr-xr-x  8 mijazz mijazz 4.0K Nov 27 17:27 <span class="nb">.</span>
drwx------ 38 mijazz mijazz 4.0K Nov 27 17:27 ..
drwxr-xr-x  8 mijazz mijazz 4.0K Nov  9 20:23 OpenJDK8
drwxr-xr-x 11 mijazz mijazz 4.0K Nov 25 23:49 hadoop-3.1.4
<span class="nt">-rw-r--r--</span>  1 mijazz mijazz 161M Nov 24 16:49 spark-2.4.7-bin-without-hadoop.tgz
 mijazz@lenovo  ~/devEnvs  <span class="nb">tar</span> <span class="nt">-xf</span> spark-2.4.7-bin-without-hadoop.tgz 
 mijazz@lenovo  ~/devEnvs  <span class="nb">mv</span> ./spark-2.4.7-bin-without-hadoop ./spark-2.4.7                   
 mijazz@lenovo  ~/devEnvs  tree <span class="nt">-L</span> 1 ./spark-2.4.7 
./spark-2.4.7
├── LICENSE
├── NOTICE
├── R
├── README.md
├── RELEASE
├── bin
├── conf
├── data
├── examples
├── jars
├── kubernetes
├── licenses
├── python
├── sbin
└── yarn

11 directories, 4 files
</pre></table></code></div></div><h2 id="configure-spark">Configure Spark<a href="#configure-spark" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>老样子, 变量<code class="language-plaintext highlighter-rouge">~/.zshrc</code>, <code class="language-plaintext highlighter-rouge">~/.bashrc</code></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c"># Spark Environment Variable</span>
<span class="nb">export </span><span class="nv">SPARK_HOME</span><span class="o">=</span><span class="s2">"/home/mijazz/devEnvs/spark-2.4.7"</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PATH</span><span class="s2">:</span><span class="k">${</span><span class="nv">SPARK_HOME</span><span class="k">}</span><span class="s2">/bin:</span><span class="k">${</span><span class="nv">SPARK_HOME</span><span class="k">}</span><span class="s2">/sbin"</span>
<span class="nb">export </span><span class="nv">HADOOP_CONF_DIR</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">HADOOP_HOME</span><span class="k">}</span><span class="s2">/etc/hadoop"</span>
<span class="nb">export </span><span class="nv">SPARK_DIST_CLASSPATH</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span>hadoop classpath<span class="si">)</span><span class="s2">"</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">spark</code>下也有<code class="language-plaintext highlighter-rouge">conf</code>, 看一眼</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/spark-2.4.7  tree ./conf
./conf
├── docker.properties.template
├── fairscheduler.xml.template
├── log4j.properties.template
├── metrics.properties.template
├── slaves.template
├── spark-defaults.conf.template
└── spark-env.sh.template

0 directories, 7 files
</pre></table></code></div></div><p>这些<code class="language-plaintext highlighter-rouge">template</code>里面都写着<code class="language-plaintext highlighter-rouge">spark</code>的默认配置.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/spark-2.4.7  cat ./conf/spark-defaults.conf.template 
# ...

# Example:
# spark.master                     spark://master:7077
# spark.eventLog.enabled           true
# spark.eventLog.dir               hdfs://namenode:8021/directory
# spark.serializer                 org.apache.spark.serializer.KryoSerializer
# spark.driver.memory              5g
# spark.executor.extraJavaOptions  -XX:+PrintGCDetails -Dkey=value -Dnumbers="one two three"
</pre></table></code></div></div><p>但是默认的<code class="language-plaintext highlighter-rouge">spark</code>是有<code class="language-plaintext highlighter-rouge">pre-built with hadoop</code>的. 这次我是采用的自己的<code class="language-plaintext highlighter-rouge">hadoop</code>分离开搭建, 以便<code class="language-plaintext highlighter-rouge">spark</code>的<code class="language-plaintext highlighter-rouge">RDD</code>和<code class="language-plaintext highlighter-rouge">hadoop</code>的<code class="language-plaintext highlighter-rouge">MapReduce</code>我都能分开用.</p><p>所以这次的<code class="language-plaintext highlighter-rouge">spark</code>的运行模式是<code class="language-plaintext highlighter-rouge">yarn</code> -&gt; <a href="https://spark.apache.org/docs/2.4.7/running-on-yarn.html"><code class="language-plaintext highlighter-rouge">YARN on Hadoop</code></a>, 所以<code class="language-plaintext highlighter-rouge">spark.master</code>字段要改<code class="language-plaintext highlighter-rouge">yarn</code></p><p><strong>直接上配置</strong></p><p><code class="language-plaintext highlighter-rouge">spark-defaults.conf</code></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>spark.master  yarn
spark.eventLog.enabled  <span class="nb">true</span>
<span class="c"># 如果你在定义hadoop的hdfs时采用了自定义端口, 在这里更改</span>
spark.eventLog.dir hdfs://localhost:9000/tmp/spark-logs
spark.history.provider org.apache.spark.deploy.history.FsHistoryProvider
spark.history.fs.logDirectory hdfs://localhost:9000/tmp/spark-logs
spark.history.fs.update.interval 10s
spark.history.ui.port 18080
</pre></table></code></div></div><p>历史记录应该是可以记录在本地的, 但是为了方便, 此处将其一共上传至<code class="language-plaintext highlighter-rouge">hdfs</code>, 方便追溯<code class="language-plaintext highlighter-rouge">job history</code>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>start-history-server.sh
</pre></table></code></div></div><h3 id="可能遇到的坑">可能遇到的坑<a href="#可能遇到的坑" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p><code class="language-plaintext highlighter-rouge">hdfs</code>里的<code class="language-plaintext highlighter-rouge">/tmp</code>权限默认应该是可写的, 但是有可能在拉起记录进程的时候, 他访问文件夹的时候, 空的时候它不去创建.</p></blockquote><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre> ✘ mijazz@lenovo  ~/devEnvs/spark-2.4.7  start-history-server.sh
starting org.apache.spark.deploy.history.HistoryServer, logging to /home/mijazz/devEnvs/spark-2.4.7/logs/spark-mijazz-org.apache.spark.deploy.history.HistoryServer-1-lenovo.out
failed to launch: <span class="nb">nice</span> <span class="nt">-n</span> 0 /home/mijazz/devEnvs/spark-2.4.7/bin/spark-class org.apache.spark.deploy.history.HistoryServer
        at org.apache.spark.deploy.history.FsHistoryProvider.&lt;init&gt;<span class="o">(</span>FsHistoryProvider.scala:207<span class="o">)</span>
        at org.apache.spark.deploy.history.FsHistoryProvider.&lt;init&gt;<span class="o">(</span>FsHistoryProvider.scala:86<span class="o">)</span>
        ... 6 more
  Caused by: java.io.FileNotFoundException: File does not exist: hdfs://localhost:9000/spark-logs
        at org.apache.hadoop.hdfs.DistributedFileSystem<span class="nv">$29</span>.doCall<span class="o">(</span>DistributedFileSystem.java:1586<span class="o">)</span>
        at org.apache.hadoop.hdfs.DistributedFileSystem<span class="nv">$29</span>.doCall<span class="o">(</span>DistributedFileSystem.java:1579<span class="o">)</span>
        at org.apache.hadoop.fs.FileSystemLinkResolver.resolve<span class="o">(</span>FileSystemLinkResolver.java:81<span class="o">)</span>
        at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus<span class="o">(</span>DistributedFileSystem.java:1594<span class="o">)</span>
        at org.apache.spark.deploy.history.FsHistoryProvider.org<span class="nv">$apache$spark$deploy$history$FsHistoryProvider$$</span>startPolling<span class="o">(</span>FsHistoryProvider.scala:257<span class="o">)</span>
        ... 9 more
</pre></table></code></div></div><p>用<code class="language-plaintext highlighter-rouge">hdfs dfs -mkdir /tmp/spark-logs</code>再<code class="language-plaintext highlighter-rouge">hdfs dfs -ls /tmp</code>确认一下<code class="language-plaintext highlighter-rouge">7xx</code>权限即可.</p><h2 id="running-spark">Running Spark<a href="#running-spark" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p><a href="https://spark.apache.org/docs/2.4.7/submitting-applications.html">spark-submit</a></p><p><a href="https://spark.apache.org/docs/2.4.7/cluster-overview.html">cluster</a> client模式, cluster模式.</p></blockquote><p>先理解一下spark的运行结构</p><p><img data-src="https://spark.apache.org/docs/2.4.7/img/cluster-overview.png" alt="" data-proofer-ignore></p><p>测试一下http://your.ip.or.host:18080</p><p>查看<code class="language-plaintext highlighter-rouge">history server</code>能不能拉起. 因为其也是作为<code class="language-plaintext highlighter-rouge">yarn</code>运行<code class="language-plaintext highlighter-rouge">hadoop</code>上的, 所以此处的<code class="language-plaintext highlighter-rouge">ip</code>应该是<code class="language-plaintext highlighter-rouge">master</code>的.</p><p>按照包里给出的<code class="language-plaintext highlighter-rouge">example jar</code>, 用<code class="language-plaintext highlighter-rouge">spark-submit</code>来提交jar包运行.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>spark-submit <span class="nt">--class</span> org.apache.spark.examples.SparkPi <span class="nt">--master</span> yarn <span class="nt">--deploy-mode</span> client <span class="nv">$SPARK_HOME</span>/examples/jars/spark-examples_2.11-2.4.7.jar 10
</pre></table></code></div></div><p>至于<code class="language-plaintext highlighter-rouge">cluster</code>模式和<code class="language-plaintext highlighter-rouge">client</code>模式, 主要看<code class="language-plaintext highlighter-rouge">spark driver</code>运行在哪一侧. 如果是<code class="language-plaintext highlighter-rouge">cluster</code>模式, 在该次作业中, <code class="language-plaintext highlighter-rouge">spark</code>会把driver也交给<code class="language-plaintext highlighter-rouge">yarn master</code>来运行.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>2020-11-29 15:56:51,224 INFO scheduler.DAGScheduler: Job 0 finished: reduce at SparkPi.scala:38, took 0.920297 s
Pi is roughly 3.1402631402631402
</pre></table></code></div></div><p>如果成功, 可以看到有该行输出. 记得<code class="language-plaintext highlighter-rouge">| grep "Pi is roughly"</code>.</p><p>同时也将会在<code class="language-plaintext highlighter-rouge">Spark History Server</code>即18080端口, 和<code class="language-plaintext highlighter-rouge">Yarn Cluster</code>即8088端口看见<code class="language-plaintext highlighter-rouge">yarn spark</code>的运行记录以及<code class="language-plaintext highlighter-rouge">event logs</code>.</p><h3 id="参考运行">参考运行<a href="#参考运行" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs/spark-2.4.7  spark-submit <span class="nt">--class</span> org.apache.spark.examples.SparkPi <span class="nt">--master</span> yarn <span class="nt">--deploy-mode</span> client  <span class="nv">$SPARK_HOME</span>/examples/jars/spark-examples_2.11-2.4.7.jar 10  
2020-11-29 15:56:38,173 WARN util.Utils: Your <span class="nb">hostname</span>, lenovo resolves to a loopback address: 127.0.0.1<span class="p">;</span> using 192.168.123.2 instead <span class="o">(</span>on interface enp4s0<span class="o">)</span>
2020-11-29 15:56:38,173 WARN util.Utils: Set SPARK_LOCAL_IP <span class="k">if </span>you need to <span class="nb">bind </span>to another address
2020-11-29 15:56:38,404 WARN util.NativeCodeLoader: Unable to load native-hadoop library <span class="k">for </span>your platform... using builtin-java classes where applicable
2020-11-29 15:56:38,541 INFO spark.SparkContext: Running Spark version 2.4.7
2020-11-29 15:56:38,556 INFO spark.SparkContext: Submitted application: Spark Pi
2020-11-29 15:56:38,593 INFO spark.SecurityManager: Changing view acls to: mijazz
2020-11-29 15:56:38,593 INFO spark.SecurityManager: Changing modify acls to: mijazz
2020-11-29 15:56:38,593 INFO spark.SecurityManager: Changing view acls <span class="nb">groups </span>to: 
2020-11-29 15:56:38,593 INFO spark.SecurityManager: Changing modify acls <span class="nb">groups </span>to: 
2020-11-29 15:56:38,594 INFO spark.SecurityManager: SecurityManager: authentication disabled<span class="p">;</span> ui acls disabled<span class="p">;</span> <span class="nb">users  </span>with view permissions: Set<span class="o">(</span>mijazz<span class="o">)</span><span class="p">;</span> <span class="nb">groups </span>with view permissions: Set<span class="o">()</span><span class="p">;</span> <span class="nb">users  </span>with modify permissions: Set<span class="o">(</span>mijazz<span class="o">)</span><span class="p">;</span> <span class="nb">groups </span>with modify permissions: Set<span class="o">()</span>
2020-11-29 15:56:38,771 INFO util.Utils: Successfully started service <span class="s1">'sparkDriver'</span> on port 39113.
2020-11-29 15:56:38,790 INFO spark.SparkEnv: Registering MapOutputTracker
2020-11-29 15:56:38,802 INFO spark.SparkEnv: Registering BlockManagerMaster
2020-11-29 15:56:38,804 INFO storage.BlockManagerMasterEndpoint: Using org.apache.spark.storage.DefaultTopologyMapper <span class="k">for </span>getting topology information
2020-11-29 15:56:38,805 INFO storage.BlockManagerMasterEndpoint: BlockManagerMasterEndpoint up
2020-11-29 15:56:38,811 INFO storage.DiskBlockManager: Created <span class="nb">local </span>directory at /tmp/blockmgr-01fd513c-7e08-401b-b6ea-46a0a268accf
2020-11-29 15:56:38,823 INFO memory.MemoryStore: MemoryStore started with capacity 366.3 MB
2020-11-29 15:56:38,857 INFO spark.SparkEnv: Registering OutputCommitCoordinator
2020-11-29 15:56:38,915 INFO util.log: Logging initialized @1320ms
2020-11-29 15:56:38,955 INFO server.Server: jetty-9.3.z-SNAPSHOT, build timestamp: 2019-08-14T05:28:18+08:00, git <span class="nb">hash</span>: 84700530e645e812b336747464d6fbbf370c9a20
2020-11-29 15:56:38,972 INFO server.Server: Started @1378ms
2020-11-29 15:56:38,989 INFO server.AbstractConnector: Started ServerConnector@33aa93c<span class="o">{</span>HTTP/1.1,[http/1.1]<span class="o">}{</span>0.0.0.0:4040<span class="o">}</span>
2020-11-29 15:56:38,989 INFO util.Utils: Successfully started service <span class="s1">'SparkUI'</span> on port 4040.
2020-11-29 15:56:39,006 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@6bd51ed8<span class="o">{</span>/jobs,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,007 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@3b65e559<span class="o">{</span>/jobs/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,007 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@bae47a0<span class="o">{</span>/jobs/job,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,009 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@1c05a54d<span class="o">{</span>/jobs/job/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,010 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@65ef722a<span class="o">{</span>/stages,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,010 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@5fd9b663<span class="o">{</span>/stages/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,011 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@214894fc<span class="o">{</span>/stages/stage,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,012 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@1c4ee95c<span class="o">{</span>/stages/stage/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,012 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@79c4715d<span class="o">{</span>/stages/pool,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,013 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@5aa360ea<span class="o">{</span>/stages/pool/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,013 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@6548bb7d<span class="o">{</span>/storage,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,013 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@e27ba81<span class="o">{</span>/storage/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,014 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@54336c81<span class="o">{</span>/storage/rdd,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,014 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@1556f2dd<span class="o">{</span>/storage/rdd/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,015 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@35e52059<span class="o">{</span>/environment,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,015 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@62577d6<span class="o">{</span>/environment/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,016 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@49bd54f7<span class="o">{</span>/executors,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,016 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@6b5f8707<span class="o">{</span>/executors/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,017 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@772485dd<span class="o">{</span>/executors/threadDump,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,017 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@5a12c728<span class="o">{</span>/executors/threadDump/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,022 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@79ab3a71<span class="o">{</span>/static,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,023 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@5a772895<span class="o">{</span>/,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,024 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@39fc6b2c<span class="o">{</span>/api,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,024 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@7cc9ce8<span class="o">{</span>/jobs/job/kill,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,025 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@2e27d72f<span class="o">{</span>/stages/stage/kill,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:39,026 INFO ui.SparkUI: Bound SparkUI to 0.0.0.0, and started at http://lenovo.lan:4040
2020-11-29 15:56:39,035 INFO spark.SparkContext: Added JAR file:/home/mijazz/devEnvs/spark-2.4.7/examples/jars/spark-examples_2.11-2.4.7.jar at spark://lenovo.lan:39113/jars/spark-examples_2.11-2.4.7.jar with timestamp 1606636599035
2020-11-29 15:56:39,634 INFO client.RMProxy: Connecting to ResourceManager at /0.0.0.0:8032
2020-11-29 15:56:39,880 INFO yarn.Client: Requesting a new application from cluster with 1 NodeManagers
2020-11-29 15:56:39,933 INFO conf.Configuration: resource-types.xml not found
2020-11-29 15:56:39,933 INFO resource.ResourceUtils: Unable to find <span class="s1">'resource-types.xml'</span><span class="nb">.</span>
2020-11-29 15:56:39,945 INFO yarn.Client: Verifying our application has not requested more than the maximum memory capability of the cluster <span class="o">(</span>8192 MB per container<span class="o">)</span>
2020-11-29 15:56:39,946 INFO yarn.Client: Will allocate AM container, with 896 MB memory including 384 MB overhead
2020-11-29 15:56:39,946 INFO yarn.Client: Setting up container launch context <span class="k">for </span>our AM
2020-11-29 15:56:39,948 INFO yarn.Client: Setting up the launch environment <span class="k">for </span>our AM container
2020-11-29 15:56:39,951 INFO yarn.Client: Preparing resources <span class="k">for </span>our AM container
2020-11-29 15:56:39,978 WARN yarn.Client: Neither spark.yarn.jars nor spark.yarn.archive is <span class="nb">set</span>, falling back to uploading libraries under SPARK_HOME.
2020-11-29 15:56:40,534 INFO yarn.Client: Uploading resource file:/tmp/spark-49c12823-b6a4-4c2e-b397-d77a78188b8d/__spark_libs__1519230271046889967.zip -&gt; hdfs://localhost:9000/user/mijazz/.sparkStaging/application_1606634326109_0003/__spark_libs__1519230271046889967.zip
2020-11-29 15:56:41,208 INFO yarn.Client: Uploading resource file:/tmp/spark-49c12823-b6a4-4c2e-b397-d77a78188b8d/__spark_conf__3120810522893336741.zip -&gt; hdfs://localhost:9000/user/mijazz/.sparkStaging/application_1606634326109_0003/__spark_conf__.zip
2020-11-29 15:56:41,266 INFO spark.SecurityManager: Changing view acls to: mijazz
2020-11-29 15:56:41,266 INFO spark.SecurityManager: Changing modify acls to: mijazz
2020-11-29 15:56:41,266 INFO spark.SecurityManager: Changing view acls <span class="nb">groups </span>to: 
2020-11-29 15:56:41,266 INFO spark.SecurityManager: Changing modify acls <span class="nb">groups </span>to: 
2020-11-29 15:56:41,266 INFO spark.SecurityManager: SecurityManager: authentication disabled<span class="p">;</span> ui acls disabled<span class="p">;</span> <span class="nb">users  </span>with view permissions: Set<span class="o">(</span>mijazz<span class="o">)</span><span class="p">;</span> <span class="nb">groups </span>with view permissions: Set<span class="o">()</span><span class="p">;</span> <span class="nb">users  </span>with modify permissions: Set<span class="o">(</span>mijazz<span class="o">)</span><span class="p">;</span> <span class="nb">groups </span>with modify permissions: Set<span class="o">()</span>
2020-11-29 15:56:42,004 INFO yarn.Client: Submitting application application_1606634326109_0003 to ResourceManager
2020-11-29 15:56:42,039 INFO impl.YarnClientImpl: Submitted application application_1606634326109_0003
2020-11-29 15:56:42,041 INFO cluster.SchedulerExtensionServices: Starting Yarn extension services with app application_1606634326109_0003 and attemptId None
2020-11-29 15:56:43,046 INFO yarn.Client: Application report <span class="k">for </span>application_1606634326109_0003 <span class="o">(</span>state: ACCEPTED<span class="o">)</span>
2020-11-29 15:56:43,048 INFO yarn.Client: 
         client token: N/A
         diagnostics: AM container is launched, waiting <span class="k">for </span>AM container to Register with RM
         ApplicationMaster host: N/A
         ApplicationMaster RPC port: <span class="nt">-1</span>
         queue: default
         start <span class="nb">time</span>: 1606636602015
         final status: UNDEFINED
         tracking URL: http://localhost:8088/proxy/application_1606634326109_0003/
         user: mijazz
2020-11-29 15:56:44,050 INFO yarn.Client: Application report <span class="k">for </span>application_1606634326109_0003 <span class="o">(</span>state: ACCEPTED<span class="o">)</span>
2020-11-29 15:56:45,052 INFO yarn.Client: Application report <span class="k">for </span>application_1606634326109_0003 <span class="o">(</span>state: ACCEPTED<span class="o">)</span>
2020-11-29 15:56:45,963 INFO cluster.YarnClientSchedulerBackend: Add WebUI Filter. org.apache.hadoop.yarn.server.webproxy.amfilter.AmIpFilter, Map<span class="o">(</span>PROXY_HOSTS -&gt; localhost, PROXY_URI_BASES -&gt; http://localhost:8088/proxy/application_1606634326109_0003<span class="o">)</span>, /proxy/application_1606634326109_0003
2020-11-29 15:56:46,054 INFO yarn.Client: Application report <span class="k">for </span>application_1606634326109_0003 <span class="o">(</span>state: RUNNING<span class="o">)</span>
2020-11-29 15:56:46,054 INFO yarn.Client: 
         client token: N/A
         diagnostics: N/A
         ApplicationMaster host: 192.168.123.2
         ApplicationMaster RPC port: <span class="nt">-1</span>
         queue: default
         start <span class="nb">time</span>: 1606636602015
         final status: UNDEFINED
         tracking URL: http://localhost:8088/proxy/application_1606634326109_0003/
         user: mijazz
2020-11-29 15:56:46,055 INFO cluster.YarnClientSchedulerBackend: Application application_1606634326109_0003 has started running.
2020-11-29 15:56:46,061 INFO util.Utils: Successfully started service <span class="s1">'org.apache.spark.network.netty.NettyBlockTransferService'</span> on port 37581.
2020-11-29 15:56:46,061 INFO netty.NettyBlockTransferService: Server created on lenovo.lan:37581
2020-11-29 15:56:46,062 INFO storage.BlockManager: Using org.apache.spark.storage.RandomBlockReplicationPolicy <span class="k">for </span>block replication policy
2020-11-29 15:56:46,079 INFO storage.BlockManagerMaster: Registering BlockManager BlockManagerId<span class="o">(</span>driver, lenovo.lan, 37581, None<span class="o">)</span>
2020-11-29 15:56:46,080 INFO storage.BlockManagerMasterEndpoint: Registering block manager lenovo.lan:37581 with 366.3 MB RAM, BlockManagerId<span class="o">(</span>driver, lenovo.lan, 37581, None<span class="o">)</span>
2020-11-29 15:56:46,082 INFO storage.BlockManagerMaster: Registered BlockManager BlockManagerId<span class="o">(</span>driver, lenovo.lan, 37581, None<span class="o">)</span>
2020-11-29 15:56:46,083 INFO storage.BlockManager: Initialized BlockManager: BlockManagerId<span class="o">(</span>driver, lenovo.lan, 37581, None<span class="o">)</span>
2020-11-29 15:56:46,143 INFO cluster.YarnSchedulerBackend<span class="nv">$YarnSchedulerEndpoint</span>: ApplicationMaster registered as NettyRpcEndpointRef<span class="o">(</span>spark-client://YarnAM<span class="o">)</span>
2020-11-29 15:56:46,205 INFO ui.JettyUtils: Adding filter org.apache.hadoop.yarn.server.webproxy.amfilter.AmIpFilter to /metrics/json.
2020-11-29 15:56:46,210 INFO handler.ContextHandler: Started o.s.j.s.ServletContextHandler@9e02f84<span class="o">{</span>/metrics/json,null,AVAILABLE,@Spark<span class="o">}</span>
2020-11-29 15:56:46,306 INFO scheduler.EventLoggingListener: Logging events to hdfs://localhost:9000/tmp/spark-logs/application_1606634326109_0003
2020-11-29 15:56:49,276 INFO cluster.YarnSchedulerBackend<span class="nv">$YarnDriverEndpoint</span>: Registered executor NettyRpcEndpointRef<span class="o">(</span>spark-client://Executor<span class="o">)</span> <span class="o">(</span>192.168.123.2:37340<span class="o">)</span> with ID 1
2020-11-29 15:56:49,394 INFO storage.BlockManagerMasterEndpoint: Registering block manager localhost:35819 with 366.3 MB RAM, BlockManagerId<span class="o">(</span>1, localhost, 35819, None<span class="o">)</span>
2020-11-29 15:56:49,976 INFO cluster.YarnSchedulerBackend<span class="nv">$YarnDriverEndpoint</span>: Registered executor NettyRpcEndpointRef<span class="o">(</span>spark-client://Executor<span class="o">)</span> <span class="o">(</span>192.168.123.2:37344<span class="o">)</span> with ID 2
2020-11-29 15:56:50,034 INFO cluster.YarnClientSchedulerBackend: SchedulerBackend is ready <span class="k">for </span>scheduling beginning after reached minRegisteredResourcesRatio: 0.8
2020-11-29 15:56:50,165 INFO storage.BlockManagerMasterEndpoint: Registering block manager localhost:40629 with 366.3 MB RAM, BlockManagerId<span class="o">(</span>2, localhost, 40629, None<span class="o">)</span>
2020-11-29 15:56:50,304 INFO spark.SparkContext: Starting job: reduce at SparkPi.scala:38
2020-11-29 15:56:50,319 INFO scheduler.DAGScheduler: Got job 0 <span class="o">(</span>reduce at SparkPi.scala:38<span class="o">)</span> with 10 output partitions
2020-11-29 15:56:50,320 INFO scheduler.DAGScheduler: Final stage: ResultStage 0 <span class="o">(</span>reduce at SparkPi.scala:38<span class="o">)</span>
2020-11-29 15:56:50,321 INFO scheduler.DAGScheduler: Parents of final stage: List<span class="o">()</span>
2020-11-29 15:56:50,321 INFO scheduler.DAGScheduler: Missing parents: List<span class="o">()</span>
2020-11-29 15:56:50,325 INFO scheduler.DAGScheduler: Submitting ResultStage 0 <span class="o">(</span>MapPartitionsRDD[1] at map at SparkPi.scala:34<span class="o">)</span>, which has no missing parents
2020-11-29 15:56:50,436 INFO memory.MemoryStore: Block broadcast_0 stored as values <span class="k">in </span>memory <span class="o">(</span>estimated size 2.0 KB, free 366.3 MB<span class="o">)</span>
2020-11-29 15:56:50,454 INFO memory.MemoryStore: Block broadcast_0_piece0 stored as bytes <span class="k">in </span>memory <span class="o">(</span>estimated size 1381.0 B, free 366.3 MB<span class="o">)</span>
2020-11-29 15:56:50,456 INFO storage.BlockManagerInfo: Added broadcast_0_piece0 <span class="k">in </span>memory on lenovo.lan:37581 <span class="o">(</span>size: 1381.0 B, free: 366.3 MB<span class="o">)</span>
2020-11-29 15:56:50,459 INFO spark.SparkContext: Created broadcast 0 from broadcast at DAGScheduler.scala:1184
2020-11-29 15:56:50,471 INFO scheduler.DAGScheduler: Submitting 10 missing tasks from ResultStage 0 <span class="o">(</span>MapPartitionsRDD[1] at map at SparkPi.scala:34<span class="o">)</span> <span class="o">(</span>first 15 tasks are <span class="k">for </span>partitions Vector<span class="o">(</span>0, 1, 2, 3, 4, 5, 6, 7, 8, 9<span class="o">))</span>
2020-11-29 15:56:50,471 INFO cluster.YarnScheduler: Adding task <span class="nb">set </span>0.0 with 10 tasks
2020-11-29 15:56:50,496 INFO scheduler.TaskSetManager: Starting task 0.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 0, localhost, executor 2, partition 0, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:50,500 INFO scheduler.TaskSetManager: Starting task 1.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 1, localhost, executor 1, partition 1, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:50,783 INFO storage.BlockManagerInfo: Added broadcast_0_piece0 <span class="k">in </span>memory on localhost:35819 <span class="o">(</span>size: 1381.0 B, free: 366.3 MB<span class="o">)</span>
2020-11-29 15:56:50,976 INFO storage.BlockManagerInfo: Added broadcast_0_piece0 <span class="k">in </span>memory on localhost:40629 <span class="o">(</span>size: 1381.0 B, free: 366.3 MB<span class="o">)</span>
2020-11-29 15:56:51,003 INFO scheduler.TaskSetManager: Starting task 2.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 2, localhost, executor 1, partition 2, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:51,008 INFO scheduler.TaskSetManager: Finished task 1.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 1<span class="o">)</span> <span class="k">in </span>509 ms on localhost <span class="o">(</span>executor 1<span class="o">)</span> <span class="o">(</span>1/10<span class="o">)</span>
2020-11-29 15:56:51,039 INFO scheduler.TaskSetManager: Starting task 3.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 3, localhost, executor 1, partition 3, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:51,042 INFO scheduler.TaskSetManager: Finished task 2.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 2<span class="o">)</span> <span class="k">in </span>40 ms on localhost <span class="o">(</span>executor 1<span class="o">)</span> <span class="o">(</span>2/10<span class="o">)</span>
2020-11-29 15:56:51,075 INFO scheduler.TaskSetManager: Starting task 4.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 4, localhost, executor 1, partition 4, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:51,078 INFO scheduler.TaskSetManager: Finished task 3.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 3<span class="o">)</span> <span class="k">in </span>39 ms on localhost <span class="o">(</span>executor 1<span class="o">)</span> <span class="o">(</span>3/10<span class="o">)</span>
2020-11-29 15:56:51,110 INFO scheduler.TaskSetManager: Starting task 5.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 5, localhost, executor 2, partition 5, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:51,112 INFO scheduler.TaskSetManager: Finished task 0.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 0<span class="o">)</span> <span class="k">in </span>627 ms on localhost <span class="o">(</span>executor 2<span class="o">)</span> <span class="o">(</span>4/10<span class="o">)</span>
2020-11-29 15:56:51,122 INFO scheduler.TaskSetManager: Starting task 6.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 6, localhost, executor 1, partition 6, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:51,123 INFO scheduler.TaskSetManager: Finished task 4.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 4<span class="o">)</span> <span class="k">in </span>47 ms on localhost <span class="o">(</span>executor 1<span class="o">)</span> <span class="o">(</span>5/10<span class="o">)</span>
2020-11-29 15:56:51,166 INFO scheduler.TaskSetManager: Starting task 7.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 7, localhost, executor 1, partition 7, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:51,171 INFO scheduler.TaskSetManager: Finished task 6.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 6<span class="o">)</span> <span class="k">in </span>49 ms on localhost <span class="o">(</span>executor 1<span class="o">)</span> <span class="o">(</span>6/10<span class="o">)</span>
2020-11-29 15:56:51,171 INFO scheduler.TaskSetManager: Starting task 8.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 8, localhost, executor 2, partition 8, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:51,172 INFO scheduler.TaskSetManager: Finished task 5.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 5<span class="o">)</span> <span class="k">in </span>62 ms on localhost <span class="o">(</span>executor 2<span class="o">)</span> <span class="o">(</span>7/10<span class="o">)</span>
2020-11-29 15:56:51,187 INFO scheduler.TaskSetManager: Starting task 9.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 9, localhost, executor 1, partition 9, PROCESS_LOCAL, 7877 bytes<span class="o">)</span>
2020-11-29 15:56:51,188 INFO scheduler.TaskSetManager: Finished task 7.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 7<span class="o">)</span> <span class="k">in </span>22 ms on localhost <span class="o">(</span>executor 1<span class="o">)</span> <span class="o">(</span>8/10<span class="o">)</span>
2020-11-29 15:56:51,213 INFO scheduler.TaskSetManager: Finished task 8.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 8<span class="o">)</span> <span class="k">in </span>42 ms on localhost <span class="o">(</span>executor 2<span class="o">)</span> <span class="o">(</span>9/10<span class="o">)</span>
2020-11-29 15:56:51,219 INFO scheduler.TaskSetManager: Finished task 9.0 <span class="k">in </span>stage 0.0 <span class="o">(</span>TID 9<span class="o">)</span> <span class="k">in </span>33 ms on localhost <span class="o">(</span>executor 1<span class="o">)</span> <span class="o">(</span>10/10<span class="o">)</span>
2020-11-29 15:56:51,220 INFO cluster.YarnScheduler: Removed TaskSet 0.0, whose tasks have all completed, from pool 
2020-11-29 15:56:51,221 INFO scheduler.DAGScheduler: ResultStage 0 <span class="o">(</span>reduce at SparkPi.scala:38<span class="o">)</span> finished <span class="k">in </span>0.868 s
2020-11-29 15:56:51,224 INFO scheduler.DAGScheduler: Job 0 finished: reduce at SparkPi.scala:38, took 0.920297 s
Pi is roughly 3.1402631402631402
2020-11-29 15:56:51,235 INFO server.AbstractConnector: Stopped Spark@33aa93c<span class="o">{</span>HTTP/1.1,[http/1.1]<span class="o">}{</span>0.0.0.0:4040<span class="o">}</span>
2020-11-29 15:56:51,237 INFO ui.SparkUI: Stopped Spark web UI at http://lenovo.lan:4040
2020-11-29 15:56:51,240 INFO cluster.YarnClientSchedulerBackend: Interrupting monitor thread
2020-11-29 15:56:51,263 INFO cluster.YarnClientSchedulerBackend: Shutting down all executors
2020-11-29 15:56:51,264 INFO cluster.YarnSchedulerBackend<span class="nv">$YarnDriverEndpoint</span>: Asking each executor to shut down
2020-11-29 15:56:51,268 INFO cluster.SchedulerExtensionServices: Stopping SchedulerExtensionServices
<span class="o">(</span><span class="nv">serviceOption</span><span class="o">=</span>None,
 <span class="nv">services</span><span class="o">=</span>List<span class="o">()</span>,
 <span class="nv">started</span><span class="o">=</span><span class="nb">false</span><span class="o">)</span>
2020-11-29 15:56:51,268 INFO cluster.YarnClientSchedulerBackend: Stopped
2020-11-29 15:56:51,364 INFO spark.MapOutputTrackerMasterEndpoint: MapOutputTrackerMasterEndpoint stopped!
2020-11-29 15:56:51,371 INFO memory.MemoryStore: MemoryStore cleared
2020-11-29 15:56:51,371 INFO storage.BlockManager: BlockManager stopped
2020-11-29 15:56:51,374 INFO storage.BlockManagerMaster: BlockManagerMaster stopped
2020-11-29 15:56:51,376 INFO scheduler.OutputCommitCoordinator<span class="nv">$OutputCommitCoordinatorEndpoint</span>: OutputCommitCoordinator stopped!
2020-11-29 15:56:51,398 INFO spark.SparkContext: Successfully stopped SparkContext
2020-11-29 15:56:51,400 INFO util.ShutdownHookManager: Shutdown hook called
2020-11-29 15:56:51,401 INFO util.ShutdownHookManager: Deleting directory /tmp/spark-5c235e44-e3d3-4d12-923c-a635b9143c39
2020-11-29 15:56:51,403 INFO util.ShutdownHookManager: Deleting directory /tmp/spark-49c12823-b6a4-4c2e-b397-d77a78188b8d
</pre></table></code></div></div><h1 id="data-practicing-ep3">Data Practicing-EP3</h1><h2 id="introduce-spark">Introduce Spark<a href="#introduce-spark" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>这里贴出几个官方文档</p><p><a href="https://spark.apache.org/docs/2.4.7/">Spark Overview</a></p><p><a href="https://spark.apache.org/docs/2.4.7/api/java/index.html">Java API Docs</a></p><p><a href="https://spark.apache.org/docs/2.4.7/api/scala/index.html">Scala API Docs</a></p><p><a href="https://spark.apache.org/docs/2.4.7/api/sql/index.html">Spark SQL Docs</a></p></blockquote><p>这里只记录一下<code class="language-plaintext highlighter-rouge">SparkRDD</code>, <code class="language-plaintext highlighter-rouge">RDD</code> -&gt; <code class="language-plaintext highlighter-rouge">Resilient Distributed Datasets</code>.</p><p>它是一种可扩展的弹性分布式数据集, 他是只读的, 分区的, 并且保持不变的数据集合, 直接与在内存层面的一个分布式实现.</p><ul><li>可分区/片(<del>默认好象是Hash分区?</del>)<li>可自定义分片计算函数<li>互相依赖(下个分区由之前的分区通过转换生成)<li>可控制分片数量<li>可以使用列表方式进行块储存</ul><p>它支持两种类型的操作</p><ul><li>Transformations<ul><li><code class="language-plaintext highlighter-rouge">map()</code><li><code class="language-plaintext highlighter-rouge">flatMap()</code><li><code class="language-plaintext highlighter-rouge">filter()</code><li><code class="language-plaintext highlighter-rouge">union()</code><li><code class="language-plaintext highlighter-rouge">intersection()</code><li>……</ul><li>Actions<ul><li><code class="language-plaintext highlighter-rouge">reduce()</code><li><code class="language-plaintext highlighter-rouge">collect()</code><li><code class="language-plaintext highlighter-rouge">count()</code><li>……</ul></ul><h3 id="rdd-operations-examples"><code class="language-plaintext highlighter-rouge">RDD</code> Operations Examples<a href="#rdd-operations-examples" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>以下Code Block均为在<code class="language-plaintext highlighter-rouge">Spark-shell</code>下执行的结果</p><p><code class="language-plaintext highlighter-rouge">Spark</code>-&gt; 2.4.7 <code class="language-plaintext highlighter-rouge">Yarn</code> on <code class="language-plaintext highlighter-rouge">Hadoop 3.1.4</code></p><p><code class="language-plaintext highlighter-rouge">Scala version 2.11.12 (OpenJDK 64-Bit Server VM, Java 1.8.0_275)</code></p></blockquote><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">11</span><span class="o">)</span>
<span class="n">data</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">11</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nv">rdd1</span> <span class="k">=</span> <span class="nv">sc</span><span class="o">.</span><span class="py">parallelize</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
<span class="n">rdd1</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">ParallelCollectionRDD</span><span class="o">[</span><span class="err">0</span><span class="o">]</span> <span class="n">at</span> <span class="n">parallelize</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">26</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nv">rdd2</span> <span class="k">=</span> <span class="nv">rdd1</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="n">element</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">element</span><span class="o">*</span><span class="mi">2</span><span class="o">,</span> <span class="n">element</span><span class="o">*</span><span class="n">element</span><span class="o">)).</span><span class="py">collect</span><span class="o">()</span>
<span class="n">rdd2</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">((</span><span class="mi">4</span><span class="o">,</span><span class="mi">4</span><span class="o">),</span> <span class="o">(</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">),</span> <span class="o">(</span><span class="mi">10</span><span class="o">,</span><span class="mi">25</span><span class="o">),</span> <span class="o">(</span><span class="mi">14</span><span class="o">,</span><span class="mi">49</span><span class="o">),</span> <span class="o">(</span><span class="mi">22</span><span class="o">,</span><span class="mi">121</span><span class="o">))</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">val</span> <span class="nv">rdd3</span> <span class="k">=</span> <span class="nv">rdd1</span><span class="o">.</span><span class="py">union</span><span class="o">(</span><span class="n">rdd1</span><span class="o">)</span>
<span class="n">rdd3</span><span class="k">:</span> <span class="kt">org.apache.spark.rdd.RDD</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">UnionRDD</span><span class="o">[</span><span class="err">3</span><span class="o">]</span> <span class="n">at</span> <span class="n">union</span> <span class="n">at</span> <span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">25</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nv">rdd3</span><span class="o">.</span><span class="py">collect</span><span class="o">()</span>
<span class="n">res4</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">11</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nv">rdd3</span><span class="o">.</span><span class="py">sortBy</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">%</span><span class="mi">8</span><span class="o">,</span> <span class="n">ascending</span><span class="k">=</span><span class="kc">false</span><span class="o">).</span><span class="py">collect</span><span class="o">()</span>
<span class="n">res5</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nv">rdd3</span><span class="o">.</span><span class="py">count</span><span class="o">()</span>
<span class="n">res6</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nv">rdd3</span><span class="o">.</span><span class="py">take</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="n">res7</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nv">rdd3</span><span class="o">.</span><span class="py">distinct</span><span class="o">().</span><span class="py">collect</span><span class="o">()</span>
<span class="n">res8</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">7</span><span class="o">)</span>
<span class="o">........</span>
</pre></table></code></div></div><p>加上之前我们在<code class="language-plaintext highlighter-rouge">hadoop</code>里运行的<code class="language-plaintext highlighter-rouge">HDFS</code>, Spark可以很方便的通过<code class="language-plaintext highlighter-rouge">hdfs://ip.or.host:port/path/to/file</code>来访问<code class="language-plaintext highlighter-rouge">hdfs</code>的文件.</p><p>也可以使用<code class="language-plaintext highlighter-rouge">spark sql</code>在处理数据.</p><h2 id="prepare-to-code">Prepare to Code<a href="#prepare-to-code" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>网上太多教材关于<code class="language-plaintext highlighter-rouge">Spark</code> + <code class="language-plaintext highlighter-rouge">Scala</code> + <code class="language-plaintext highlighter-rouge">IntelliJ IDEA</code> + <code class="language-plaintext highlighter-rouge">sbt</code>四大件的了</p><p>贴几个教程链接</p><blockquote><p><a href="https://www.jetbrains.com/help/idea/sbt-support.html#sbt_structure">IntelliJ IDEA sbt</a></p><p><a href="https://www.jetbrains.com/help/idea/discover-intellij-idea-for-scala.html">IntelliJ IDEA Scala</a></p><p><a href="https://docs.scala-lang.org/getting-started/intellij-track/getting-started-with-scala-in-intellij.html">Scala Official - Dev with IDEA</a></p><p><a href="https://learnscalaspark.com/getting-started-intellij-scala-apache-spark">Tutorial 1</a></p><p><a href="https://medium.com/@mrpowers/creating-a-spark-project-with-sbt-intellij-sbt-spark-package-and-friends-cc9108751c28">Tutorial-2</a></p></blockquote><p>包管理对于我来说, 还是更熟悉<code class="language-plaintext highlighter-rouge">Java</code>的那一套, 毕竟<code class="language-plaintext highlighter-rouge">Spring</code>用多了. 不是<code class="language-plaintext highlighter-rouge">Maven</code>就是<code class="language-plaintext highlighter-rouge">Gradle</code>.</p><p>镜像设置过程不表, 见<a href="https://developer.aliyun.com/mirror/maven">Aliyun Maven Mirror</a></p><blockquote><p>Manjaro Linux 20</p><p>IntelliJ IDEA Ultimate 2020.2.3</p><p>Maven(bundled with idea, 3.6.3)</p><p>Install Scala Plugin in IDEA(!important)</p></blockquote><p>常规IDEA建立<code class="language-plaintext highlighter-rouge">Maven</code>的<code class="language-plaintext highlighter-rouge">Project</code>, 依赖如下</p><p><code class="language-plaintext highlighter-rouge">pom.xml</code></p><div class="language-xml highlighter-rouge"><div class="code-header"> <span label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>    <span class="nt">&lt;dependencies&gt;</span>
    <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.apache.spark/spark-core --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.spark<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spark-core_2.11<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.4.7<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.apache.spark/spark-sql --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.spark<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spark-sql_2.11<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.4.7<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;/dependencies&gt;</span>

</pre></table></code></div></div><p>如果spark版本不同, 去<code class="language-plaintext highlighter-rouge">mvnrepository</code>搜索对应的依赖, 粘贴进依赖区即可.</p><p>Sync一下, Maven即可解决依赖问题. 而后在工程下右键, <code class="language-plaintext highlighter-rouge">Add Framework Support</code>, 加入该工程对<code class="language-plaintext highlighter-rouge">Scala</code>的支持.(该步骤需要有<code class="language-plaintext highlighter-rouge">Scala Plugin</code>)</p><p>常规建包建类即可, 选<code class="language-plaintext highlighter-rouge">Scala Class -&gt; Object</code></p><blockquote><p>参考<a href="https://www.oracle.com/java/technologies/javase/codeconventions-namingconventions.html">Naming Conventions</a></p></blockquote><p>我的步骤</p><ul><li><p>$Project Root/src/main/java新建<code class="language-plaintext highlighter-rouge">package</code> -&gt; <code class="language-plaintext highlighter-rouge">edu.zstu.mijazz.sparklearn</code></p><li><p>包下建类<code class="language-plaintext highlighter-rouge">Scala Object -&gt; HelloWorld</code></p><li><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">edu.zstu.mijazz.sparklearn1</span>
  
<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>
  
<span class="k">import</span> <span class="nn">scala.math.random</span>
  
<span class="k">object</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">spark</span> <span class="k">=</span> <span class="nv">SparkSession</span><span class="o">.</span><span class="py">builder</span><span class="o">.</span><span class="py">appName</span><span class="o">(</span><span class="s">"Spark Pi"</span><span class="o">).</span><span class="py">master</span><span class="o">(</span><span class="s">"local"</span><span class="o">).</span><span class="py">getOrCreate</span><span class="o">()</span>
    <span class="k">val</span> <span class="nv">count</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">sparkContext</span><span class="o">.</span><span class="py">parallelize</span><span class="o">(</span><span class="mi">1</span> <span class="n">until</span> <span class="mi">50000000</span><span class="o">,</span> <span class="mi">3</span><span class="o">).</span><span class="py">map</span> <span class="o">{</span><span class="k">_</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="nv">x</span> <span class="k">=</span> <span class="n">random</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="k">val</span> <span class="nv">y</span> <span class="k">=</span> <span class="n">random</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="nf">if</span> <span class="o">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="o">}.</span><span class="py">reduce</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>
    <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Pi is roughly ${4.0 * count / (50000000 - 1)}"</span><span class="o">)</span>
    <span class="nv">spark</span><span class="o">.</span><span class="py">stop</span><span class="o">()</span>
    <span class="nv">spark</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>直接建object, 执行时对象初始化触发对象<code class="language-plaintext highlighter-rouge">main()</code>, 至于Scala的语法和资料, 见<a href="https://docs.scala-lang.org/overviews/">Scala Docs</a></p><li><p>如果输出没问题</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="nc">Using</span> <span class="nc">Spark</span><span class="ss">'s</span> <span class="n">default</span> <span class="n">log4j</span> <span class="n">profile</span><span class="k">:</span> <span class="kt">org/apache/spark/log4j-defaults.properties</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SparkContext:</span> <span class="kt">Running</span> <span class="kt">Spark</span> <span class="kt">version</span> <span class="err">2</span><span class="kt">.</span><span class="err">4</span><span class="kt">.</span><span class="err">7</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SparkContext:</span> <span class="kt">Submitted</span> <span class="kt">application:</span> <span class="kt">Spark</span> <span class="kt">Pi</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SecurityManager:</span> <span class="kt">Changing</span> <span class="kt">view</span> <span class="kt">acls</span> <span class="kt">to:</span> <span class="kt">mijazz</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SecurityManager:</span> <span class="kt">Changing</span> <span class="kt">modify</span> <span class="kt">acls</span> <span class="kt">to:</span> <span class="kt">mijazz</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SecurityManager:</span> <span class="kt">Changing</span> <span class="kt">view</span> <span class="kt">acls</span> <span class="kt">groups</span> <span class="kt">to:</span> 
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SecurityManager:</span> <span class="kt">Changing</span> <span class="kt">modify</span> <span class="kt">acls</span> <span class="kt">groups</span> <span class="kt">to:</span> 
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SecurityManager:</span> <span class="kt">SecurityManager:</span> <span class="kt">authentication</span> <span class="kt">disabled</span><span class="o">;</span> <span class="n">ui</span> <span class="n">acls</span> <span class="n">disabled</span><span class="o">;</span> <span class="n">users</span>  <span class="k">with</span> <span class="n">view</span> <span class="n">permissions</span><span class="k">:</span> <span class="kt">Set</span><span class="o">(</span><span class="kt">mijazz</span><span class="o">);</span> <span class="n">groups</span> <span class="k">with</span> <span class="n">view</span> <span class="n">permissions</span><span class="k">:</span> <span class="kt">Set</span><span class="o">();</span> <span class="n">users</span>  <span class="k">with</span> <span class="n">modify</span> <span class="n">permissions</span><span class="k">:</span> <span class="kt">Set</span><span class="o">(</span><span class="kt">mijazz</span><span class="o">);</span> <span class="n">groups</span> <span class="k">with</span> <span class="n">modify</span> <span class="n">permissions</span><span class="k">:</span> <span class="kt">Set</span><span class="o">()</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">Utils:</span> <span class="kt">Successfully</span> <span class="kt">started</span> <span class="kt">service</span> <span class="kt">'sparkDriver'</span> <span class="kt">on</span> <span class="kt">port</span> <span class="err">46007</span><span class="kt">.</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SparkEnv:</span> <span class="kt">Registering</span> <span class="kt">MapOutputTracker</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">24</span> <span class="kt">INFO</span> <span class="kt">SparkEnv:</span> <span class="kt">Registering</span> <span class="kt">BlockManagerMaster</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">BlockManagerMasterEndpoint:</span> <span class="kt">Using</span> <span class="kt">org.apache.spark.storage.DefaultTopologyMapper</span> <span class="kt">for</span> <span class="kt">getting</span> <span class="kt">topology</span> <span class="kt">information</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">BlockManagerMasterEndpoint:</span> <span class="kt">BlockManagerMasterEndpoint</span> <span class="kt">up</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">DiskBlockManager:</span> <span class="kt">Created</span> <span class="kt">local</span> <span class="kt">directory</span> <span class="kt">at</span> <span class="kt">/tmp/blockmgr-be049433-</span><span class="err">3</span><span class="kt">f00-</span><span class="err">4037</span><span class="kt">-a865-</span><span class="err">67</span><span class="kt">cd6f445fba</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">MemoryStore:</span> <span class="kt">MemoryStore</span> <span class="kt">started</span> <span class="kt">with</span> <span class="kt">capacity</span> <span class="err">1941</span><span class="kt">.</span><span class="err">6</span> <span class="kt">MB</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">SparkEnv:</span> <span class="kt">Registering</span> <span class="kt">OutputCommitCoordinator</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">Utils:</span> <span class="kt">Successfully</span> <span class="kt">started</span> <span class="kt">service</span> <span class="kt">'SparkUI'</span> <span class="kt">on</span> <span class="kt">port</span> <span class="err">4040</span><span class="kt">.</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">SparkUI:</span> <span class="kt">Bound</span> <span class="kt">SparkUI</span> <span class="kt">to</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span><span class="kt">.</span><span class="err">0</span><span class="kt">.</span><span class="err">0</span><span class="o">,</span> <span class="n">and</span> <span class="n">started</span> <span class="n">at</span> <span class="n">http</span><span class="o">://</span><span class="nv">lenovo</span><span class="o">.</span><span class="py">lan</span><span class="k">:</span><span class="err">4040</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">Executor:</span> <span class="kt">Starting</span> <span class="kt">executor</span> <span class="kt">ID</span> <span class="kt">driver</span> <span class="kt">on</span> <span class="kt">host</span> <span class="kt">localhost</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">Utils:</span> <span class="kt">Successfully</span> <span class="kt">started</span> <span class="kt">service</span> <span class="kt">'org.apache.spark.network.netty.NettyBlockTransferService'</span> <span class="kt">on</span> <span class="kt">port</span> <span class="err">44811</span><span class="kt">.</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">NettyBlockTransferService:</span> <span class="kt">Server</span> <span class="kt">created</span> <span class="kt">on</span> <span class="kt">lenovo.lan:</span><span class="err">44811</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">BlockManager:</span> <span class="kt">Using</span> <span class="kt">org.apache.spark.storage.RandomBlockReplicationPolicy</span> <span class="kt">for</span> <span class="kt">block</span> <span class="kt">replication</span> <span class="kt">policy</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">BlockManagerMaster:</span> <span class="kt">Registering</span> <span class="kt">BlockManager</span> <span class="kt">BlockManagerId</span><span class="o">(</span><span class="kt">driver</span><span class="o">,</span> <span class="kt">lenovo.lan</span><span class="o">,</span> <span class="mi">44811</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">BlockManagerMasterEndpoint:</span> <span class="kt">Registering</span> <span class="kt">block</span> <span class="kt">manager</span> <span class="kt">lenovo.lan:</span><span class="err">44811</span> <span class="kt">with</span> <span class="err">1941</span><span class="kt">.</span><span class="err">6</span> <span class="kt">MB</span> <span class="kt">RAM</span><span class="o">,</span> <span class="nc">BlockManagerId</span><span class="o">(</span><span class="n">driver</span><span class="o">,</span> <span class="nv">lenovo</span><span class="o">.</span><span class="py">lan</span><span class="o">,</span> <span class="mi">44811</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">BlockManagerMaster:</span> <span class="kt">Registered</span> <span class="kt">BlockManager</span> <span class="kt">BlockManagerId</span><span class="o">(</span><span class="kt">driver</span><span class="o">,</span> <span class="kt">lenovo.lan</span><span class="o">,</span> <span class="mi">44811</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">BlockManager:</span> <span class="kt">Initialized</span> <span class="kt">BlockManager:</span> <span class="kt">BlockManagerId</span><span class="o">(</span><span class="kt">driver</span><span class="o">,</span> <span class="kt">lenovo.lan</span><span class="o">,</span> <span class="mi">44811</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">25</span> <span class="kt">INFO</span> <span class="kt">SparkContext:</span> <span class="kt">Starting</span> <span class="kt">job:</span> <span class="kt">reduce</span> <span class="kt">at</span> <span class="kt">HelloWorld.scala:</span><span class="err">15</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">DAGScheduler:</span> <span class="kt">Got</span> <span class="kt">job</span> <span class="err">0</span> <span class="o">(</span><span class="kt">reduce</span> <span class="kt">at</span> <span class="kt">HelloWorld.scala:</span><span class="err">15</span><span class="o">)</span> <span class="kt">with</span> <span class="err">3</span> <span class="kt">output</span> <span class="kt">partitions</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">DAGScheduler:</span> <span class="kt">Final</span> <span class="kt">stage:</span> <span class="kt">ResultStage</span> <span class="err">0</span> <span class="o">(</span><span class="kt">reduce</span> <span class="kt">at</span> <span class="kt">HelloWorld.scala:</span><span class="err">15</span><span class="o">)</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">DAGScheduler:</span> <span class="kt">Parents</span> <span class="kt">of</span> <span class="kt">final</span> <span class="kt">stage:</span> <span class="kt">List</span><span class="o">()</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">DAGScheduler:</span> <span class="kt">Missing</span> <span class="kt">parents:</span> <span class="kt">List</span><span class="o">()</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">DAGScheduler:</span> <span class="kt">Submitting</span> <span class="kt">ResultStage</span> <span class="err">0</span> <span class="o">(</span><span class="kt">MapPartitionsRDD</span><span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="kt">at</span> <span class="kt">map</span> <span class="kt">at</span> <span class="kt">HelloWorld.scala:</span><span class="err">11</span><span class="o">),</span> <span class="n">which</span> <span class="n">has</span> <span class="n">no</span> <span class="n">missing</span> <span class="n">parents</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">MemoryStore:</span> <span class="kt">Block</span> <span class="kt">broadcast_0</span> <span class="kt">stored</span> <span class="kt">as</span> <span class="kt">values</span> <span class="kt">in</span> <span class="kt">memory</span> <span class="o">(</span><span class="kt">estimated</span> <span class="kt">size</span> <span class="err">2</span><span class="kt">.</span><span class="err">0</span> <span class="kt">KB</span><span class="o">,</span> <span class="kt">free</span> <span class="err">1941</span><span class="kt">.</span><span class="err">6</span> <span class="kt">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">MemoryStore:</span> <span class="kt">Block</span> <span class="kt">broadcast_0_piece0</span> <span class="kt">stored</span> <span class="kt">as</span> <span class="kt">bytes</span> <span class="kt">in</span> <span class="kt">memory</span> <span class="o">(</span><span class="kt">estimated</span> <span class="kt">size</span> <span class="err">1401</span><span class="kt">.</span><span class="err">0</span> <span class="kt">B</span><span class="o">,</span> <span class="kt">free</span> <span class="err">1941</span><span class="kt">.</span><span class="err">6</span> <span class="kt">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">BlockManagerInfo:</span> <span class="kt">Added</span> <span class="kt">broadcast_0_piece0</span> <span class="kt">in</span> <span class="kt">memory</span> <span class="kt">on</span> <span class="kt">lenovo.lan:</span><span class="err">44811</span> <span class="o">(</span><span class="kt">size:</span> <span class="err">1401</span><span class="kt">.</span><span class="err">0</span> <span class="kt">B</span><span class="o">,</span> <span class="kt">free:</span> <span class="err">1941</span><span class="kt">.</span><span class="err">6</span> <span class="kt">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">SparkContext:</span> <span class="kt">Created</span> <span class="kt">broadcast</span> <span class="err">0</span> <span class="kt">from</span> <span class="kt">broadcast</span> <span class="kt">at</span> <span class="kt">DAGScheduler.scala:</span><span class="err">1184</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">DAGScheduler:</span> <span class="kt">Submitting</span> <span class="err">3</span> <span class="kt">missing</span> <span class="kt">tasks</span> <span class="kt">from</span> <span class="kt">ResultStage</span> <span class="err">0</span> <span class="o">(</span><span class="kt">MapPartitionsRDD</span><span class="o">[</span><span class="err">1</span><span class="o">]</span> <span class="kt">at</span> <span class="kt">map</span> <span class="kt">at</span> <span class="kt">HelloWorld.scala:</span><span class="err">11</span><span class="o">)</span> <span class="o">(</span><span class="n">first</span> <span class="mi">15</span> <span class="n">tasks</span> <span class="n">are</span> <span class="k">for</span> <span class="n">partitions</span> <span class="nc">Vector</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">))</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">TaskSchedulerImpl:</span> <span class="kt">Adding</span> <span class="kt">task</span> <span class="kt">set</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="kt">with</span> <span class="err">3</span> <span class="kt">tasks</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">TaskSetManager:</span> <span class="kt">Starting</span> <span class="kt">task</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">0</span><span class="o">,</span> <span class="kt">localhost</span><span class="o">,</span> <span class="n">executor</span> <span class="n">driver</span><span class="o">,</span> <span class="n">partition</span> <span class="mi">0</span><span class="o">,</span> <span class="nc">PROCESS_LOCAL</span><span class="o">,</span> <span class="mi">7866</span> <span class="n">bytes</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">26</span> <span class="kt">INFO</span> <span class="kt">Executor:</span> <span class="kt">Running</span> <span class="kt">task</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">0</span><span class="o">)</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">27</span> <span class="kt">INFO</span> <span class="kt">Executor:</span> <span class="kt">Finished</span> <span class="kt">task</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">0</span><span class="o">)</span><span class="kt">.</span> <span class="err">867</span> <span class="kt">bytes</span> <span class="kt">result</span> <span class="kt">sent</span> <span class="kt">to</span> <span class="kt">driver</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">27</span> <span class="kt">INFO</span> <span class="kt">TaskSetManager:</span> <span class="kt">Starting</span> <span class="kt">task</span> <span class="err">1</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">1</span><span class="o">,</span> <span class="kt">localhost</span><span class="o">,</span> <span class="n">executor</span> <span class="n">driver</span><span class="o">,</span> <span class="n">partition</span> <span class="mi">1</span><span class="o">,</span> <span class="nc">PROCESS_LOCAL</span><span class="o">,</span> <span class="mi">7866</span> <span class="n">bytes</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">27</span> <span class="kt">INFO</span> <span class="kt">Executor:</span> <span class="kt">Running</span> <span class="kt">task</span> <span class="err">1</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">1</span><span class="o">)</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">27</span> <span class="kt">INFO</span> <span class="kt">TaskSetManager:</span> <span class="kt">Finished</span> <span class="kt">task</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">0</span><span class="o">)</span> <span class="kt">in</span> <span class="err">1038</span> <span class="kt">ms</span> <span class="kt">on</span> <span class="kt">localhost</span> <span class="o">(</span><span class="kt">executor</span> <span class="kt">driver</span><span class="o">)</span> <span class="o">(</span><span class="err">1</span><span class="kt">/</span><span class="err">3</span><span class="o">)</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">28</span> <span class="kt">INFO</span> <span class="kt">Executor:</span> <span class="kt">Finished</span> <span class="kt">task</span> <span class="err">1</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">1</span><span class="o">)</span><span class="kt">.</span> <span class="err">867</span> <span class="kt">bytes</span> <span class="kt">result</span> <span class="kt">sent</span> <span class="kt">to</span> <span class="kt">driver</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">28</span> <span class="kt">INFO</span> <span class="kt">TaskSetManager:</span> <span class="kt">Starting</span> <span class="kt">task</span> <span class="err">2</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">2</span><span class="o">,</span> <span class="kt">localhost</span><span class="o">,</span> <span class="n">executor</span> <span class="n">driver</span><span class="o">,</span> <span class="n">partition</span> <span class="mi">2</span><span class="o">,</span> <span class="nc">PROCESS_LOCAL</span><span class="o">,</span> <span class="mi">7866</span> <span class="n">bytes</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">28</span> <span class="kt">INFO</span> <span class="kt">Executor:</span> <span class="kt">Running</span> <span class="kt">task</span> <span class="err">2</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">2</span><span class="o">)</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">28</span> <span class="kt">INFO</span> <span class="kt">TaskSetManager:</span> <span class="kt">Finished</span> <span class="kt">task</span> <span class="err">1</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">1</span><span class="o">)</span> <span class="kt">in</span> <span class="err">998</span> <span class="kt">ms</span> <span class="kt">on</span> <span class="kt">localhost</span> <span class="o">(</span><span class="kt">executor</span> <span class="kt">driver</span><span class="o">)</span> <span class="o">(</span><span class="err">2</span><span class="kt">/</span><span class="err">3</span><span class="o">)</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">Executor:</span> <span class="kt">Finished</span> <span class="kt">task</span> <span class="err">2</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">2</span><span class="o">)</span><span class="kt">.</span> <span class="err">867</span> <span class="kt">bytes</span> <span class="kt">result</span> <span class="kt">sent</span> <span class="kt">to</span> <span class="kt">driver</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">TaskSetManager:</span> <span class="kt">Finished</span> <span class="kt">task</span> <span class="err">2</span><span class="kt">.</span><span class="err">0</span> <span class="kt">in</span> <span class="kt">stage</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span> <span class="o">(</span><span class="kt">TID</span> <span class="err">2</span><span class="o">)</span> <span class="kt">in</span> <span class="err">991</span> <span class="kt">ms</span> <span class="kt">on</span> <span class="kt">localhost</span> <span class="o">(</span><span class="kt">executor</span> <span class="kt">driver</span><span class="o">)</span> <span class="o">(</span><span class="err">3</span><span class="kt">/</span><span class="err">3</span><span class="o">)</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">TaskSchedulerImpl:</span> <span class="kt">Removed</span> <span class="kt">TaskSet</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span><span class="o">,</span> <span class="n">whose</span> <span class="n">tasks</span> <span class="n">have</span> <span class="n">all</span> <span class="n">completed</span><span class="o">,</span> <span class="n">from</span> <span class="n">pool</span> 
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">DAGScheduler:</span> <span class="kt">ResultStage</span> <span class="err">0</span> <span class="o">(</span><span class="kt">reduce</span> <span class="kt">at</span> <span class="kt">HelloWorld.scala:</span><span class="err">15</span><span class="o">)</span> <span class="kt">finished</span> <span class="kt">in</span> <span class="err">3</span><span class="kt">.</span><span class="err">169</span> <span class="kt">s</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">DAGScheduler:</span> <span class="kt">Job</span> <span class="err">0</span> <span class="kt">finished:</span> <span class="kt">reduce</span> <span class="kt">at</span> <span class="kt">HelloWorld.scala:</span><span class="err">15</span><span class="o">,</span> <span class="n">took</span> <span class="mf">3.204133</span> <span class="n">s</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">SparkUI:</span> <span class="kt">Stopped</span> <span class="kt">Spark</span> <span class="kt">web</span> <span class="kt">UI</span> <span class="kt">at</span> <span class="kt">http://lenovo.lan:</span><span class="err">4040</span>
<span class="kt">Pi</span> <span class="kt">is</span> <span class="kt">roughly</span> <span class="err">3</span><span class="kt">.</span><span class="err">141491662829833</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">MapOutputTrackerMasterEndpoint:</span> <span class="kt">MapOutputTrackerMasterEndpoint</span> <span class="kt">stopped!</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">MemoryStore:</span> <span class="kt">MemoryStore</span> <span class="kt">cleared</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">BlockManager:</span> <span class="kt">BlockManager</span> <span class="kt">stopped</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">BlockManagerMaster:</span> <span class="kt">BlockManagerMaster</span> <span class="kt">stopped</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">OutputCommitCoordinator$OutputCommitCoordinatorEndpoint:</span> <span class="kt">OutputCommitCoordinator</span> <span class="kt">stopped!</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">SparkContext:</span> <span class="kt">Successfully</span> <span class="kt">stopped</span> <span class="kt">SparkContext</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">SparkContext:</span> <span class="kt">SparkContext</span> <span class="kt">already</span> <span class="kt">stopped.</span>
<span class="err">20</span><span class="kt">/</span><span class="err">11</span><span class="kt">/</span><span class="err">29</span> <span class="err">22</span><span class="kt">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">ShutdownHookManager:</span> <span class="kt">Shutdown</span> <span class="kt">hook</span> <span class="kt">called</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">29</span> <span class="mi">22</span><span class="k">:</span><span class="err">21</span><span class="kt">:</span><span class="err">29</span> <span class="kt">INFO</span> <span class="kt">ShutdownHookManager:</span> <span class="kt">Deleting</span> <span class="kt">directory</span> <span class="kt">/tmp/spark-</span><span class="err">701</span><span class="kt">b3922-</span><span class="err">5</span><span class="kt">c91-</span><span class="err">4</span><span class="kt">ada-</span><span class="err">80</span><span class="kt">de-</span><span class="err">0319</span><span class="kt">be2db7e3</span>
</pre></table></code></div></div></ul><p>能够跑出结果, 说明在<code class="language-plaintext highlighter-rouge">IDEA</code>中直接使用<code class="language-plaintext highlighter-rouge">scala</code>与<code class="language-plaintext highlighter-rouge">spark</code>交互已经没问题了. 现在开始找数据集试试<code class="language-plaintext highlighter-rouge">DataFrame</code></p><h1 id="data-practicing-ep4">Data Practicing-EP4</h1><h2 id="find-data">Find Data<a href="#find-data" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>Chicago Crime Data is from <code class="language-plaintext highlighter-rouge">CHICAGO DATA PORTAL</code></p><p><a href="https://data.cityofchicago.org">Visit Here</a></p></blockquote><p>这次使用的是Chicago的Crime Data. 从2001年至最近的.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs  <span class="nb">wc</span> <span class="nt">-l</span> chicagoCrimeData.csv
7212274 chicagoCrimeData.csv
 mijazz@lenovo  ~/devEnvs  <span class="nb">head</span> <span class="nt">-n</span> 2 ./chicagoCrimeData.csv 
ID,Case Number,Date,Block,IUCR,Primary Type,Description,Location Description,Arrest,Domestic,Beat,District,Ward,Community Area,FBI Code,X Coordinate,Y Coordinate,Year,Updated On,Latitude,Longitude,Location
11034701,JA366925,01/01/2001 11:00:00 AM,016XX E 86TH PL,1153,DECEPTIVE PRACTICE,FINANCIAL IDENTITY THEFT OVER <span class="nv">$ </span>300,RESIDENCE,false,false,0412,004,8,45,11,,,2001,08/05/2017 03:50:08 PM,,,
 mijazz@lenovo  ~/devEnvs  <span class="nb">tail</span> <span class="nt">-n</span> 2 ./chicagoCrimeData.csv 
11707239,JC287563,11/30/2017 09:00:00 AM,022XX S KOSTNER AVE,1153,DECEPTIVE PRACTICE,FINANCIAL IDENTITY THEFT OVER <span class="nv">$ </span>300,RESIDENCE,false,false,1013,010,22,29,11,,,2017,06/02/2019 04:09:42 PM,,,
24559,JC278908,05/26/2019 02:11:00 AM,013XX W HASTINGS ST,0110,HOMICIDE,FIRST DEGREE MURDER,STREET,false,false,1233,012,25,28,01A,1167746,1893853,2019,06/20/2020 03:48:45 PM,41.864278357,-87.659682244,<span class="s2">"(41.864278357, -87.659682244)"</span>
</pre></table></code></div></div><p>共<code class="language-plaintext highlighter-rouge">7,212,274</code>行数据, 每行数据代表一次记录在案的犯罪信息.</p><p>部分列描述如下</p><ul><li>ID - Unique Row ID<li>Case Number - Unique Chicago Police Department Records Division Number, Unique<li>Date<li>Block - Address<li>IUCR - Illinois Uniform Crime Reporting Code<a href="https://data.cityofchicago.org/Public-Safety/Chicago-Police-Department-Illinois-Uniform-Crime-R/c7ck-438e">Code Referrence</a><li>Primary Type - IUCR Code/Crime Description<li>Description - Crime Description<li>Location Description<li>Arrest - Arrest made or not<li>Community Area - Community Area Code <a href="https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Community-Areas-current-/cauq-8yn6">Code Referrence</a><li>Location - (Latitude, Longitude)</ul><h2 id="move-to-hdfs">Move to HDFS<a href="#move-to-hdfs" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>前面说过<code class="language-plaintext highlighter-rouge">hdfs</code>的提供的交互<code class="language-plaintext highlighter-rouge">shell</code>很像<code class="language-plaintext highlighter-rouge">Unix/Linux</code>的文件系统交互.</p><p>文档如下: <a href="https://hadoop.apache.org/docs/r3.1.4/hadoop-project-dist/hadoop-common/FileSystemShell.html">File System Shell</a> 或者 <code class="language-plaintext highlighter-rouge">hdfs dfs -help</code></p></blockquote><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/devEnvs  ll <span class="nt">-a</span>
total 1.8G
drwxr-xr-x 10 mijazz mijazz 4.0K Nov 29 22:45 <span class="nb">.</span>
drwx------ 42 mijazz mijazz 4.0K Nov 30 15:42 ..
drwxr-xr-x  8 mijazz mijazz 4.0K Nov  9 20:23 OpenJDK8
<span class="nt">-rwxrwxrwx</span>  1 mijazz mijazz 1.6G Oct 19 18:05 chicagoCrimeData.csv
drwxr-xr-x 11 mijazz mijazz 4.0K Nov 25 23:49 hadoop-3.1.4
drwxr-xr-x 14 mijazz mijazz 4.0K Nov 29 15:25 spark-2.4.7
<span class="nt">-rw-r--r--</span>  1 mijazz mijazz 161M Nov 24 16:49 spark-2.4.7-bin-without-hadoop.tgz
 mijazz@lenovo  ~/devEnvs  hdfs dfs <span class="nt">-mkdir</span> /user/mijazz/chicagoData                
 mijazz@lenovo  ~/devEnvs  hdfs dfs <span class="nt">-put</span> ./chicagoCrimeData.csv /user/mijazz/chicagoData/originCrimeData.csv 
 mijazz@lenovo  ~/devEnvs  hdfs dfs <span class="nt">-ls</span> /user/mijazz/chicagoData                  
Found 1 items
<span class="nt">-rw-r--r--</span>   1 mijazz supergroup 1701238602 2020-11-30 15:43 /user/mijazz/chicagoData/originCrimeData.csv

</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">dfs -put</code>把文件上传上hdfs, 如果需要<del>多用户读写, <code class="language-plaintext highlighter-rouge">dfs -chmod</code>给个<code class="language-plaintext highlighter-rouge">666</code>之后,</del> 检查一下权限即可.</p><p>上传之后, 在spark中就可以通过<code class="language-plaintext highlighter-rouge">hdfs://your.ip.or.host:port/path/to/file</code>来访问了.</p><p>在我这里就是<code class="language-plaintext highlighter-rouge">hdfs://localhost:9000/user/mijazz/chicagoData/originCrimeData.csv</code></p><h2 id="pre-processing">Pre-Processing<a href="#pre-processing" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>在EP3中配置好的<code class="language-plaintext highlighter-rouge">IntelliJ IDEA</code>的project, 新建一个<code class="language-plaintext highlighter-rouge">Scala Object</code>即可.</p><p>前面几行代码都是必备的了</p><ul><li>用SparkSession拉起一个Spark会话<li>Context负责数据</ul><h3 id="take-a-glance-at-the-data">Take a Glance at the Data<a href="#take-a-glance-at-the-data" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><blockquote><p>Object + main()方法或者Object + extends App 当脚本用</p></blockquote><p><code class="language-plaintext highlighter-rouge">DataPreProcess.scala</code> - 1</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">edu.zstu.mijazz.sparklearn1</span>

<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>

<span class="k">object</span> <span class="nc">DataPreProcess</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">HDFS_PATH</span> <span class="k">=</span> <span class="s">"hdfs://localhost:9000/user/mijazz/"</span>
  <span class="k">val</span> <span class="nv">DATA_PATH</span> <span class="k">=</span> <span class="nc">HDFS_PATH</span> <span class="o">+</span> <span class="s">"chicagoData/"</span>
  <span class="k">def</span> <span class="nf">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="nv">spark</span> <span class="k">=</span> <span class="nv">SparkSession</span><span class="o">.</span><span class="py">builder</span><span class="o">.</span><span class="py">appName</span><span class="o">(</span><span class="s">"Data Pre-Processing"</span><span class="o">).</span><span class="py">master</span><span class="o">(</span><span class="s">"local"</span><span class="o">).</span><span class="py">getOrCreate</span><span class="o">()</span>
    <span class="k">val</span> <span class="nv">sContext</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">sparkContext</span>

    <span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">sContext</span><span class="o">.</span><span class="py">textFile</span><span class="o">(</span><span class="nc">DATA_PATH</span> <span class="o">+</span> <span class="s">"originCrimeData.csv"</span><span class="o">)</span>
    <span class="nv">data</span><span class="o">.</span><span class="py">take</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="py">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><h4 id="full-output">Full Output<a href="#full-output" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><blockquote><p>后面的输出block, 我会把spark的输出手工砍掉. <del>当然你也可以在spark中配置比<code class="language-plaintext highlighter-rouge">info</code>级别高一些的log level, 但是留着便于我知道内存使用量.</del></p></blockquote><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre><td class="rouge-code"><pre><span class="nc">Using</span> <span class="nc">Spark</span><span class="err">'</span><span class="n">s</span> <span class="k">default</span> <span class="n">log4j</span> <span class="nl">profile:</span> <span class="n">org</span><span class="o">/</span><span class="n">apache</span><span class="o">/</span><span class="n">spark</span><span class="o">/</span><span class="n">log4j</span><span class="o">-</span><span class="n">defaults</span><span class="o">.</span><span class="na">properties</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">WARN</span> <span class="nl">Utils:</span> <span class="nc">Your</span> <span class="n">hostname</span><span class="o">,</span> <span class="n">lenovo</span> <span class="n">resolves</span> <span class="n">to</span> <span class="n">a</span> <span class="n">loopback</span> <span class="nl">address:</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="o">;</span> <span class="n">using</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">123.2</span> <span class="n">instead</span> <span class="o">(</span><span class="n">on</span> <span class="kd">interface</span> <span class="nc">enp4s0</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">WARN</span> <span class="nl">Utils:</span> <span class="nc">Set</span> <span class="no">SPARK_LOCAL_IP</span> <span class="k">if</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">bind</span> <span class="n">to</span> <span class="n">another</span> <span class="n">address</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">INFO</span> <span class="nl">SparkContext:</span> <span class="nc">Running</span> <span class="nc">Spark</span> <span class="n">version</span> <span class="mf">2.4</span><span class="o">.</span><span class="mi">7</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">WARN</span> <span class="nl">NativeCodeLoader:</span> <span class="nc">Unable</span> <span class="n">to</span> <span class="n">load</span> <span class="kd">native</span><span class="o">-</span><span class="n">hadoop</span> <span class="n">library</span> <span class="k">for</span> <span class="n">your</span> <span class="n">platform</span><span class="o">...</span> <span class="n">using</span> <span class="n">builtin</span><span class="o">-</span><span class="n">java</span> <span class="n">classes</span> <span class="n">where</span> <span class="n">applicable</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">INFO</span> <span class="nl">SparkContext:</span> <span class="nc">Submitted</span> <span class="nl">application:</span> <span class="nc">Data</span> <span class="nc">Pre</span><span class="o">-</span><span class="nc">Processing</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">INFO</span> <span class="nl">SecurityManager:</span> <span class="nc">Changing</span> <span class="n">view</span> <span class="n">acls</span> <span class="nl">to:</span> <span class="n">mijazz</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">INFO</span> <span class="nl">SecurityManager:</span> <span class="nc">Changing</span> <span class="n">modify</span> <span class="n">acls</span> <span class="nl">to:</span> <span class="n">mijazz</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">INFO</span> <span class="nl">SecurityManager:</span> <span class="nc">Changing</span> <span class="n">view</span> <span class="n">acls</span> <span class="n">groups</span> <span class="nl">to:</span> 
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">INFO</span> <span class="nl">SecurityManager:</span> <span class="nc">Changing</span> <span class="n">modify</span> <span class="n">acls</span> <span class="n">groups</span> <span class="nl">to:</span> 
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">51</span> <span class="no">INFO</span> <span class="nl">SecurityManager:</span> <span class="nl">SecurityManager:</span> <span class="n">authentication</span> <span class="n">disabled</span><span class="o">;</span> <span class="n">ui</span> <span class="n">acls</span> <span class="n">disabled</span><span class="o">;</span> <span class="n">users</span>  <span class="n">with</span> <span class="n">view</span> <span class="nl">permissions:</span> <span class="nc">Set</span><span class="o">(</span><span class="n">mijazz</span><span class="o">);</span> <span class="n">groups</span> <span class="n">with</span> <span class="n">view</span> <span class="nl">permissions:</span> <span class="nc">Set</span><span class="o">();</span> <span class="n">users</span>  <span class="n">with</span> <span class="n">modify</span> <span class="nl">permissions:</span> <span class="nc">Set</span><span class="o">(</span><span class="n">mijazz</span><span class="o">);</span> <span class="n">groups</span> <span class="n">with</span> <span class="n">modify</span> <span class="nl">permissions:</span> <span class="nc">Set</span><span class="o">()</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">Utils:</span> <span class="nc">Successfully</span> <span class="n">started</span> <span class="n">service</span> <span class="err">'</span><span class="n">sparkDriver</span><span class="err">'</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">35377</span><span class="o">.</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">SparkEnv:</span> <span class="nc">Registering</span> <span class="nc">MapOutputTracker</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">SparkEnv:</span> <span class="nc">Registering</span> <span class="nc">BlockManagerMaster</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">BlockManagerMasterEndpoint:</span> <span class="nc">Using</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">storage</span><span class="o">.</span><span class="na">DefaultTopologyMapper</span> <span class="k">for</span> <span class="n">getting</span> <span class="n">topology</span> <span class="n">information</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">BlockManagerMasterEndpoint:</span> <span class="nc">BlockManagerMasterEndpoint</span> <span class="n">up</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">DiskBlockManager:</span> <span class="nc">Created</span> <span class="n">local</span> <span class="n">directory</span> <span class="n">at</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">blockmgr</span><span class="o">-</span><span class="mi">283</span><span class="n">f5487</span><span class="o">-</span><span class="n">ed7e</span><span class="o">-</span><span class="mi">41</span><span class="n">b8</span><span class="o">-</span><span class="mi">92</span><span class="n">ae</span><span class="o">-</span><span class="mi">20</span><span class="n">d56fb33ba5</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">MemoryStore:</span> <span class="nc">MemoryStore</span> <span class="n">started</span> <span class="n">with</span> <span class="n">capacity</span> <span class="mf">1941.6</span> <span class="no">MB</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">SparkEnv:</span> <span class="nc">Registering</span> <span class="nc">OutputCommitCoordinator</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">Utils:</span> <span class="nc">Successfully</span> <span class="n">started</span> <span class="n">service</span> <span class="err">'</span><span class="nc">SparkUI</span><span class="err">'</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">4040</span><span class="o">.</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">SparkUI:</span> <span class="nc">Bound</span> <span class="nc">SparkUI</span> <span class="n">to</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">,</span> <span class="n">and</span> <span class="n">started</span> <span class="n">at</span> <span class="nl">http:</span><span class="c1">//lenovo.lan:4040</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">Executor:</span> <span class="nc">Starting</span> <span class="n">executor</span> <span class="no">ID</span> <span class="n">driver</span> <span class="n">on</span> <span class="n">host</span> <span class="n">localhost</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">Utils:</span> <span class="nc">Successfully</span> <span class="n">started</span> <span class="n">service</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">network</span><span class="o">.</span><span class="na">netty</span><span class="o">.</span><span class="na">NettyBlockTransferService</span><span class="err">'</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">37555</span><span class="o">.</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">NettyBlockTransferService:</span> <span class="nc">Server</span> <span class="n">created</span> <span class="n">on</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">lan</span><span class="o">:</span><span class="mi">37555</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">BlockManager:</span> <span class="nc">Using</span> <span class="n">org</span><span class="o">.</span><span class="na">apache</span><span class="o">.</span><span class="na">spark</span><span class="o">.</span><span class="na">storage</span><span class="o">.</span><span class="na">RandomBlockReplicationPolicy</span> <span class="k">for</span> <span class="n">block</span> <span class="n">replication</span> <span class="n">policy</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">BlockManagerMaster:</span> <span class="nc">Registering</span> <span class="nc">BlockManager</span> <span class="nf">BlockManagerId</span><span class="o">(</span><span class="n">driver</span><span class="o">,</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">lan</span><span class="o">,</span> <span class="mi">37555</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">BlockManagerMasterEndpoint:</span> <span class="nc">Registering</span> <span class="n">block</span> <span class="n">manager</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">lan</span><span class="o">:</span><span class="mi">37555</span> <span class="n">with</span> <span class="mf">1941.6</span> <span class="no">MB</span> <span class="no">RAM</span><span class="o">,</span> <span class="nc">BlockManagerId</span><span class="o">(</span><span class="n">driver</span><span class="o">,</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">lan</span><span class="o">,</span> <span class="mi">37555</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">BlockManagerMaster:</span> <span class="nc">Registered</span> <span class="nc">BlockManager</span> <span class="nf">BlockManagerId</span><span class="o">(</span><span class="n">driver</span><span class="o">,</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">lan</span><span class="o">,</span> <span class="mi">37555</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">52</span> <span class="no">INFO</span> <span class="nl">BlockManager:</span> <span class="nc">Initialized</span> <span class="nl">BlockManager:</span> <span class="nc">BlockManagerId</span><span class="o">(</span><span class="n">driver</span><span class="o">,</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">lan</span><span class="o">,</span> <span class="mi">37555</span><span class="o">,</span> <span class="nc">None</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">MemoryStore:</span> <span class="nc">Block</span> <span class="n">broadcast_0</span> <span class="n">stored</span> <span class="n">as</span> <span class="n">values</span> <span class="n">in</span> <span class="nf">memory</span> <span class="o">(</span><span class="n">estimated</span> <span class="n">size</span> <span class="mf">214.6</span> <span class="no">KB</span><span class="o">,</span> <span class="n">free</span> <span class="mf">1941.4</span> <span class="no">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">MemoryStore:</span> <span class="nc">Block</span> <span class="n">broadcast_0_piece0</span> <span class="n">stored</span> <span class="n">as</span> <span class="n">bytes</span> <span class="n">in</span> <span class="nf">memory</span> <span class="o">(</span><span class="n">estimated</span> <span class="n">size</span> <span class="mf">20.4</span> <span class="no">KB</span><span class="o">,</span> <span class="n">free</span> <span class="mf">1941.4</span> <span class="no">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">BlockManagerInfo:</span> <span class="nc">Added</span> <span class="n">broadcast_0_piece0</span> <span class="n">in</span> <span class="n">memory</span> <span class="n">on</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">lan</span><span class="o">:</span><span class="mi">37555</span> <span class="o">(</span><span class="nl">size:</span> <span class="mf">20.4</span> <span class="no">KB</span><span class="o">,</span> <span class="nl">free:</span> <span class="mf">1941.6</span> <span class="no">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">SparkContext:</span> <span class="nc">Created</span> <span class="n">broadcast</span> <span class="mi">0</span> <span class="n">from</span> <span class="n">textFile</span> <span class="n">at</span> <span class="nc">DataPreProcess</span><span class="o">.</span><span class="na">scala</span><span class="o">:</span><span class="mi">12</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">FileInputFormat:</span> <span class="nc">Total</span> <span class="n">input</span> <span class="n">paths</span> <span class="n">to</span> <span class="n">process</span> <span class="o">:</span> <span class="mi">1</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">SparkContext:</span> <span class="nc">Starting</span> <span class="nl">job:</span> <span class="n">take</span> <span class="n">at</span> <span class="nc">DataPreProcess</span><span class="o">.</span><span class="na">scala</span><span class="o">:</span><span class="mi">13</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">DAGScheduler:</span> <span class="nc">Got</span> <span class="n">job</span> <span class="mi">0</span> <span class="o">(</span><span class="n">take</span> <span class="n">at</span> <span class="nc">DataPreProcess</span><span class="o">.</span><span class="na">scala</span><span class="o">:</span><span class="mi">13</span><span class="o">)</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">output</span> <span class="n">partitions</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">DAGScheduler:</span> <span class="nc">Final</span> <span class="nl">stage:</span> <span class="nc">ResultStage</span> <span class="mi">0</span> <span class="o">(</span><span class="n">take</span> <span class="n">at</span> <span class="nc">DataPreProcess</span><span class="o">.</span><span class="na">scala</span><span class="o">:</span><span class="mi">13</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">DAGScheduler:</span> <span class="nc">Parents</span> <span class="n">of</span> <span class="kd">final</span> <span class="nl">stage:</span> <span class="nc">List</span><span class="o">()</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">DAGScheduler:</span> <span class="nc">Missing</span> <span class="nl">parents:</span> <span class="nc">List</span><span class="o">()</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">DAGScheduler:</span> <span class="nc">Submitting</span> <span class="nc">ResultStage</span> <span class="mi">0</span> <span class="o">(</span><span class="nl">hdfs:</span><span class="c1">//localhost:9000/user/mijazz/chicagoData/originCrimeData.csv MapPartitionsRDD[1] at textFile at DataPreProcess.scala:12), which has no missing parents</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">MemoryStore:</span> <span class="nc">Block</span> <span class="n">broadcast_1</span> <span class="n">stored</span> <span class="n">as</span> <span class="n">values</span> <span class="n">in</span> <span class="nf">memory</span> <span class="o">(</span><span class="n">estimated</span> <span class="n">size</span> <span class="mf">3.6</span> <span class="no">KB</span><span class="o">,</span> <span class="n">free</span> <span class="mf">1941.4</span> <span class="no">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">MemoryStore:</span> <span class="nc">Block</span> <span class="n">broadcast_1_piece0</span> <span class="n">stored</span> <span class="n">as</span> <span class="n">bytes</span> <span class="n">in</span> <span class="nf">memory</span> <span class="o">(</span><span class="n">estimated</span> <span class="n">size</span> <span class="mf">2.2</span> <span class="no">KB</span><span class="o">,</span> <span class="n">free</span> <span class="mf">1941.4</span> <span class="no">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">BlockManagerInfo:</span> <span class="nc">Added</span> <span class="n">broadcast_1_piece0</span> <span class="n">in</span> <span class="n">memory</span> <span class="n">on</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">lan</span><span class="o">:</span><span class="mi">37555</span> <span class="o">(</span><span class="nl">size:</span> <span class="mf">2.2</span> <span class="no">KB</span><span class="o">,</span> <span class="nl">free:</span> <span class="mf">1941.6</span> <span class="no">MB</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">SparkContext:</span> <span class="nc">Created</span> <span class="n">broadcast</span> <span class="mi">1</span> <span class="n">from</span> <span class="n">broadcast</span> <span class="n">at</span> <span class="nc">DAGScheduler</span><span class="o">.</span><span class="na">scala</span><span class="o">:</span><span class="mi">1184</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">DAGScheduler:</span> <span class="nc">Submitting</span> <span class="mi">1</span> <span class="n">missing</span> <span class="n">tasks</span> <span class="n">from</span> <span class="nc">ResultStage</span> <span class="mi">0</span> <span class="o">(</span><span class="nl">hdfs:</span><span class="c1">//localhost:9000/user/mijazz/chicagoData/originCrimeData.csv MapPartitionsRDD[1] at textFile at DataPreProcess.scala:12) (first 15 tasks are for partitions Vector(0))</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">53</span> <span class="no">INFO</span> <span class="nl">TaskSchedulerImpl:</span> <span class="nc">Adding</span> <span class="n">task</span> <span class="n">set</span> <span class="mf">0.0</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">tasks</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">TaskSetManager:</span> <span class="nc">Starting</span> <span class="n">task</span> <span class="mf">0.0</span> <span class="n">in</span> <span class="n">stage</span> <span class="mf">0.0</span> <span class="o">(</span><span class="no">TID</span> <span class="mi">0</span><span class="o">,</span> <span class="n">localhost</span><span class="o">,</span> <span class="n">executor</span> <span class="n">driver</span><span class="o">,</span> <span class="n">partition</span> <span class="mi">0</span><span class="o">,</span> <span class="no">PROCESS_LOCAL</span><span class="o">,</span> <span class="mi">7925</span> <span class="n">bytes</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">Executor:</span> <span class="nc">Running</span> <span class="n">task</span> <span class="mf">0.0</span> <span class="n">in</span> <span class="n">stage</span> <span class="mf">0.0</span> <span class="o">(</span><span class="no">TID</span> <span class="mi">0</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">HadoopRDD:</span> <span class="nc">Input</span> <span class="nl">split:</span> <span class="nl">hdfs:</span><span class="c1">//localhost:9000/user/mijazz/chicagoData/originCrimeData.csv:0+134217728</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">Executor:</span> <span class="nc">Finished</span> <span class="n">task</span> <span class="mf">0.0</span> <span class="n">in</span> <span class="n">stage</span> <span class="mf">0.0</span> <span class="o">(</span><span class="no">TID</span> <span class="mi">0</span><span class="o">).</span> <span class="mi">1371</span> <span class="n">bytes</span> <span class="n">result</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">driver</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">TaskSetManager:</span> <span class="nc">Finished</span> <span class="n">task</span> <span class="mf">0.0</span> <span class="n">in</span> <span class="n">stage</span> <span class="mf">0.0</span> <span class="o">(</span><span class="no">TID</span> <span class="mi">0</span><span class="o">)</span> <span class="n">in</span> <span class="mi">133</span> <span class="n">ms</span> <span class="n">on</span> <span class="nf">localhost</span> <span class="o">(</span><span class="n">executor</span> <span class="n">driver</span><span class="o">)</span> <span class="o">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">1</span><span class="o">)</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">TaskSchedulerImpl:</span> <span class="nc">Removed</span> <span class="nc">TaskSet</span> <span class="mf">0.0</span><span class="o">,</span> <span class="n">whose</span> <span class="n">tasks</span> <span class="n">have</span> <span class="n">all</span> <span class="n">completed</span><span class="o">,</span> <span class="n">from</span> <span class="n">pool</span> 
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">DAGScheduler:</span> <span class="nc">ResultStage</span> <span class="mi">0</span> <span class="o">(</span><span class="n">take</span> <span class="n">at</span> <span class="nc">DataPreProcess</span><span class="o">.</span><span class="na">scala</span><span class="o">:</span><span class="mi">13</span><span class="o">)</span> <span class="n">finished</span> <span class="n">in</span> <span class="mf">0.183</span> <span class="n">s</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">DAGScheduler:</span> <span class="nc">Job</span> <span class="mi">0</span> <span class="nl">finished:</span> <span class="n">take</span> <span class="n">at</span> <span class="nc">DataPreProcess</span><span class="o">.</span><span class="na">scala</span><span class="o">:</span><span class="mi">13</span><span class="o">,</span> <span class="n">took</span> <span class="mf">0.217644</span> <span class="n">s</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">SparkContext:</span> <span class="nc">Invoking</span> <span class="nf">stop</span><span class="o">()</span> <span class="n">from</span> <span class="n">shutdown</span> <span class="n">hook</span>
<span class="no">ID</span><span class="o">,</span><span class="nc">Case</span> <span class="nc">Number</span><span class="o">,</span><span class="nc">Date</span><span class="o">,</span><span class="nc">Block</span><span class="o">,</span><span class="no">IUCR</span><span class="o">,</span><span class="nc">Primary</span> <span class="nc">Type</span><span class="o">,</span><span class="nc">Description</span><span class="o">,</span><span class="nc">Location</span> <span class="nc">Description</span><span class="o">,</span><span class="nc">Arrest</span><span class="o">,</span><span class="nc">Domestic</span><span class="o">,</span><span class="nc">Beat</span><span class="o">,</span><span class="nc">District</span><span class="o">,</span><span class="nc">Ward</span><span class="o">,</span><span class="nc">Community</span> <span class="nc">Area</span><span class="o">,</span><span class="no">FBI</span> <span class="nc">Code</span><span class="o">,</span><span class="no">X</span> <span class="nc">Coordinate</span><span class="o">,</span><span class="no">Y</span> <span class="nc">Coordinate</span><span class="o">,</span><span class="nc">Year</span><span class="o">,</span><span class="nc">Updated</span> <span class="nc">On</span><span class="o">,</span><span class="nc">Latitude</span><span class="o">,</span><span class="nc">Longitude</span><span class="o">,</span><span class="nc">Location</span>
<span class="mi">11034701</span><span class="o">,</span><span class="no">JA366925</span><span class="o">,</span><span class="mo">01</span><span class="o">/</span><span class="mo">01</span><span class="o">/</span><span class="mi">2001</span> <span class="mi">11</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span> <span class="no">AM</span><span class="o">,</span><span class="mo">016</span><span class="no">XX</span> <span class="no">E</span> <span class="mi">86</span><span class="no">TH</span> <span class="no">PL</span><span class="o">,</span><span class="mi">1153</span><span class="o">,</span><span class="no">DECEPTIVE</span> <span class="no">PRACTICE</span><span class="o">,</span><span class="no">FINANCIAL</span> <span class="no">IDENTITY</span> <span class="no">THEFT</span> <span class="no">OVER</span> <span class="err">$</span> <span class="mi">300</span><span class="o">,</span><span class="no">RESIDENCE</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="mo">0412</span><span class="o">,</span><span class="mo">004</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">45</span><span class="o">,</span><span class="mi">11</span><span class="o">,,,</span><span class="mi">2001</span><span class="o">,</span><span class="mi">08</span><span class="o">/</span><span class="mo">05</span><span class="o">/</span><span class="mi">2017</span> <span class="mo">03</span><span class="o">:</span><span class="mi">50</span><span class="o">:</span><span class="mi">08</span> <span class="no">PM</span><span class="o">,,,</span>
<span class="mi">11227287</span><span class="o">,</span><span class="no">JB147188</span><span class="o">,</span><span class="mi">10</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">2017</span> <span class="mo">03</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span> <span class="no">AM</span><span class="o">,</span><span class="mi">092</span><span class="no">XX</span> <span class="no">S</span> <span class="no">RACINE</span> <span class="no">AVE</span><span class="o">,</span><span class="mo">02</span><span class="mi">81</span><span class="o">,</span><span class="no">CRIM</span> <span class="no">SEXUAL</span> <span class="no">ASSAULT</span><span class="o">,</span><span class="no">NON</span><span class="o">-</span><span class="no">AGGRAVATED</span><span class="o">,</span><span class="no">RESIDENCE</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="mi">2222</span><span class="o">,</span><span class="mo">022</span><span class="o">,</span><span class="mi">21</span><span class="o">,</span><span class="mi">73</span><span class="o">,</span><span class="mo">02</span><span class="o">,,,</span><span class="mi">2017</span><span class="o">,</span><span class="mo">02</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">2018</span> <span class="mo">03</span><span class="o">:</span><span class="mi">57</span><span class="o">:</span><span class="mi">41</span> <span class="no">PM</span><span class="o">,,,</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">SparkUI:</span> <span class="nc">Stopped</span> <span class="nc">Spark</span> <span class="n">web</span> <span class="no">UI</span> <span class="n">at</span> <span class="nl">http:</span><span class="c1">//lenovo.lan:4040</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">MapOutputTrackerMasterEndpoint:</span> <span class="nc">MapOutputTrackerMasterEndpoint</span> <span class="n">stopped</span><span class="o">!</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">MemoryStore:</span> <span class="nc">MemoryStore</span> <span class="n">cleared</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">BlockManager:</span> <span class="nc">BlockManager</span> <span class="n">stopped</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">BlockManagerMaster:</span> <span class="nc">BlockManagerMaster</span> <span class="n">stopped</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nc">OutputCommitCoordinator</span><span class="n">$OutputCommitCoordinatorEndpoint</span><span class="o">:</span> <span class="nc">OutputCommitCoordinator</span> <span class="n">stopped</span><span class="o">!</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">SparkContext:</span> <span class="nc">Successfully</span> <span class="n">stopped</span> <span class="nc">SparkContext</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">ShutdownHookManager:</span> <span class="nc">Shutdown</span> <span class="n">hook</span> <span class="n">called</span>
<span class="mi">20</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">30</span> <span class="mi">16</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mi">54</span> <span class="no">INFO</span> <span class="nl">ShutdownHookManager:</span> <span class="nc">Deleting</span> <span class="n">directory</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">spark</span><span class="o">-</span><span class="n">c6ba3bd3</span><span class="o">-</span><span class="mi">3</span><span class="n">fc3</span><span class="o">-</span><span class="mi">46</span><span class="n">b8</span><span class="o">-</span><span class="mi">9</span><span class="n">e7e</span><span class="o">-</span><span class="mi">3413981456</span><span class="n">ff</span>

<span class="nc">Process</span> <span class="n">finished</span> <span class="n">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>

</pre></table></code></div></div><h4 id="useful-output">Useful Output<a href="#useful-output" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="no">ID</span><span class="o">,</span><span class="nc">Case</span> <span class="nc">Number</span><span class="o">,</span><span class="nc">Date</span><span class="o">,</span><span class="nc">Block</span><span class="o">,</span><span class="no">IUCR</span><span class="o">,</span><span class="nc">Primary</span> <span class="nc">Type</span><span class="o">,</span><span class="nc">Description</span><span class="o">,</span><span class="nc">Location</span> <span class="nc">Description</span><span class="o">,</span><span class="nc">Arrest</span><span class="o">,</span><span class="nc">Domestic</span><span class="o">,</span><span class="nc">Beat</span><span class="o">,</span><span class="nc">District</span><span class="o">,</span><span class="nc">Ward</span><span class="o">,</span><span class="nc">Community</span> <span class="nc">Area</span><span class="o">,</span><span class="no">FBI</span> <span class="nc">Code</span><span class="o">,</span><span class="no">X</span> <span class="nc">Coordinate</span><span class="o">,</span><span class="no">Y</span> <span class="nc">Coordinate</span><span class="o">,</span><span class="nc">Year</span><span class="o">,</span><span class="nc">Updated</span> <span class="nc">On</span><span class="o">,</span><span class="nc">Latitude</span><span class="o">,</span><span class="nc">Longitude</span><span class="o">,</span><span class="nc">Location</span>
<span class="mi">11034701</span><span class="o">,</span><span class="no">JA366925</span><span class="o">,</span><span class="mo">01</span><span class="o">/</span><span class="mo">01</span><span class="o">/</span><span class="mi">2001</span> <span class="mi">11</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span> <span class="no">AM</span><span class="o">,</span><span class="mo">016</span><span class="no">XX</span> <span class="no">E</span> <span class="mi">86</span><span class="no">TH</span> <span class="no">PL</span><span class="o">,</span><span class="mi">1153</span><span class="o">,</span><span class="no">DECEPTIVE</span> <span class="no">PRACTICE</span><span class="o">,</span><span class="no">FINANCIAL</span> <span class="no">IDENTITY</span> <span class="no">THEFT</span> <span class="no">OVER</span> <span class="err">$</span> <span class="mi">300</span><span class="o">,</span><span class="no">RESIDENCE</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="mo">0412</span><span class="o">,</span><span class="mo">004</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">45</span><span class="o">,</span><span class="mi">11</span><span class="o">,,,</span><span class="mi">2001</span><span class="o">,</span><span class="mi">08</span><span class="o">/</span><span class="mo">05</span><span class="o">/</span><span class="mi">2017</span> <span class="mo">03</span><span class="o">:</span><span class="mi">50</span><span class="o">:</span><span class="mi">08</span> <span class="no">PM</span><span class="o">,,,</span>
<span class="mi">11227287</span><span class="o">,</span><span class="no">JB147188</span><span class="o">,</span><span class="mi">10</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">2017</span> <span class="mo">03</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span> <span class="no">AM</span><span class="o">,</span><span class="mi">092</span><span class="no">XX</span> <span class="no">S</span> <span class="no">RACINE</span> <span class="no">AVE</span><span class="o">,</span><span class="mo">02</span><span class="mi">81</span><span class="o">,</span><span class="no">CRIM</span> <span class="no">SEXUAL</span> <span class="no">ASSAULT</span><span class="o">,</span><span class="no">NON</span><span class="o">-</span><span class="no">AGGRAVATED</span><span class="o">,</span><span class="no">RESIDENCE</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="kc">false</span><span class="o">,</span><span class="mi">2222</span><span class="o">,</span><span class="mo">022</span><span class="o">,</span><span class="mi">21</span><span class="o">,</span><span class="mi">73</span><span class="o">,</span><span class="mo">02</span><span class="o">,,,</span><span class="mi">2017</span><span class="o">,</span><span class="mo">02</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">2018</span> <span class="mo">03</span><span class="o">:</span><span class="mi">57</span><span class="o">:</span><span class="mi">41</span> <span class="no">PM</span><span class="o">,,,</span>
</pre></table></code></div></div><p>有不少空值.</p><p><code class="language-plaintext highlighter-rouge">DataPreProcess.scala</code> - 2</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">edu.zstu.mijazz.sparklearn1</span>

<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>

<span class="k">object</span> <span class="nc">DataPreProcess</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">HDFS_PATH</span> <span class="k">=</span> <span class="s">"hdfs://localhost:9000/user/mijazz/"</span>
  <span class="k">val</span> <span class="nv">DATA_PATH</span> <span class="k">=</span> <span class="nc">HDFS_PATH</span> <span class="o">+</span> <span class="s">"chicagoData/"</span>
  <span class="k">val</span> <span class="nv">spark</span> <span class="k">=</span> <span class="nv">SparkSession</span><span class="o">.</span><span class="py">builder</span><span class="o">.</span><span class="py">appName</span><span class="o">(</span><span class="s">"Data Pre-Processing"</span><span class="o">).</span><span class="py">master</span><span class="o">(</span><span class="s">"local"</span><span class="o">).</span><span class="py">getOrCreate</span><span class="o">()</span>
  <span class="k">val</span> <span class="nv">sContext</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">sparkContext</span>

  <span class="k">val</span> <span class="nv">crimeDataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
    <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"header"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"inferSchema"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="py">csv</span><span class="o">(</span><span class="nc">DATA_PATH</span> <span class="o">+</span> <span class="s">"originCrimeData.csv"</span><span class="o">)</span>

  <span class="nv">crimeDataFrame</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="nv">crimeDataFrame</span><span class="o">.</span><span class="py">printSchema</span><span class="o">()</span>

  <span class="nv">spark</span><span class="o">.</span><span class="py">stop</span><span class="o">()</span>
  <span class="nv">spark</span><span class="o">.</span><span class="py">close</span><span class="o">()</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre>+--------+-----------+--------------------+------------------+----+-------------------+--------------------+--------------------+------+--------+----+--------+----+--------------+--------+------------+------------+----+--------------------+--------+---------+--------+
|      ID|Case Number|                Date|             Block|IUCR|       Primary Type|         Description|Location Description|Arrest|Domestic|Beat|District|Ward|Community Area|FBI Code|X Coordinate|Y Coordinate|Year|          Updated On|Latitude|Longitude|Location|
+--------+-----------+--------------------+------------------+----+-------------------+--------------------+--------------------+------+--------+----+--------+----+--------------+--------+------------+------------+----+--------------------+--------+---------+--------+
|11034701|   JA366925|01/01/2001 11:00:...|   016XX E 86TH PL|1153| DECEPTIVE PRACTICE|FINANCIAL IDENTIT...|           RESIDENCE| false|   false| 412|       4|   8|            45|      11|        null|        null|2001|08/05/2017 03:50:...|    null|     null|    null|
|11227287|   JB147188|10/08/2017 03:00:...|092XX S RACINE AVE|0281|CRIM SEXUAL ASSAULT|      NON-AGGRAVATED|           RESIDENCE| false|   false|2222|      22|  21|            73|      02|        null|        null|2017|02/11/2018 03:57:...|    null|     null|    null|
|11227583|   JB147595|03/28/2017 02:00:...|   026XX W 79TH ST|0620|           BURGLARY|      UNLAWFUL ENTRY|               OTHER| false|   false| 835|       8|  18|            70|      05|        null|        null|2017|02/11/2018 03:57:...|    null|     null|    null|
+--------+-----------+--------------------+------------------+----+-------------------+--------------------+--------------------+------+--------+----+--------+----+--------------+--------+------------+------------+----+--------------------+--------+---------+--------+
only showing top 3 rows

root
 |-- ID: integer (nullable = true)
 |-- Case Number: string (nullable = true)
 |-- Date: string (nullable = true)
 |-- Block: string (nullable = true)
 |-- IUCR: string (nullable = true)
 |-- Primary Type: string (nullable = true)
 |-- Description: string (nullable = true)
 |-- Location Description: string (nullable = true)
 |-- Arrest: boolean (nullable = true)
 |-- Domestic: boolean (nullable = true)
 |-- Beat: integer (nullable = true)
 |-- District: integer (nullable = true)
 |-- Ward: integer (nullable = true)
 |-- Community Area: integer (nullable = true)
 |-- FBI Code: string (nullable = true)
 |-- X Coordinate: integer (nullable = true)
 |-- Y Coordinate: integer (nullable = true)
 |-- Year: integer (nullable = true)
 |-- Updated On: string (nullable = true)
 |-- Latitude: double (nullable = true)
 |-- Longitude: double (nullable = true)
 |-- Location: string (nullable = true)

</pre></table></code></div></div><h2 id="start-with-data">Start with Data<a href="#start-with-data" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>为了方便阅读, 多加了一个<code class="language-plaintext highlighter-rouge">Java Class</code> - <code class="language-plaintext highlighter-rouge">StaticTool.java</code>, 专门用来存静态数据.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">edu.zstu.mijazz.sparklearn1</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticTool</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">HDFS_PATH</span> <span class="o">=</span> <span class="s">"hdfs://localhost:9000/user/mijazz/"</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">DATA_PATH</span> <span class="o">=</span> <span class="no">HDFS_PATH</span> <span class="o">+</span> <span class="s">"chicagoData/"</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">ORIGIN_DATA</span> <span class="o">=</span> <span class="no">DATA_PATH</span> <span class="o">+</span> <span class="s">"originCrimeData.csv"</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">DATE_DATA</span> <span class="o">=</span> <span class="no">DATA_PATH</span> <span class="o">+</span> <span class="s">"dateDF.csv"</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="date-column">Date Column<a href="#date-column" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>万事就先从时间开始吧, 对<code class="language-plaintext highlighter-rouge">Date</code>字段先做个分析</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>  <span class="k">val</span> <span class="nv">dateNullRowCount</span> <span class="k">=</span> <span class="nv">crimeDataFrame</span><span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="s">"Date is null"</span><span class="o">).</span><span class="py">count</span><span class="o">()</span>
  <span class="nf">println</span><span class="o">(</span><span class="n">dateNullRowCount</span><span class="o">)</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="mi">0</span>
</pre></table></code></div></div><p>看到日期值并没有空列, 很好, 不用<code class="language-plaintext highlighter-rouge">na.fill</code>了.</p><p><code class="language-plaintext highlighter-rouge">foucsDate.scala</code> - 1</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">edu.zstu.mijazz.sparklearn1</span>

<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>

<span class="k">object</span> <span class="nc">focusDate</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">spark</span> <span class="k">=</span> <span class="nv">SparkSession</span><span class="o">.</span><span class="py">builder</span><span class="o">.</span><span class="py">appName</span><span class="o">(</span><span class="s">"Data Pre-Processing"</span><span class="o">).</span><span class="py">master</span><span class="o">(</span><span class="s">"local"</span><span class="o">).</span><span class="py">getOrCreate</span><span class="o">()</span>
  <span class="k">val</span> <span class="nv">sContext</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">sparkContext</span>
  <span class="k">val</span> <span class="nv">crimeDataFrame</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
    <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"header"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"inferSchema"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="py">csv</span><span class="o">(</span><span class="nv">StaticTool</span><span class="o">.</span><span class="py">DATA_PATH</span> <span class="o">+</span> <span class="s">"originCrimeData.csv"</span><span class="o">)</span>

  <span class="k">var</span> <span class="n">dateNeedColumn</span> <span class="k">=</span> <span class="nv">crimeDataFrame</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"Date"</span><span class="o">,</span> <span class="s">"Primary Type"</span><span class="o">,</span> <span class="s">"Year"</span><span class="o">)</span>
  <span class="nv">dateNeedColumn</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="nv">dateNeedColumn</span><span class="o">.</span><span class="py">printSchema</span><span class="o">()</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>+--------------------+-------------------+----+
|                Date|       Primary Type|Year|
+--------------------+-------------------+----+
|01/01/2001 11:00:...| DECEPTIVE PRACTICE|2001|
|10/08/2017 03:00:...|CRIM SEXUAL ASSAULT|2017|
|03/28/2017 02:00:...|           BURGLARY|2017|
+--------------------+-------------------+----+
only showing top 3 rows

root
 |-- Date: string (nullable = true)
 |-- Primary Type: string (nullable = true)
 |-- Year: integer (nullable = true)
</pre></table></code></div></div><p>看到Date字段居然是<code class="language-plaintext highlighter-rouge">String</code>类型. 做个cast</p><p><code class="language-plaintext highlighter-rouge">foucsDate.scala</code> - 2</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">dateNeedColumn</span> <span class="k">=</span> <span class="n">dateNeedColumn</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"TimeStamp"</span><span class="o">,</span> <span class="nf">unix_timestamp</span><span class="o">(</span>
      <span class="nf">col</span><span class="o">(</span><span class="s">"Date"</span><span class="o">),</span> <span class="s">"MM/dd/yyyy HH:mm:ss"</span><span class="o">).</span><span class="py">cast</span><span class="o">(</span><span class="s">"timestamp"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">drop</span><span class="o">(</span><span class="s">"Date"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">withColumnRenamed</span><span class="o">(</span><span class="s">"Primary Type"</span><span class="o">,</span> <span class="s">"Crime"</span><span class="o">)</span>

  <span class="nv">dateNeedColumn</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
  <span class="nv">dateNeedColumn</span><span class="o">.</span><span class="py">printSchema</span><span class="o">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>+-------------------+----+-------------------+
|              Crime|Year|          TimeStamp|
+-------------------+----+-------------------+
| DECEPTIVE PRACTICE|2001|2001-01-01 11:00:00|
|CRIM SEXUAL ASSAULT|2017|2017-10-08 03:00:00|
|           BURGLARY|2017|2017-03-28 02:00:00|
+-------------------+----+-------------------+
only showing top 3 rows

root
 |-- Crime: string (nullable = true)
 |-- Year: integer (nullable = true)
 |-- TimeStamp: timestamp (nullable = true)
</pre></table></code></div></div><p>把时间都砍出来, 日期或者月份拿来做汇总, <del>时间用来后期画图?</del></p><p><code class="language-plaintext highlighter-rouge">focusDate.scala</code> - 3</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>  <span class="n">dateNeedColumn</span> <span class="k">=</span> <span class="n">dateNeedColumn</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"Year"</span><span class="o">,</span> <span class="nf">col</span><span class="o">(</span><span class="s">"Year"</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"Month"</span><span class="o">,</span> <span class="nf">col</span><span class="o">(</span><span class="s">"TimeStamp"</span><span class="o">).</span><span class="py">substr</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">7</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"Day"</span><span class="o">,</span> <span class="nf">col</span><span class="o">(</span><span class="s">"TimeStamp"</span><span class="o">).</span><span class="py">substr</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"Hour"</span><span class="o">,</span> <span class="nf">col</span><span class="o">(</span><span class="s">"TimeStamp"</span><span class="o">).</span><span class="py">substr</span><span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">3</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withColumnRenamed</span><span class="o">(</span><span class="s">"Location Description"</span><span class="o">,</span> <span class="s">"Location"</span><span class="o">)</span>

  <span class="nv">dateNeedColumn</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
  <span class="nv">dateNeedColumn</span><span class="o">.</span><span class="py">printSchema</span><span class="o">()</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="o">+-------------------+----+-----------+-------------------+-------+----------+----+</span>
<span class="o">|</span>              <span class="nc">Crime</span><span class="o">|</span><span class="nc">Year</span><span class="o">|</span>   <span class="nc">Location</span><span class="o">|</span>          <span class="nc">TimeStamp</span><span class="o">|</span>  <span class="nc">Month</span><span class="o">|</span>       <span class="nc">Day</span><span class="o">|</span><span class="nc">Hour</span><span class="o">|</span>
<span class="o">+-------------------+----+-----------+-------------------+-------+----------+----+</span>
<span class="o">|</span> <span class="nc">DECEPTIVE</span> <span class="nc">PRACTICE</span><span class="o">|</span><span class="mi">2001</span><span class="o">|</span>  <span class="nc">RESIDENCE</span><span class="o">|</span><span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">11</span><span class="k">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2001</span><span class="kt">-</span><span class="err">01</span><span class="kt">|</span><span class="err">2001</span><span class="kt">-</span><span class="err">01</span><span class="kt">-</span><span class="err">01</span><span class="kt">|</span>  <span class="err">11</span><span class="kt">|</span>
<span class="kt">|CRIM</span> <span class="kt">SEXUAL</span> <span class="kt">ASSAULT|</span><span class="err">2017</span><span class="kt">|</span>  <span class="kt">RESIDENCE|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">-</span><span class="err">08</span> <span class="err">03</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">-</span><span class="err">08</span><span class="kt">|</span>  <span class="err">03</span><span class="kt">|</span>
<span class="kt">|</span>           <span class="kt">BURGLARY|</span><span class="err">2017</span><span class="kt">|</span>      <span class="kt">OTHER|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">-</span><span class="err">28</span> <span class="err">02</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">-</span><span class="err">28</span><span class="kt">|</span>  <span class="err">02</span><span class="kt">|</span>
<span class="kt">|</span>              <span class="kt">THEFT|</span><span class="err">2017</span><span class="kt">|</span>  <span class="kt">RESIDENCE|</span><span class="err">2017</span><span class="kt">-</span><span class="err">09</span><span class="kt">-</span><span class="err">09</span> <span class="err">08</span><span class="kt">:</span><span class="err">17</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">09</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">09</span><span class="kt">-</span><span class="err">09</span><span class="kt">|</span>  <span class="err">08</span><span class="kt">|</span>
<span class="kt">|CRIM</span> <span class="kt">SEXUAL</span> <span class="kt">ASSAULT|</span><span class="err">2017</span><span class="kt">|HOTEL/MOTEL|</span><span class="err">2017</span><span class="kt">-</span><span class="err">08</span><span class="kt">-</span><span class="err">26</span> <span class="err">10</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">08</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">08</span><span class="kt">-</span><span class="err">26</span><span class="kt">|</span>  <span class="err">10</span><span class="kt">|</span>
<span class="kt">+-------------------+----+-----------+-------------------+-------+----------+----+</span>
<span class="kt">only</span> <span class="kt">showing</span> <span class="kt">top</span> <span class="err">5</span> <span class="kt">rows</span>

<span class="n">root</span>
 <span class="o">|--</span> <span class="nc">Crime</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Year</span><span class="k">:</span> <span class="kt">integer</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Location</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">TimeStamp</span><span class="k">:</span> <span class="kt">timestamp</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Month</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Day</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Hour</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="write-data-to-csv">Write Data to CSV<a href="#write-data-to-csv" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p><code class="language-plaintext highlighter-rouge">focusDate.scala</code> - 4</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  <span class="nv">dateNeedColumn</span><span class="o">.</span><span class="py">write</span><span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"header"</span><span class="o">,</span> <span class="kc">true</span><span class="o">).</span><span class="py">csv</span><span class="o">(</span><span class="nv">StaticTool</span><span class="o">.</span><span class="py">DATA_PATH</span> <span class="o">+</span> <span class="s">"dateDF.csv"</span><span class="o">)</span>
</pre></table></code></div></div><h3 id="crime-column">Crime Column<a href="#crime-column" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>提取完日期, 然后看看Crime列到底有多少种犯罪</p><p><code class="language-plaintext highlighter-rouge">focusCrime.scala</code> - 1</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">edu.zstu.mijazz.sparklearn1</span>

<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>

<span class="k">object</span> <span class="nc">focusCrime</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nv">spark</span> <span class="k">=</span> <span class="nv">SparkSession</span><span class="o">.</span><span class="py">builder</span><span class="o">.</span><span class="py">appName</span><span class="o">(</span><span class="s">"Data Analysis"</span><span class="o">).</span><span class="py">master</span><span class="o">(</span><span class="s">"local"</span><span class="o">).</span><span class="py">getOrCreate</span><span class="o">()</span>
  <span class="k">val</span> <span class="nv">sContext</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">sparkContext</span>
  <span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
    <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"header"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"inferSchema"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="py">csv</span><span class="o">(</span><span class="nv">StaticTool</span><span class="o">.</span><span class="py">DATE_DATA</span><span class="o">)</span>
<span class="c1">// 取回focusDate.scala中转储在hdfs中的数据</span>
  <span class="k">var</span> <span class="n">crimeColumnDataSet</span> <span class="k">=</span> <span class="nv">data</span><span class="o">.</span><span class="py">select</span><span class="o">(</span><span class="s">"Crime"</span><span class="o">).</span><span class="py">distinct</span><span class="o">()</span>
  <span class="nv">crimeColumnDataSet</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span>
  <span class="nf">println</span><span class="o">(</span><span class="nv">crimeColumnDataSet</span><span class="o">.</span><span class="py">count</span><span class="o">())</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre>+--------------------+
|               Crime|
+--------------------+
|OFFENSE INVOLVING...|
|CRIMINAL SEXUAL A...|
|            STALKING|
|PUBLIC PEACE VIOL...|
|           OBSCENITY|
|NON-CRIMINAL (SUB...|
|               ARSON|
|   DOMESTIC VIOLENCE|
|            GAMBLING|
|   CRIMINAL TRESPASS|
|             ASSAULT|
|      NON - CRIMINAL|
|LIQUOR LAW VIOLATION|
| MOTOR VEHICLE THEFT|
|               THEFT|
|             BATTERY|
|             ROBBERY|
|            HOMICIDE|
|           RITUALISM|
|    PUBLIC INDECENCY|
+--------------------+
only showing top 20 rows

36
</pre></table></code></div></div><p>总共36种不同的犯罪类型.</p><h4 id="crime-summaryspark-sql">Crime Summary(Spark SQL)<a href="#crime-summaryspark-sql" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><blockquote><p><code class="language-plaintext highlighter-rouge">DataFrame</code>内操作也行, 抱着入门框架的心态, 硬上<code class="language-plaintext highlighter-rouge">Spark SQL</code>吧</p></blockquote><p>只看总的犯罪统计, 抓个靠前的十宗罪吧</p><blockquote><p>这里留了点代码, 到时候往Hive里面写或者往MariaDB里面写, 换到pyspark画图方便些.</p></blockquote><p><code class="language-plaintext highlighter-rouge">focusCrime.scala</code> - 2</p><blockquote><p>注意的是: 要使用<code class="language-plaintext highlighter-rouge">spark sql</code>, <code class="language-plaintext highlighter-rouge">dataframe</code>或者<code class="language-plaintext highlighter-rouge">rdd</code>里面的东西要做成一个<code class="language-plaintext highlighter-rouge">View</code>, 就可以当成一个表做结构化查询了.</p></blockquote><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>  <span class="nv">data</span><span class="o">.</span><span class="py">createOrReplaceTempView</span><span class="o">(</span><span class="s">"t_CrimeDate"</span><span class="o">)</span>

  <span class="k">val</span> <span class="nv">eachCrimeSummary</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span>
    <span class="nf">sql</span><span class="o">(</span><span class="s">"select Crime, count(1) Occurs "</span> <span class="o">+</span>
      <span class="s">"from t_CrimeDate "</span> <span class="o">+</span>
      <span class="s">"group by Crime"</span><span class="o">)</span>
  <span class="c1">// For Writing in CSV or Hive DB in further PySpark Usage</span>
<span class="c1">//  eachCrimeSummary.write.option("header", true).csv("")</span>
  <span class="nv">eachCrimeSummary</span><span class="o">.</span><span class="py">orderBy</span><span class="o">(</span><span class="nf">desc</span><span class="o">(</span><span class="s">"Occurs"</span><span class="o">)).</span><span class="py">show</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="o">+-------------------+-------+</span>
<span class="o">|</span>              <span class="nc">Crime</span><span class="o">|</span> <span class="nc">Occurs</span><span class="o">|</span>
<span class="o">+-------------------+-------+</span>
<span class="o">|</span>              <span class="nc">THEFT</span><span class="o">|</span><span class="mi">1522618</span><span class="o">|</span>  <span class="k">#</span> <span class="n">偷窃</span>
<span class="o">|</span>            <span class="nc">BATTERY</span><span class="o">|</span><span class="mi">1321333</span><span class="o">|</span>  <span class="k">#</span> <span class="n">殴打</span>
<span class="o">|</span>    <span class="nc">CRIMINAL</span> <span class="nc">DAMAGE</span><span class="o">|</span> <span class="mi">821509</span><span class="o">|</span>  <span class="k">#</span> <span class="nf">破坏</span><span class="o">(</span><span class="n">刑事</span><span class="o">)</span>
<span class="o">|</span>          <span class="nc">NARCOTICS</span><span class="o">|</span> <span class="mi">733993</span><span class="o">|</span>  <span class="k">#</span> <span class="n">毒品犯罪</span>
<span class="o">|</span>            <span class="nc">ASSAULT</span><span class="o">|</span> <span class="mi">456288</span><span class="o">|</span>  <span class="k">#</span> <span class="n">攻击</span>
<span class="o">|</span>      <span class="nc">OTHER</span> <span class="nc">OFFENSE</span><span class="o">|</span> <span class="mi">447617</span><span class="o">|</span>  <span class="k">#</span> <span class="n">其他侵犯</span>
<span class="o">|</span>           <span class="nc">BURGLARY</span><span class="o">|</span> <span class="mi">406317</span><span class="o">|</span>  <span class="k">#</span> <span class="n">非法入侵</span>
<span class="o">|</span><span class="nc">MOTOR</span> <span class="nc">VEHICLE</span> <span class="nc">THEFT</span><span class="o">|</span> <span class="mi">331980</span><span class="o">|</span>  <span class="k">#</span> <span class="n">盗窃车辆</span>
<span class="o">|</span> <span class="nc">DECEPTIVE</span> <span class="nc">PRACTICE</span><span class="o">|</span> <span class="mi">297519</span><span class="o">|</span>  <span class="k">#</span> <span class="n">诈骗</span>
<span class="o">|</span>            <span class="nc">ROBBERY</span><span class="o">|</span> <span class="mi">270936</span><span class="o">|</span>  <span class="k">#</span> <span class="n">抢劫</span>
<span class="o">+-------------------+-------+</span>
</pre></table></code></div></div><h4 id="monthly-summaryspark-sql">Monthly Summary(Spark SQL)<a href="#monthly-summaryspark-sql" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><p>抓一下按月分类的, 看看数据是否有特征, 如果有特征就可以尝试后续做图.</p><p><code class="language-plaintext highlighter-rouge">focusCrime.scala</code> - 3</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>  <span class="k">val</span> <span class="nv">groupByMonth</span> <span class="k">=</span> <span class="n">spark</span>
    <span class="o">.</span><span class="py">sql</span><span class="o">(</span><span class="s">"select month(Month) NaturalMonth, count(1) CrimePerMonth "</span> <span class="o">+</span>
      <span class="s">"from t_CrimeDate "</span> <span class="o">+</span>
      <span class="s">"group by NaturalMonth"</span><span class="o">)</span>
  <span class="nv">groupByMonth</span><span class="o">.</span><span class="py">orderBy</span><span class="o">(</span><span class="nf">desc</span><span class="o">(</span><span class="s">"CrimePerMonth"</span><span class="o">)).</span><span class="py">show</span><span class="o">(</span><span class="mi">12</span><span class="o">)</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="o">+------------+-------------+</span>
<span class="o">|</span><span class="nc">NaturalMonth</span><span class="o">|</span><span class="nc">CrimePerMonth</span><span class="o">|</span>
<span class="o">+------------+-------------+</span>
<span class="o">|</span>           <span class="mi">7</span><span class="o">|</span>       <span class="mi">675041</span><span class="o">|</span>
<span class="o">|</span>           <span class="mi">8</span><span class="o">|</span>       <span class="mi">668824</span><span class="o">|</span>
<span class="o">|</span>           <span class="mi">5</span><span class="o">|</span>       <span class="mi">644421</span><span class="o">|</span>
<span class="o">|</span>           <span class="mi">6</span><span class="o">|</span>       <span class="mi">641529</span><span class="o">|</span>
<span class="o">|</span>           <span class="mi">9</span><span class="o">|</span>       <span class="mi">625696</span><span class="o">|</span>
<span class="o">|</span>          <span class="mi">10</span><span class="o">|</span>       <span class="mi">620504</span><span class="o">|</span>
<span class="o">|</span>           <span class="mi">3</span><span class="o">|</span>       <span class="mi">594688</span><span class="o">|</span>
<span class="o">|</span>           <span class="mi">4</span><span class="o">|</span>       <span class="mi">593116</span><span class="o">|</span>
<span class="o">|</span>           <span class="mi">1</span><span class="o">|</span>       <span class="mi">568404</span><span class="o">|</span>
<span class="o">|</span>          <span class="mi">11</span><span class="o">|</span>       <span class="mi">553769</span><span class="o">|</span>
<span class="o">|</span>          <span class="mi">12</span><span class="o">|</span>       <span class="mi">525734</span><span class="o">|</span>
<span class="o">|</span>           <span class="mi">2</span><span class="o">|</span>       <span class="mi">500547</span><span class="o">|</span>
<span class="o">+------------+-------------+</span>
</pre></table></code></div></div><p>这里就有很明显的趋势了, 年中部分的犯罪数量明显比年尾年头高.</p><h2 id="prepare-external-data">Prepare External Data<a href="#prepare-external-data" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><blockquote><p>天气数据见<a href="https://mijazzchan.github.io/posts/Weather-Data-Extraction/">Weather Data Extraction</a></p></blockquote><p>上次抓天气数据, 把2001年到今年, 每年的数据都抓下来了, 数据格式是<code class="language-plaintext highlighter-rouge">Date, High, Low</code></p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/pyProjects/.../weatherDataCsv   master ±✚  <span class="nb">ls
</span>2001.csv  2003.csv  2005.csv  2007.csv  2009.csv  2011.csv  2013.csv  2015.csv  2017.csv  2019.csv  
2002.csv  2004.csv  2006.csv  2008.csv  2010.csv  2012.csv  2014.csv  2016.csv  2018.csv  2020.csv
 mijazz@lenovo  ~/pyProjects/.../weatherDataCsv   master ±✚  <span class="nb">echo</span> <span class="s2">"Date,High,Low"</span> <span class="o">&gt;</span> ./temperature.full.csv
 mijazz@lenovo  ~/pyProjects/.../weatherDataCsv   master ±✚  <span class="nb">cat</span> ./<span class="k">*</span>.csv <span class="o">&gt;&gt;</span> ./temperature.full.csv
 ✘ mijazz@lenovo  ~/pyProjects/.../weatherDataCsv   master ±✚  <span class="nb">head</span> <span class="nt">-n</span> 3 ./temperature.full.csv 
Date,High,Low
2001-01-01,24,5
2001-01-02,19,5
 mijazz@lenovo  ~/pyProjects/.../weatherDataCsv   master ±✚  <span class="nb">tail</span> <span class="nt">-n</span> 3 ./temperature.full.csv 
2020-11-21,48,36
2020-11-22,47,41
2020-11-23,46,33
</pre></table></code></div></div><p>现在可以将其放到<code class="language-plaintext highlighter-rouge">hdfs</code>里, 然后尝试在<code class="language-plaintext highlighter-rouge">spark</code>里交叉补充好气温信息. 为可视化做准备.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre> mijazz@lenovo  ~/pyProjects/.../weatherDataCsv   master ±✚  hdfs dfs <span class="nt">-put</span> ./temperature.full.csv /user/mijazz/chicagoData/temperature.full.csv
 mijazz@lenovo  ~/pyProjects/.../weatherDataCsv   master ±✚  hdfs dfs <span class="nt">-ls</span> /user/mijazz/chicagoData
Found 3 items
drwxr-xr-x   - mijazz supergroup          0 2020-11-30 21:16 /user/mijazz/chicagoData/dateDF.csv
<span class="nt">-rw-r--r--</span>   1 mijazz supergroup 1701238602 2020-11-30 15:43 /user/mijazz/chicagoData/originCrimeData.csv
<span class="nt">-rw-r--r--</span>   1 mijazz supergroup     123272 2020-11-30 23:37 /user/mijazz/chicagoData/temperature.full.csv
</pre></table></code></div></div><h1 id="data-practicing-ep5">Data Practicing-EP5</h1><h2 id="get-weather-data">Get Weather Data<a href="#get-weather-data" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><code class="language-plaintext highlighter-rouge">StaticTool.java</code> - +(Add Row)</p><div class="language-java highlighter-rouge"><div class="code-header"> <span label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">+</span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">WEATHER_DATA</span> <span class="o">=</span> <span class="no">DATA_PATH</span> <span class="o">+</span> <span class="s">"temperature.full.csv"</span><span class="o">;</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">MergeWeather.scala</code> - 1</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">edu.zstu.mijazz.sparklearn1</span>

<span class="k">import</span> <span class="nn">org.apache.spark.sql.SparkSession</span>

<span class="k">object</span> <span class="nc">MergeWeather</span> <span class="k">extends</span> <span class="nc">App</span><span class="o">{</span>
  <span class="k">val</span> <span class="nv">spark</span> <span class="k">=</span> <span class="nv">SparkSession</span><span class="o">.</span><span class="py">builder</span><span class="o">.</span><span class="py">appName</span><span class="o">(</span><span class="s">"Data Analysis"</span><span class="o">).</span><span class="py">master</span><span class="o">(</span><span class="s">"local"</span><span class="o">).</span><span class="py">getOrCreate</span><span class="o">()</span>
  <span class="k">val</span> <span class="nv">sContext</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">sparkContext</span>
  <span class="k">val</span> <span class="nv">data</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">read</span>
    <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"header"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="py">option</span><span class="o">(</span><span class="s">"inferSchema"</span><span class="o">,</span> <span class="kc">false</span><span class="o">)</span>
    <span class="o">.</span><span class="py">csv</span><span class="o">(</span><span class="nv">StaticTool</span><span class="o">.</span><span class="py">WEATHER_DATA</span><span class="o">)</span>

  <span class="nv">data</span><span class="o">.</span><span class="py">printSchema</span><span class="o">()</span>
  <span class="nv">data</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>

<span class="o">}</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">root</span>
 <span class="o">|--</span> <span class="nc">Date</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">High</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Low</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 
<span class="o">+----------+----+---+</span>
<span class="o">|</span>      <span class="nc">Date</span><span class="o">|</span><span class="nc">High</span><span class="o">|</span><span class="nc">Low</span><span class="o">|</span>
<span class="o">+----------+----+---+</span>
<span class="o">|</span><span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">|</span>  <span class="mi">24</span><span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>  <span class="mi">19</span><span class="o">|</span>  <span class="mi">5</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="o">|</span>  <span class="mi">28</span><span class="o">|</span>  <span class="mi">7</span><span class="o">|</span>
<span class="o">+----------+----+---+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">3</span> <span class="n">rows</span>
</pre></table></code></div></div><blockquote><p><code class="language-plaintext highlighter-rouge">inferSchema==false</code> 因为在EP4<code class="language-plaintext highlighter-rouge">dataFrame</code>中有一列的<code class="language-plaintext highlighter-rouge">Day</code>的类型本就是<code class="language-plaintext highlighter-rouge">string</code>, 这里如果给了true, 就被内转成<code class="language-plaintext highlighter-rouge">timestamp</code>了, 对后续<code class="language-plaintext highlighter-rouge">sql</code>不算太方便.</p></blockquote><h2 id="merge-them-together">Merge them Together<a href="#merge-them-together" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>在EP4中我曾经通过<code class="language-plaintext highlighter-rouge">createOrReplaceTempView()</code>来创建了一张临时表, 但是这张表的生命周期是绑定在<code class="language-plaintext highlighter-rouge">SparkSession</code>上的, 现在我换了一个<code class="language-plaintext highlighter-rouge">Session</code>, 现在采用<code class="language-plaintext highlighter-rouge">createGlobalTempView()</code></p><p>详细见文章总结.</p><p><code class="language-plaintext highlighter-rouge">focusDate.scala</code> - (- means delete row, + means add row)</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="o">-</span>  <span class="nv">data</span><span class="o">.</span><span class="py">createOrReplaceTempView</span><span class="o">(</span><span class="s">"t_CrimeDate"</span><span class="o">)</span>
<span class="o">+</span>  <span class="nv">data</span><span class="o">.</span><span class="py">createOrReplaceGlobalTempView</span><span class="o">(</span><span class="s">"t_CrimeDate"</span><span class="o">)</span>

  <span class="k">val</span> <span class="nv">eachCrimeSummary</span> <span class="k">=</span> <span class="n">spark</span><span class="o">.</span>
    <span class="nf">sql</span><span class="o">(</span><span class="s">"select Crime, count(1) Occurs "</span> <span class="o">+</span>
<span class="o">-</span>      <span class="s">"from t_CrimeDate "</span> <span class="o">+</span> 
<span class="o">+</span>      <span class="s">"from global_temp.t_CrimeDate "</span> <span class="o">+</span>
      <span class="s">"group by Crime"</span><span class="o">)</span>

   <span class="k">val</span> <span class="nv">groupByMonth</span> <span class="k">=</span> <span class="n">spark</span>
    <span class="o">.</span><span class="py">sql</span><span class="o">(</span><span class="s">"select month(Month) NaturalMonth, count(1) CrimePerMonth "</span> <span class="o">+</span>
<span class="o">-</span>      <span class="s">"from t_CrimeDate "</span> <span class="o">+</span>   
<span class="o">+</span>      <span class="s">"from global_temp.t_CrimeDate "</span> <span class="o">+</span>
      <span class="s">"group by NaturalMonth"</span><span class="o">)</span>

</pre></table></code></div></div><p>通过前面生成了<code class="language-plaintext highlighter-rouge">globalTempView</code>之后, 就可以在另一个Session中来通过<code class="language-plaintext highlighter-rouge">global_temp.表名</code>来访问了.</p><p>这里采用spark sql来进行数据合并. 先把表做出来</p><p><code class="language-plaintext highlighter-rouge">MergeWeather.scala</code> - 2</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>  <span class="nv">data</span><span class="o">.</span><span class="py">createOrReplaceGlobalTempView</span><span class="o">(</span><span class="s">"t_weatherData"</span><span class="o">)</span>
</pre></table></code></div></div><p>先看一下两张表的<del>Schema关联</del>长什么样</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">// global_temp.t_CrimeDate</span>
<span class="n">root</span>
 <span class="o">|--</span> <span class="nc">Crime</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Year</span><span class="k">:</span> <span class="kt">integer</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">TimeStamp</span><span class="k">:</span> <span class="kt">timestamp</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Month</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Day</span><span class="k">:</span> <span class="kt">timestamp</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Hour</span><span class="k">:</span> <span class="kt">integer</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="c1">// global_temp.t_weatherData</span>
 <span class="n">root</span>
 <span class="o">|--</span> <span class="nc">Date</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">High</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Low</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">global_temp.t_CrimeDate.Day</code> &lt;==&gt; <code class="language-plaintext highlighter-rouge">global_temp.t_weatherData.Date</code></p><p><code class="language-plaintext highlighter-rouge">High, Low</code> Join上</p><p><code class="language-plaintext highlighter-rouge">MergeWeather.scala</code> - 3</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>  <span class="k">val</span> <span class="nv">mergedData</span> <span class="k">=</span> <span class="nv">spark</span><span class="o">.</span><span class="py">newSession</span><span class="o">()</span>
    <span class="o">.</span><span class="py">sql</span><span class="o">(</span><span class="s">"select C.Crime, C.Year, C.TimeStamp, C.Month, C.Day, W.High, W.Low C.Location "</span> <span class="o">+</span>
      <span class="s">"from global_temp.t_CrimeDate C, global_temp.t_weatherData W "</span> <span class="o">+</span>
      <span class="s">"where C.Day = W.Date"</span><span class="o">)</span>
  <span class="nv">mergedData</span><span class="o">.</span><span class="py">printSchema</span><span class="o">()</span>
  <span class="nv">mergedData</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">+-------------------+----+-------------------+-------+-------------------+----+---+---------+</span>
<span class="o">|</span>              <span class="nc">Crime</span><span class="o">|</span><span class="nc">Year</span><span class="o">|</span>          <span class="nc">TimeStamp</span><span class="o">|</span>  <span class="nc">Month</span><span class="o">|</span>                <span class="nc">Day</span><span class="o">|</span><span class="nc">High</span><span class="o">|</span><span class="nc">Low</span><span class="o">|</span> <span class="nc">Location</span><span class="o">|</span>
<span class="o">+-------------------+----+-------------------+-------+-------------------+----+---+---------+</span>
<span class="o">|</span> <span class="nc">DECEPTIVE</span> <span class="nc">PRACTICE</span><span class="o">|</span><span class="mi">2001</span><span class="o">|</span><span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">11</span><span class="k">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2001</span><span class="kt">-</span><span class="err">01</span><span class="kt">|</span><span class="err">2001</span><span class="kt">-</span><span class="err">01</span><span class="kt">-</span><span class="err">01</span> <span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span>  <span class="err">24</span><span class="kt">|</span>  <span class="err">5</span><span class="kt">|RESIDENCE|</span>
<span class="kt">|CRIM</span> <span class="kt">SEXUAL</span> <span class="kt">ASSAULT|</span><span class="err">2017</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">-</span><span class="err">08</span> <span class="err">03</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">-</span><span class="err">08</span> <span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span>  <span class="err">78</span><span class="kt">|</span> <span class="err">54</span><span class="kt">|RESIDENCE|</span>
<span class="kt">|</span>           <span class="kt">BURGLARY|</span><span class="err">2017</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">-</span><span class="err">28</span> <span class="err">02</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">-</span><span class="err">28</span> <span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span>  <span class="err">50</span><span class="kt">|</span> <span class="err">36</span><span class="kt">|</span>    <span class="kt">OTHER|</span>
<span class="kt">+-------------------+----+-------------------+-------+-------------------+----+---+---------+</span>
<span class="kt">only</span> <span class="kt">showing</span> <span class="kt">top</span> <span class="err">3</span> <span class="kt">rows</span>
</pre></table></code></div></div><p>所以现在每条犯罪记录都有了当天的天气信息了.</p><p>但是温标是华氏温标, <code class="language-plaintext highlighter-rouge">(F - 32) / 1.8 = C</code>. 用<code class="language-plaintext highlighter-rouge">DataFrame</code>来做就行, <del>虽然当时SQL导入的时候也可以这样做.</del></p><p><code class="language-plaintext highlighter-rouge">MergeWeather.scala</code> - 4</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>  <span class="n">mergedData</span> <span class="k">=</span> <span class="n">mergedData</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"HighC"</span><span class="o">,</span> <span class="nf">round</span><span class="o">(</span><span class="nf">col</span><span class="o">(</span><span class="s">"High"</span><span class="o">).</span><span class="py">cast</span><span class="o">(</span><span class="s">"float"</span><span class="o">).-(</span><span class="mf">32.0</span><span class="o">)./(</span><span class="mf">1.8</span><span class="o">),</span> <span class="mi">2</span><span class="o">))</span>
    <span class="o">.</span><span class="py">withColumn</span><span class="o">(</span><span class="s">"LowC"</span><span class="o">,</span> <span class="nf">round</span><span class="o">(</span><span class="nf">col</span><span class="o">(</span><span class="s">"Low"</span><span class="o">).</span><span class="py">cast</span><span class="o">(</span><span class="s">"float"</span><span class="o">).-(</span><span class="mf">32.0</span><span class="o">)./(</span><span class="mf">1.8</span><span class="o">),</span> <span class="mi">2</span><span class="o">))</span>
    <span class="o">.</span><span class="py">drop</span><span class="o">(</span><span class="s">"High"</span><span class="o">)</span>
    <span class="o">.</span><span class="py">drop</span><span class="o">(</span><span class="s">"Low"</span><span class="o">)</span>

  <span class="nv">mergedData</span><span class="o">.</span><span class="py">printSchema</span><span class="o">()</span>
  <span class="nv">mergedData</span><span class="o">.</span><span class="py">show</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">+-------------------+----+-------------------+-------+-------------------+---------+-----+-----+</span>
<span class="o">|</span>              <span class="nc">Crime</span><span class="o">|</span><span class="nc">Year</span><span class="o">|</span>          <span class="nc">TimeStamp</span><span class="o">|</span>  <span class="nc">Month</span><span class="o">|</span>                <span class="nc">Day</span><span class="o">|</span> <span class="nc">Location</span><span class="o">|</span><span class="nc">HighC</span><span class="o">|</span> <span class="nc">LowC</span><span class="o">|</span>
<span class="o">+-------------------+----+-------------------+-------+-------------------+---------+-----+-----+</span>
<span class="o">|</span> <span class="nc">DECEPTIVE</span> <span class="nc">PRACTICE</span><span class="o">|</span><span class="mi">2001</span><span class="o">|</span><span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">11</span><span class="k">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2001</span><span class="kt">-</span><span class="err">01</span><span class="kt">|</span><span class="err">2001</span><span class="kt">-</span><span class="err">01</span><span class="kt">-</span><span class="err">01</span> <span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|RESIDENCE|-</span><span class="err">4</span><span class="kt">.</span><span class="err">44</span><span class="kt">|-</span><span class="err">15</span><span class="kt">.</span><span class="err">0</span><span class="kt">|</span>
<span class="kt">|CRIM</span> <span class="kt">SEXUAL</span> <span class="kt">ASSAULT|</span><span class="err">2017</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">-</span><span class="err">08</span> <span class="err">03</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">10</span><span class="kt">-</span><span class="err">08</span> <span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|RESIDENCE|</span><span class="err">25</span><span class="kt">.</span><span class="err">56</span><span class="kt">|</span><span class="err">12</span><span class="kt">.</span><span class="err">22</span><span class="kt">|</span>
<span class="kt">|</span>           <span class="kt">BURGLARY|</span><span class="err">2017</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">-</span><span class="err">28</span> <span class="err">02</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">|</span><span class="err">2017</span><span class="kt">-</span><span class="err">03</span><span class="kt">-</span><span class="err">28</span> <span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">:</span><span class="err">00</span><span class="kt">|</span>    <span class="kt">OTHER|</span> <span class="err">10</span><span class="kt">.</span><span class="err">0</span><span class="kt">|</span> <span class="err">2</span><span class="kt">.</span><span class="err">22</span><span class="kt">|</span>
<span class="kt">+-------------------+----+-------------------+-------+-------------------+---------+-----+-----+</span>
<span class="kt">only</span> <span class="kt">showing</span> <span class="kt">top</span> <span class="err">3</span> <span class="kt">rows</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">MergeWeather.scala</code> - 5</p><blockquote><p>reparition(1)</p><p>Returns a new Dataset partitioned by the given partitioning expressions into <code class="language-plaintext highlighter-rouge">numPartitions</code>. The resulting Dataset is hash partitioned.</p></blockquote><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>  mergedData
    .repartition(1)
    .write
    .option("header", true)
    .csv(StaticTool.DATA_PATH + "forPySpark.csv")
</pre></table></code></div></div><h1 id="data-practicing-ep6">Data Practicing-EP6</h1><h2 id="introduce-pyspark">Introduce <code class="language-plaintext highlighter-rouge">pyspark</code><a href="#introduce-pyspark" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><code class="language-plaintext highlighter-rouge">Scala</code>和<code class="language-plaintext highlighter-rouge">Python</code>下对于<code class="language-plaintext highlighter-rouge">Spark</code>的操作还是有很多相似的地方的.</p><p>迁移到<code class="language-plaintext highlighter-rouge">PySpark</code>下, 因为<code class="language-plaintext highlighter-rouge">toPandas</code>和<code class="language-plaintext highlighter-rouge">collect() =&gt; List</code>这两个<code class="language-plaintext highlighter-rouge">pyspark</code>独有的特性, 使得可视化较<code class="language-plaintext highlighter-rouge">Scala</code>下方便.</p><p>不过要注意的是<code class="language-plaintext highlighter-rouge">Spark.DataFrame</code>和<code class="language-plaintext highlighter-rouge">Pandas.DataFrame</code>是两个完全不同的东西. 不过也很好理解, 鉴于这一次实验我是故意避开不使用Pandas的东西的.</p><p>假设有如下案例吧</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">random</span>
<span class="k">def</span> <span class="nf">rInt</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rStr</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">(</span><span class="s">'I Just Dont Want To Use DataFrame From Pandas'</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">rRow</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">rInt</span><span class="p">(),</span> <span class="n">rStr</span><span class="p">()]</span>

<span class="k">print</span><span class="p">(</span><span class="n">rRow</span><span class="p">())</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="mi">66</span><span class="p">,</span> <span class="s">'Pandas'</span><span class="p">]</span>
<span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="s">'Just'</span><span class="p">]</span>
</pre></table></code></div></div><p>每次调用<code class="language-plaintext highlighter-rouge">rRow()</code>都会返回一个List, <del>也就是sparkDataFrame中的一行数据.</del></p><p>通过<code class="language-plaintext highlighter-rouge">Scala</code>中可以知道, <code class="language-plaintext highlighter-rouge">SparkSession</code>控制每次的<code class="language-plaintext highlighter-rouge">Spark</code>会话, 而他也提供一个方法来创建会话.</p><p><code class="language-plaintext highlighter-rouge">parallelize()</code>用于<code class="language-plaintext highlighter-rouge">RDD</code>, <code class="language-plaintext highlighter-rouge">toDF()</code>会把<code class="language-plaintext highlighter-rouge">RDD</code>数据转成<code class="language-plaintext highlighter-rouge">Spark.DataFrame</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span>\
    <span class="p">.</span><span class="n">master</span><span class="p">(</span><span class="s">'local'</span><span class="p">).</span><span class="n">appName</span><span class="p">(</span><span class="s">'Learn Pyspark'</span><span class="p">).</span><span class="n">getOrCreate</span><span class="p">()</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span>
<span class="n">exampleSparkDataFrame</span> <span class="o">=</span> \
    <span class="n">sc</span><span class="p">.</span><span class="n">parallelize</span><span class="p">([</span><span class="n">rRow</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]).</span><span class="n">toDF</span><span class="p">((</span><span class="s">"Number"</span><span class="p">,</span> <span class="s">"Word"</span><span class="p">))</span>
<span class="n">exampleSparkDataFrame</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exampleSparkDataFrame</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="o">+------+---------+</span>
<span class="o">|</span><span class="n">Number</span><span class="o">|</span>     <span class="n">Word</span><span class="o">|</span>
<span class="o">+------+---------+</span>
<span class="o">|</span>    <span class="mi">60</span><span class="o">|</span><span class="n">DataFrame</span><span class="o">|</span>
<span class="o">|</span>    <span class="mi">43</span><span class="o">|</span>     <span class="n">Just</span><span class="o">|</span>
<span class="o">|</span>    <span class="mi">85</span><span class="o">|</span>     <span class="n">Want</span><span class="o">|</span>
<span class="o">|</span>    <span class="mi">64</span><span class="o">|</span>      <span class="n">Use</span><span class="o">|</span>
<span class="o">|</span>    <span class="mi">52</span><span class="o">|</span><span class="n">DataFrame</span><span class="o">|</span>
<span class="o">+------+---------+</span>

<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">pyspark</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">dataframe</span><span class="p">.</span><span class="n">DataFrame</span><span class="s">'&gt;
</span></pre></table></code></div></div><p>也可以很方便的通过<code class="language-plaintext highlighter-rouge">toPandas()</code>方式转换.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">examplePandasDataFrame</span> <span class="o">=</span> <span class="n">exampleSparkDataFrame</span><span class="p">.</span><span class="n">toPandas</span><span class="p">()</span>
<span class="n">examplePandasDataFrame</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">examplePandasDataFrame</span><span class="p">))</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">RangeIndex</span><span class="p">:</span> <span class="mi">5</span> <span class="n">entries</span><span class="p">,</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">4</span>
<span class="n">Data</span> <span class="n">columns</span> <span class="p">(</span><span class="n">total</span> <span class="mi">2</span> <span class="n">columns</span><span class="p">):</span>
 <span class="c1">#   Column  Non-Null Count  Dtype 
</span><span class="o">---</span>  <span class="o">------</span>  <span class="o">--------------</span>  <span class="o">-----</span> 
 <span class="mi">0</span>   <span class="n">Number</span>  <span class="mi">5</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>      <span class="n">int64</span> 
 <span class="mi">1</span>   <span class="n">Word</span>    <span class="mi">5</span> <span class="n">non</span><span class="o">-</span><span class="n">null</span>      <span class="nb">object</span>
<span class="n">dtypes</span><span class="p">:</span> <span class="n">int64</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="nb">object</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">memory</span> <span class="n">usage</span><span class="p">:</span> <span class="mf">208.0</span><span class="o">+</span> <span class="nb">bytes</span>
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">pandas</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">DataFrame</span><span class="s">'&gt;
</span></pre></table></code></div></div><p>当想取列时, <code class="language-plaintext highlighter-rouge">select()</code>选择列, <code class="language-plaintext highlighter-rouge">collect()</code>将其从远端的<code class="language-plaintext highlighter-rouge">Spark.DataFrame</code>拉回本地Python.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">print</span><span class="p">(</span><span class="n">exampleSparkDataFrame</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Number'</span><span class="p">).</span><span class="n">collect</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">exampleSparkDataFrame</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Word'</span><span class="p">).</span><span class="n">collect</span><span class="p">())</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="n">Number</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">Number</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">Number</span><span class="o">=</span><span class="mi">50</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">Number</span><span class="o">=</span><span class="mi">53</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">Number</span><span class="o">=</span><span class="mi">51</span><span class="p">)]</span>
<span class="p">[</span><span class="n">Row</span><span class="p">(</span><span class="n">Word</span><span class="o">=</span><span class="s">'Just'</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">Word</span><span class="o">=</span><span class="s">'To'</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">Word</span><span class="o">=</span><span class="s">'From'</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">Word</span><span class="o">=</span><span class="s">'Just'</span><span class="p">),</span> <span class="n">Row</span><span class="p">(</span><span class="n">Word</span><span class="o">=</span><span class="s">'Pandas'</span><span class="p">)]</span>
</pre></table></code></div></div><p>假如你需要拿<code class="language-plaintext highlighter-rouge">spark.DataFrame</code>中的列来画图, 如下几种方法都是一样的.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">eg</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">eg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">exampleSparkDataFrame</span><span class="p">.</span><span class="n">toPandas</span><span class="p">()[</span><span class="s">'Number'</span><span class="p">])</span>
<span class="n">eg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">exampleSparkDataFrame</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Number'</span><span class="p">).</span><span class="n">rdd</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>
<span class="n">eg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">exampleSparkDataFrame</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Number'</span><span class="p">).</span><span class="n">rdd</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]).</span><span class="n">collect</span><span class="p">()</span>
<span class="n">eg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">exampleSparkDataFrame</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Number'</span><span class="p">).</span><span class="n">collect</span><span class="p">()]</span>
<span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">eg</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">58</span><span class="p">]</span>
<span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">58</span><span class="p">]</span>
<span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">58</span><span class="p">]</span>
<span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">58</span><span class="p">]</span>
</pre></table></code></div></div><p>但是不推荐<code class="language-plaintext highlighter-rouge">eg[0]</code>对应的方法, 他是将整个<code class="language-plaintext highlighter-rouge">spark.DataFrame</code>从远端取回来, <del>如果使用的是集群, 或者数据量比较大的话</del>, 交给本地的python将其转为<code class="language-plaintext highlighter-rouge">Pandas.DataFrame</code>. 而其余几种, 而是交给spark处理过后, 单独剥离一列值进行返回.</p><p>rdd内实现的操作这里不详述.</p><h2 id="start-to-use-pyspark">Start to Use PySpark<a href="#start-to-use-pyspark" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>EP5中拿出了两批数据, 分别是<code class="language-plaintext highlighter-rouge">forPyspark.csv</code>和<code class="language-plaintext highlighter-rouge">temperature.full.csv</code></p><p>先做以下导入</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1"># -*- coding: utf-8 -*-
# @Author   : MijazzChan
# Python Version == 3.8.6
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="n">plot</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="nb">round</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.dpi'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'savefig.dpi'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">sns</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s">"figure.dpi"</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s">'savefig.dpi'</span><span class="p">:</span> <span class="mi">150</span><span class="p">})</span>

<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="s">"hdfs://localhost:9000/user/mijazz/chicagoData/"</span>
</pre></table></code></div></div><h2 id="something-irrelevant">Something irrelevant<a href="#something-irrelevant" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="n">master</span><span class="p">(</span><span class="s">'local'</span><span class="p">).</span><span class="n">appName</span><span class="p">(</span><span class="s">'Data Visualization'</span><span class="p">).</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="n">weatherData</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span>\
    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">'header'</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">'inferSchema'</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="s">'temperature.full.csv'</span><span class="p">)</span>
<span class="c1"># 转摄氏度
</span><span class="n">weatherData</span> <span class="o">=</span> <span class="n">weatherData</span>\
    <span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">'HighC'</span><span class="p">,</span> <span class="nb">round</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s">'High'</span><span class="p">).</span><span class="n">cast</span><span class="p">(</span><span class="s">'float'</span><span class="p">)</span> <span class="o">-</span> <span class="mf">32.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>\
    <span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">'LowC'</span><span class="p">,</span> <span class="nb">round</span><span class="p">((</span><span class="n">col</span><span class="p">(</span><span class="s">'Low'</span><span class="p">).</span><span class="n">cast</span><span class="p">(</span><span class="s">'float'</span><span class="p">)</span> <span class="o">-</span> <span class="mf">32.0</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>\
    <span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'High'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="s">'Low'</span><span class="p">)</span>

<span class="n">weatherData</span><span class="p">.</span><span class="n">createOrReplaceGlobalTempView</span><span class="p">(</span><span class="s">'v_Weather'</span><span class="p">)</span>
<span class="n">weatherData</span><span class="p">.</span><span class="n">describe</span><span class="p">().</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="o">+-------+----------+------------------+------------------+</span>
<span class="o">|</span><span class="n">summary</span><span class="o">|</span>      <span class="nc">Date</span><span class="o">|</span>             <span class="nc">HighC</span><span class="o">|</span>              <span class="nc">LowC</span><span class="o">|</span>
<span class="o">+-------+----------+------------------+------------------+</span>
<span class="o">|</span>  <span class="n">count</span><span class="o">|</span>      <span class="mi">7267</span><span class="o">|</span>              <span class="mi">7267</span><span class="o">|</span>              <span class="mi">7267</span><span class="o">|</span>
<span class="o">|</span>   <span class="n">mean</span><span class="o">|</span>      <span class="kc">null</span><span class="o">|</span><span class="mf">15.352508600522908</span><span class="o">|</span> <span class="mf">5.617067565708001</span><span class="o">|</span>
<span class="o">|</span> <span class="n">stddev</span><span class="o">|</span>      <span class="kc">null</span><span class="o">|</span><span class="mf">11.811098684239695</span><span class="o">|</span><span class="mf">10.534155955862133</span><span class="o">|</span>
<span class="o">|</span>    <span class="n">min</span><span class="o">|</span><span class="mi">2001</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="o">|</span>            <span class="o">-</span><span class="mf">23.33</span><span class="o">|</span>            <span class="o">-</span><span class="mf">30.56</span><span class="o">|</span>
<span class="o">|</span>    <span class="n">max</span><span class="o">|</span><span class="mi">2020</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span>             <span class="mf">39.44</span><span class="o">|</span>             <span class="mf">27.78</span><span class="o">|</span>
<span class="o">+-------+----------+------------------+------------------+</span>
</pre></table></code></div></div><p>拿到的数据集, <code class="language-plaintext highlighter-rouge">2001-01-01</code>年到<code class="language-plaintext highlighter-rouge">2020-11-23</code>总平均最高气温是<code class="language-plaintext highlighter-rouge">15.35</code>, 总平均最低气温是<code class="language-plaintext highlighter-rouge">5.62</code></p><h3 id="full-coverage">Full Coverage<a href="#full-coverage" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>对着整个天气数据集画个图呢?</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">xDays</span> <span class="o">=</span> <span class="n">weatherData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Date'</span><span class="p">).</span><span class="n">rdd</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>
<span class="n">yFullHigh</span> <span class="o">=</span> <span class="n">weatherData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'HighC'</span><span class="p">).</span><span class="n">rdd</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>
<span class="n">yFullLow</span> <span class="o">=</span> <span class="n">weatherData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'LowC'</span><span class="p">).</span><span class="n">rdd</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">xDays</span><span class="p">,</span> <span class="n">yFullHigh</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'High Temp Full Coverage in Chicago City, 2001-2020'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'Year'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'Temperature Celsius'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">xDays</span><span class="p">,</span> <span class="n">yFullLow</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'High Temp Full Coverage in Chicago City, 2001-2020'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'Year'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'Temperature Celsius'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/blog/20201201/plot1.png" alt="plot1" data-proofer-ignore></p><p>仿佛看不出来什么规律. <del>说好的全球变暖呢</del></p><h3 id="annual-summary">Annual Summary<a href="#annual-summary" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>那就按年平均画个图吧</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">annualData</span> <span class="o">=</span> \
    <span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">'SELECT year(Date) Annual, round(avg(HighC), 2) avgHigh, round(avg(LowC), 2) avgLow '</span> 
          <span class="s">'FROM global_temp.v_Weather '</span>
          <span class="s">'GROUP BY year(Date) '</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">asc</span><span class="p">(</span><span class="s">'Annual'</span><span class="p">))</span>
<span class="n">annualData</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="o">+------+-------+------+</span>
<span class="o">|</span><span class="nc">Annual</span><span class="o">|</span><span class="n">avgHigh</span><span class="o">|</span><span class="n">avgLow</span><span class="o">|</span>
<span class="o">+------+-------+------+</span>
<span class="o">|</span>  <span class="mi">2001</span><span class="o">|</span>  <span class="mf">15.39</span><span class="o">|</span>  <span class="mf">5.49</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2002</span><span class="o">|</span>  <span class="mf">15.37</span><span class="o">|</span>  <span class="mf">5.62</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2003</span><span class="o">|</span>  <span class="mf">14.63</span><span class="o">|</span>  <span class="mf">4.24</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2004</span><span class="o">|</span>  <span class="mf">14.98</span><span class="o">|</span>  <span class="mf">4.88</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2005</span><span class="o">|</span>  <span class="mf">15.87</span><span class="o">|</span>  <span class="mf">5.53</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2006</span><span class="o">|</span>   <span class="mf">15.9</span><span class="o">|</span>  <span class="mf">6.31</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2007</span><span class="o">|</span>   <span class="mf">15.6</span><span class="o">|</span>  <span class="mf">5.84</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2008</span><span class="o">|</span>  <span class="mf">14.25</span><span class="o">|</span>  <span class="mf">4.38</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2009</span><span class="o">|</span>  <span class="mf">14.05</span><span class="o">|</span>  <span class="mf">4.58</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2010</span><span class="o">|</span>  <span class="mf">15.66</span><span class="o">|</span>  <span class="mf">6.07</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2011</span><span class="o">|</span>  <span class="mf">15.04</span><span class="o">|</span>  <span class="mf">5.85</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2012</span><span class="o">|</span>  <span class="mf">17.73</span><span class="o">|</span>   <span class="mf">7.3</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2013</span><span class="o">|</span>  <span class="mf">14.43</span><span class="o">|</span>  <span class="mf">4.68</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2014</span><span class="o">|</span>  <span class="mf">13.66</span><span class="o">|</span>  <span class="mf">3.76</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2015</span><span class="o">|</span>  <span class="mf">15.02</span><span class="o">|</span>  <span class="mf">5.26</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2016</span><span class="o">|</span>  <span class="mf">15.97</span><span class="o">|</span>  <span class="mf">6.57</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2017</span><span class="o">|</span>  <span class="mf">16.27</span><span class="o">|</span>  <span class="mf">6.59</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2018</span><span class="o">|</span>  <span class="mf">15.12</span><span class="o">|</span>  <span class="mf">6.08</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2019</span><span class="o">|</span>  <span class="mf">14.44</span><span class="o">|</span>  <span class="mf">5.31</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2020</span><span class="o">|</span>  <span class="mf">17.91</span><span class="o">|</span>  <span class="mf">8.26</span><span class="o">|</span>
<span class="o">+------+-------+------+</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xYear</span> <span class="o">=</span> <span class="n">annualData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Annual'</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>
<span class="n">yAvgHigh</span> <span class="o">=</span> <span class="n">annualData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'avgHigh'</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>
<span class="n">yAvgLow</span> <span class="o">=</span> <span class="n">annualData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'avgLow'</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">xYear</span><span class="p">,</span> <span class="n">yAvgHigh</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Average High Temp in Chicago City'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'Year'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'Temperature Celsius'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">plot</span><span class="p">(</span><span class="n">xYear</span><span class="p">,</span> <span class="n">yAvgLow</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Average Low Temp in Chicago City'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'Year'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'Temperature Celsius'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/blog/20201201/plot2.png" alt="plot2" data-proofer-ignore></p><p>现在是能看出一些趋势了.</p><h2 id="plot-some-data">Plot Some Data<a href="#plot-some-data" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="some-acknowledgement">Some Acknowledgement<a href="#some-acknowledgement" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>该函数用于快速返回指定<code class="language-plaintext highlighter-rouge">spark.DataFrame</code>的列.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">column2List</span><span class="p">(</span><span class="n">dataFrame</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">dataFrame</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">column</span><span class="p">).</span><span class="n">rdd</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">).</span><span class="n">collect</span><span class="p">()</span>
</pre></table></code></div></div><p>而且拿dataFrame中的数据, 有各种方法, 此处就以犯罪数据排名作为例子.</p><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">root</span>
 <span class="o">|--</span> <span class="nc">Crime</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Year</span><span class="k">:</span> <span class="kt">integer</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">TimeStamp</span><span class="k">:</span> <span class="kt">timestamp</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Month</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Day</span><span class="k">:</span> <span class="kt">timestamp</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">Location</span><span class="k">:</span> <span class="kt">string</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">HighC</span><span class="k">:</span> <span class="kt">double</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
 <span class="o">|--</span> <span class="nc">LowC</span><span class="k">:</span> <span class="kt">double</span> <span class="o">(</span><span class="kt">nullable</span> <span class="o">=</span> <span class="kt">true</span><span class="o">)</span>
</pre></table></code></div></div><p>想摘取数据进行分析</p><h4 id="dataframe-approach">DataFrame Approach<a href="#dataframe-approach" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">crimeRankPlotData</span> <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Crime'</span><span class="p">)</span>\
                            <span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">'Crime'</span><span class="p">)</span>\
                            <span class="p">.</span><span class="n">count</span><span class="p">()</span>\
                            <span class="p">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s">'count'</span><span class="p">))</span>\
                            <span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="spark-sql-approach">Spark SQL Approach<a href="#spark-sql-approach" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">createGlobalTempView</span><span class="p">(</span><span class="s">'v_Crime'</span><span class="p">)</span>
<span class="n">crimeRankPlotData</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">'SELECT Crime, count(1) crimeCount '</span>
          <span class="s">'FROM global_temp.v_Crime '</span>
          <span class="s">'GROUP BY Crime '</span>
          <span class="s">'ORDER BY crimeCount DESC '</span>
          <span class="s">'LIMIT 15'</span><span class="p">)</span>
</pre></table></code></div></div><h4 id="rdd-appraoch">RDD Appraoch<a href="#rdd-appraoch" class="anchor"><i class="fas fa-hashtag"></i></a></h4></h4><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="n">countByKey</span><span class="p">().</span><span class="n">items</span><span class="p">()</span>  <span class="c1"># -&gt; dict
</span></pre></table></code></div></div><h3 id="crime-rank-plot">Crime Rank Plot<a href="#crime-rank-plot" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>记得在EP4中, 拿出来看过犯罪数据的排名. 做个前15的BarPlot</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="n">fullData</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span>\
    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">'header'</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">'inferSchema'</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">csv</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="s">'forPySpark.csv'</span><span class="p">).</span><span class="n">cache</span><span class="p">()</span>

<span class="n">crimeRankPlotData</span> <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Crime'</span><span class="p">)</span>\
                            <span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">'Crime'</span><span class="p">)</span>\
                            <span class="p">.</span><span class="n">count</span><span class="p">()</span>\
                            <span class="p">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s">'count'</span><span class="p">))</span>\
                            <span class="p">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">barh</span><span class="p">(</span><span class="n">column2List</span><span class="p">(</span><span class="n">crimeRankPlotData</span><span class="p">,</span> <span class="s">'Crime'</span><span class="p">),</span> <span class="n">column2List</span><span class="p">(</span><span class="n">crimeRankPlotData</span><span class="p">,</span> <span class="s">'count'</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Crime Count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Crime Type'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'TOP 15 Crime Count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/blog/20201201/plot3.png" alt="CrimeRank" data-proofer-ignore></p><h3 id="location-distribution-plot">Location Distribution Plot<a href="#location-distribution-plot" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">locationRankPlotData</span> <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">'Location'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="s">'Location'</span><span class="p">)</span>\
    <span class="p">.</span><span class="n">count</span><span class="p">()</span>\
    <span class="p">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="s">'count'</span><span class="p">))</span>
<span class="n">locationRankPlotData</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">tmp1</span> <span class="o">=</span> <span class="n">column2List</span><span class="p">(</span><span class="n">locationRankPlotData</span><span class="p">,</span> <span class="s">'Location'</span><span class="p">)</span>
<span class="n">tmp2</span> <span class="o">=</span> <span class="n">column2List</span><span class="p">(</span><span class="n">locationRankPlotData</span><span class="p">,</span> <span class="s">'count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">barh</span><span class="p">(</span><span class="n">tmp1</span><span class="p">[:</span><span class="mi">15</span><span class="p">],</span> <span class="n">tmp2</span><span class="p">[:</span><span class="mi">15</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Crime Count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Crime Type'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Location Distribution of Crimes'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/blog/20201201/plot4.png" alt="LocationDistribution" data-proofer-ignore></p><h3 id="annual-crime-count-plot">Annual Crime Count Plot<a href="#annual-crime-count-plot" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="n">crimePerYear</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">'SELECT year(C.TimeStamp) Annual, count(1) CrimePerYear '</span>
                         <span class="s">'FROM global_temp.v_Crime C '</span>
                         <span class="s">'GROUP BY year(C.TimeStamp) '</span>
                         <span class="s">'ORDER BY Annual ASC'</span><span class="p">)</span>
<span class="n">crimePerYear</span><span class="p">.</span><span class="n">show</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="c1"># 2020年的数据不齐, 去掉
</span><span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column2List</span><span class="p">(</span><span class="n">crimePerYear</span><span class="p">,</span> <span class="s">'Annual'</span><span class="p">)[:</span><span class="mi">19</span><span class="p">],</span> <span class="n">column2List</span><span class="p">(</span><span class="n">crimePerYear</span><span class="p">,</span> <span class="s">'CrimePerYear'</span><span class="p">)[:</span><span class="mi">19</span><span class="p">])</span>
<span class="n">plt</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">'Crime Count Per Year in Chicago City'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Year'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Crime Count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-scala highlighter-rouge"><div class="code-header"> <span label-text="Scala"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="o">+------+------------+</span>
<span class="o">|</span><span class="nc">Annual</span><span class="o">|</span><span class="nc">CrimePerYear</span><span class="o">|</span>
<span class="o">+------+------------+</span>
<span class="o">|</span>  <span class="mi">2001</span><span class="o">|</span>      <span class="mi">485783</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2002</span><span class="o">|</span>      <span class="mi">486764</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2003</span><span class="o">|</span>      <span class="mi">475962</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2004</span><span class="o">|</span>      <span class="mi">469395</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2005</span><span class="o">|</span>      <span class="mi">453735</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2006</span><span class="o">|</span>      <span class="mi">448138</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2007</span><span class="o">|</span>      <span class="mi">437041</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2008</span><span class="o">|</span>      <span class="mi">427099</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2009</span><span class="o">|</span>      <span class="mi">392770</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2010</span><span class="o">|</span>      <span class="mi">370395</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2011</span><span class="o">|</span>      <span class="mi">351878</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2012</span><span class="o">|</span>      <span class="mi">336137</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2013</span><span class="o">|</span>      <span class="mi">307299</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2014</span><span class="o">|</span>      <span class="mi">275545</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2015</span><span class="o">|</span>      <span class="mi">264449</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2016</span><span class="o">|</span>      <span class="mi">269443</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2017</span><span class="o">|</span>      <span class="mi">268675</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2018</span><span class="o">|</span>      <span class="mi">268222</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2019</span><span class="o">|</span>      <span class="mi">260318</span><span class="o">|</span>
<span class="o">|</span>  <span class="mi">2020</span><span class="o">|</span>      <span class="mi">163225</span><span class="o">|</span>
<span class="o">+------+------------+</span>
</pre></table></code></div></div><p><img data-src="/assets/img/blog/20201201/plot5.png" alt="plot5" data-proofer-ignore></p><h1 id="data-practicing-ep7">Data Practicing-EP7</h1><h2 id="visualization-in-python">Visualization in Python<a href="#visualization-in-python" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Pandas和notebook一起用, 在这个先被<code class="language-plaintext highlighter-rouge">Spark</code>处理过的几百万行的数据集上做可视化还是感觉方便些.</p><p>先做个依赖导入和数据清洗吧</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1"># -*- coding: utf-8 -*-
# Python Version == 3.8.6
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="n">sns</span>

<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.dpi'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">plt</span><span class="p">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'savefig.dpi'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">sns</span><span class="p">.</span><span class="nb">set</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s">"figure.dpi"</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s">'savefig.dpi'</span><span class="p">:</span> <span class="mi">150</span><span class="p">})</span>
<span class="kn">from</span> <span class="nn">jupyterthemes</span> <span class="kn">import</span> <span class="n">jtplot</span>

<span class="n">jtplot</span><span class="p">.</span><span class="n">style</span><span class="p">(</span><span class="n">theme</span><span class="o">=</span><span class="s">'monokai'</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s">'notebook'</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">fullData</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'~/devEnvs/chicagoCrimeData.csv'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'utf-8'</span><span class="p">)</span>

<span class="n">fullData</span><span class="p">.</span><span class="n">info</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre>/home/mijazz/devEnvs/pyvenv/lib/python3.8/site-packages/IPython/core/interactiveshell.py:3062: DtypeWarning: Columns (21) have mixed types.Specify dtype option on import or set low_memory=False.
  has_raised = await self.run_ast_nodes(code_ast.body, cell_name,


&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 7212273 entries, 0 to 7212272
Data columns (total 22 columns):
 #   Column                Dtype  
---  ------                -----  
 0   ID                    int64  
 1   Case Number           object 
 2   Date                  object 
 3   Block                 object 
 4   IUCR                  object 
 5   Primary Type          object 
 6   Description           object 
 7   Location Description  object 
 8   Arrest                bool   
 9   Domestic              bool   
 10  Beat                  int64  
 11  District              float64
 12  Ward                  float64
 13  Community Area        float64
 14  FBI Code              object 
 15  X Coordinate          float64
 16  Y Coordinate          float64
 17  Year                  int64  
 18  Updated On            object 
 19  Latitude              float64
 20  Longitude             float64
 21  Location              object 
dtypes: bool(2), float64(7), int64(3), object(10)
memory usage: 1.1+ GB
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></table></code></div></div><div><style scoped=""> .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th { vertical-align: top; } .dataframe thead th { text-align: right; }</style><table border="1" class="dataframe"><thead><tr style="text-align: right;"><th><th>ID<th>Case Number<th>Date<th>Block<th>IUCR<th>Primary Type<th>Description<th>Location Description<th>Arrest<th>Domestic<th>...<th>Ward<th>Community Area<th>FBI Code<th>X Coordinate<th>Y Coordinate<th>Year<th>Updated On<th>Latitude<th>Longitude<th>Location<tbody><tr><th>0<td>11034701<td>JA366925<td>01/01/2001 11:00:00 AM<td>016XX E 86TH PL<td>1153<td>DECEPTIVE PRACTICE<td>FINANCIAL IDENTITY THEFT OVER $ 300<td>RESIDENCE<td>False<td>False<td>...<td>8.0<td>45.0<td>11<td>NaN<td>NaN<td>2001<td>08/05/2017 03:50:08 PM<td>NaN<td>NaN<td>NaN<tr><th>1<td>11227287<td>JB147188<td>10/08/2017 03:00:00 AM<td>092XX S RACINE AVE<td>0281<td>CRIM SEXUAL ASSAULT<td>NON-AGGRAVATED<td>RESIDENCE<td>False<td>False<td>...<td>21.0<td>73.0<td>02<td>NaN<td>NaN<td>2017<td>02/11/2018 03:57:41 PM<td>NaN<td>NaN<td>NaN<tr><th>2<td>11227583<td>JB147595<td>03/28/2017 02:00:00 PM<td>026XX W 79TH ST<td>0620<td>BURGLARY<td>UNLAWFUL ENTRY<td>OTHER<td>False<td>False<td>...<td>18.0<td>70.0<td>05<td>NaN<td>NaN<td>2017<td>02/11/2018 03:57:41 PM<td>NaN<td>NaN<td>NaN<tr><th>3<td>11227293<td>JB147230<td>09/09/2017 08:17:00 PM<td>060XX S EBERHART AVE<td>0810<td>THEFT<td>OVER $500<td>RESIDENCE<td>False<td>False<td>...<td>20.0<td>42.0<td>06<td>NaN<td>NaN<td>2017<td>02/11/2018 03:57:41 PM<td>NaN<td>NaN<td>NaN<tr><th>4<td>11227634<td>JB147599<td>08/26/2017 10:00:00 AM<td>001XX W RANDOLPH ST<td>0281<td>CRIM SEXUAL ASSAULT<td>NON-AGGRAVATED<td>HOTEL/MOTEL<td>False<td>False<td>...<td>42.0<td>32.0<td>02<td>NaN<td>NaN<td>2017<td>02/11/2018 03:57:41 PM<td>NaN<td>NaN<td>NaN</table><p>5 rows × 22 columns</p></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s">'ID'</span><span class="p">,</span> <span class="s">'Case Number'</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">fullData</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">'Case Number'</span><span class="p">,</span> <span class="s">'IUCR'</span><span class="p">,</span><span class="s">'Updated On'</span><span class="p">,</span><span class="s">'Year'</span><span class="p">,</span> <span class="s">'FBI Code'</span><span class="p">,</span> <span class="s">'Beat'</span><span class="p">,</span><span class="s">'Ward'</span><span class="p">,</span><span class="s">'Community Area'</span><span class="p">,</span> <span class="s">'Location'</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">[</span><span class="s">'Location Description'</span><span class="p">].</span><span class="n">describe</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>count     7204883
unique        214
top        STREET
freq      1874164
Name: Location Description, dtype: object
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">[</span><span class="s">'Description'</span><span class="p">].</span><span class="n">describe</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>count     7212273
unique        532
top        SIMPLE
freq       849119
Name: Description, dtype: object
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">[</span><span class="s">'Primary Type'</span><span class="p">].</span><span class="n">describe</span><span class="p">()</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>count     7212273
unique         36
top         THEFT
freq      1522618
Name: Primary Type, dtype: object
</pre></table></code></div></div><p>可以看到这三列的其中两列, <code class="language-plaintext highlighter-rouge">Location Description</code>和<code class="language-plaintext highlighter-rouge">Description</code>有许多Unique值, 我们只取数量多的, 这里只取计数为前20的作为大类以做特征分析, 其他的归为杂类.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">locationDescription20Except</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Location Description'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">20</span><span class="p">:].</span><span class="n">index</span><span class="p">)</span>
<span class="c1"># 用loc把数据砍掉
</span><span class="n">fullData</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Location Description'</span><span class="p">].</span><span class="n">isin</span><span class="p">(</span><span class="n">locationDescription20Except</span><span class="p">),</span> <span class="n">fullData</span><span class="p">.</span><span class="n">columns</span><span class="o">==</span><span class="s">'Location Description'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'OTHER'</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">description20Except</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Description'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">20</span><span class="p">:].</span><span class="n">index</span><span class="p">)</span>
<span class="c1"># 用loc把数据砍掉
</span><span class="n">fullData</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Description'</span><span class="p">].</span><span class="n">isin</span><span class="p">(</span><span class="n">description20Except</span><span class="p">)</span> <span class="p">,</span> <span class="n">fullData</span><span class="p">.</span><span class="n">columns</span><span class="o">==</span><span class="s">'Description'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'OTHER'</span>
</pre></table></code></div></div><p>之前在<code class="language-plaintext highlighter-rouge">spark</code>中已经看到犯罪数量是36种, 并且数量从2001年到现在是逐年减少的. 但是只有每年的统计, 这里尝试作做<code class="language-plaintext highlighter-rouge">rolling sum</code>. 也就是每个取样点的横坐标对应一个日期, 纵坐标对应(当前日期-364天 ~ 当天)的犯罪数量和.</p><p>先把<code class="language-plaintext highlighter-rouge">Date</code>换成<code class="language-plaintext highlighter-rouge">Datetime</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">Date</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">fullData</span><span class="p">.</span><span class="n">Date</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">'%m/%d/%Y %I:%M:%S %p'</span><span class="p">)</span>
</pre></table></code></div></div><p>做<code class="language-plaintext highlighter-rouge">Resample</code>要有<code class="language-plaintext highlighter-rouge">Index</code>, 日期做了cast之后就行.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">fullData</span><span class="p">.</span><span class="n">Date</span><span class="p">)</span>
<span class="n">fullData</span><span class="p">.</span><span class="n">resample</span><span class="p">(</span><span class="s">'D'</span><span class="p">).</span><span class="n">size</span><span class="p">().</span><span class="n">rolling</span><span class="p">(</span><span class="mi">365</span><span class="p">).</span><span class="nb">sum</span><span class="p">().</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Days'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Crimes Count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/blog/20201203/output_14_0.png" alt="png" data-proofer-ignore> ​</p><p>可以看到<code class="language-plaintext highlighter-rouge">rolling sum</code>是在稳步减少的.</p><p>现在分犯罪种类<code class="language-plaintext highlighter-rouge">Primary Type</code>来作图.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">eachCrime</span> <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s">'ID'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">size</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s">'Primary Type'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">fullData</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">date</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">eachCrime</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">eachCrime</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">eachCrime</span><span class="p">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">365</span><span class="p">).</span><span class="nb">sum</span><span class="p">().</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">subplots</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></table></code></div></div><p>​ <br /> <img data-src="/assets/img/blog/20201203/output_16_0.png" alt="png" data-proofer-ignore> ​</p><p>这里看到了一些无用的数据, 有些犯罪种类甚至近20年来发生不超过千次, 砍掉犯罪数量非前20的犯罪种类, 只留下前20的种类再做一个<code class="language-plaintext highlighter-rouge">rolling sum</code>.</p><p>并且留意到<code class="language-plaintext highlighter-rouge">NON-CRIMINAL</code>和<code class="language-plaintext highlighter-rouge">NON - CRIMINAL</code>两个类重复, 砍掉. 并也将其变为<code class="language-plaintext highlighter-rouge">OTHER</code></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">crime20Except</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Primary Type'</span><span class="p">].</span><span class="n">value_counts</span><span class="p">()[</span><span class="mi">20</span><span class="p">:].</span><span class="n">index</span><span class="p">)</span>
<span class="n">fullData</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Primary Type'</span><span class="p">].</span><span class="n">isin</span><span class="p">(</span><span class="n">crime20Except</span><span class="p">),</span> <span class="n">fullData</span><span class="p">.</span><span class="n">columns</span><span class="o">==</span><span class="s">'Primary Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'OTHER'</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Primary Type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'NON-CRIMINAL'</span><span class="p">,</span> <span class="n">fullData</span><span class="p">.</span><span class="n">columns</span><span class="o">==</span><span class="s">'Primary Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'OTHER'</span>
<span class="n">fullData</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Primary Type'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'NON - CRIMINAL'</span><span class="p">,</span> <span class="n">fullData</span><span class="p">.</span><span class="n">columns</span><span class="o">==</span><span class="s">'Primary Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'OTHER'</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">eachCrime</span> <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="s">'ID'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">size</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s">'Primary Type'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">fullData</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">date</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">eachCrime</span><span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">eachCrime</span><span class="p">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">eachCrime</span><span class="p">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">365</span><span class="p">).</span><span class="nb">sum</span><span class="p">().</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="n">subplots</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></table></code></div></div><p><img data-src="/assets/img/blog/20201203/output_20_0.png" alt="png" data-proofer-ignore></p><p>数据处理完之后, 明显能够看出来, 基本的犯罪种类的数量的确是在下降的, 但是有两个<code class="language-plaintext highlighter-rouge">WEAPONS VIOLATION</code>和<code class="language-plaintext highlighter-rouge">INTERFERENCE WITH PUBLIC OFFICER</code>在逆势上涨.</p><h1 id="data-practicing-ep8">Data Practicing-EP8</h1><p>基于日期的话, 因为有index的缘故, 按日分类和按月分类都较为方便.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Mon'</span><span class="p">,</span><span class="s">'Tue'</span><span class="p">,</span><span class="s">'Wed'</span><span class="p">,</span> <span class="s">'Thur'</span><span class="p">,</span> <span class="s">'Fri'</span><span class="p">,</span> <span class="s">'Sat'</span><span class="p">,</span> <span class="s">'Sun'</span><span class="p">]</span>
<span class="n">fullData</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">fullData</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">dayofweek</span><span class="p">]).</span><span class="n">size</span><span class="p">().</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'barh'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="n">days</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Crime Counts'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p>​ <br /> <img data-src="/assets/img/blog/20201203/output_23_0.png" alt="png" data-proofer-ignore> ​</p><p>周五的贡献由为突出</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">fullData</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">month</span><span class="p">]).</span><span class="n">size</span><span class="p">().</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'barh'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Month'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Crime Counts'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p>​ <br /> <img data-src="/assets/img/blog/20201203/output_25_0.png" alt="png" data-proofer-ignore> ​</p><p>按月分类可以看到主要集中于夏季.</p><blockquote><p>在EP7里, <code class="language-plaintext highlighter-rouge">Location Description</code>已经被减少至20个, 排名靠后的被修改成<code class="language-plaintext highlighter-rouge">OTHERS</code>了</p></blockquote><p>对犯罪发生地点的归类.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">fullData</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">fullData</span><span class="p">[</span><span class="s">'Location Description'</span><span class="p">]]).</span><span class="n">size</span><span class="p">().</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">).</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">'barh'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">'Crime Location'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">'Crimes Count'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="/assets/img/blog/20201203/output_28_0.png" alt="png" data-proofer-ignore> ​</p><p>排除<code class="language-plaintext highlighter-rouge">OTHER</code>的话, 可以看到一下几个地点的犯罪发生率明显高于其它.</p><ul><li>街道<li>居民住宅区<li>公寓<li>人行道</ul><p>引入依赖包以及参考的缩放函数, 作多元的数据透视图以寻找数据联系.</p><p><a href="https://matplotlib.org/tutorials/colors/colormaps.html">Colormaps - matplotlib docs</a></p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">AgglomerativeClustering</span> <span class="k">as</span> <span class="n">AC</span>

<span class="k">def</span> <span class="nf">scale_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s">'''
    A utility function to scale numerical values (z-scale) to have a mean of zero
    and a unit variance.
    '''</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">df</span><span class="p">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">))</span> <span class="o">/</span> <span class="n">df</span><span class="p">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_hmap</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s">'seismic'</span><span class="p">,</span> <span class="n">xColumn</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">'''
    A function to plot heatmaps that show temporal patterns
    '''</span>
    <span class="k">if</span> <span class="n">ix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ix</span><span class="p">,:],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">fraction</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">df</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span>
    <span class="k">if</span><span class="p">(</span><span class="n">xColumn</span><span class="p">):</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s">'vertical'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">arange</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="k">def</span> <span class="nf">scale_and_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">ix</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>  <span class="n">xCol</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">'''
    A wrapper function to calculate the scaled values within each row of df and plot_hmap
    '''</span>
    <span class="n">df_marginal_scaled</span> <span class="o">=</span> <span class="n">scale_df</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">T</span><span class="p">).</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">ix</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="n">AC</span><span class="p">(</span><span class="mi">4</span><span class="p">).</span><span class="n">fit</span><span class="p">(</span><span class="n">df_marginal_scaled</span><span class="p">).</span><span class="n">labels_</span><span class="p">.</span><span class="n">argsort</span><span class="p">()</span> <span class="c1"># a trick to make better heatmaps
</span>    <span class="n">cap</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nb">min</span><span class="p">([</span><span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">df_marginal_scaled</span><span class="p">.</span><span class="n">to_numpy</span><span class="p">()),</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">min</span><span class="p">(</span><span class="n">df_marginal_scaled</span><span class="p">.</span><span class="n">to_numpy</span><span class="p">()))])</span>
    <span class="n">df_marginal_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">clip</span><span class="p">(</span><span class="n">df_marginal_scaled</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">cap</span><span class="p">,</span> <span class="n">cap</span><span class="p">)</span>
    <span class="n">plot_hmap</span><span class="p">(</span><span class="n">df_marginal_scaled</span><span class="p">,</span> <span class="n">ix</span><span class="o">=</span><span class="n">ix</span><span class="p">,</span> <span class="n">xColumn</span><span class="o">=</span><span class="n">xCol</span><span class="p">)</span>

</pre></table></code></div></div><ul><li>犯罪发生具体时间 与 位置<li>犯罪发生具体时间 与 犯罪类型<li>工作日/周末 与 位置<li>工作日/周末 与 犯罪类型<li>位置 与 犯罪类型</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">hour_by_location</span> <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s">'ID'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">'Location Description'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fullData</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">size</span><span class="p">).</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">hour_by_type</span>     <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s">'ID'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">'Primary Type'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fullData</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">size</span><span class="p">).</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dayofweek_by_location</span> <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s">'ID'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">'Location Description'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fullData</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">dayofweek</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">size</span><span class="p">).</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dayofweek_by_type</span> <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s">'ID'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">'Primary Type'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">fullData</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">dayofweek</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">size</span><span class="p">).</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">location_by_type</span>  <span class="o">=</span> <span class="n">fullData</span><span class="p">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s">'ID'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s">'Location Description'</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s">'Primary Type'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">size</span><span class="p">).</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">scale_and_plot</span><span class="p">(</span><span class="n">hour_by_location</span><span class="p">)</span>
</pre></table></code></div></div><p>​ <br /> <img data-src="/assets/img/blog/20201203/output_34_0.png" alt="png" data-proofer-ignore> ​</p><p>观察到有几块热区</p><ul><li><p>小巷(ALLEY), 人行道(SIDEWALK), 街道(STREET), 私家车(VEHICLE NON-COM..), 加油站(GAS STATION), 停车场/区(..PARKING LOT..)区域, 都于17点过后至午夜1点犯罪活跃.</p><li><p>停车场(PARKING LOT..),写字楼/商业区(COMMERCIAL/BUSINESS OFFICE),学校/公共类楼宇(SCHOOL, PUBLIC BUILDING)均于早上8点至下午3点犯罪活跃.</p><li><p>几类商店(.. STORE)均于整个中午和下午犯罪活跃.</p><li><p>居民住宅区和公寓型住宅均于 正午12点与午夜0点有热区</p></ul><p>凌晨2-6时均为冷区. 这些结论也基本与常识理解较为贴近.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">scale_and_plot</span><span class="p">(</span><span class="n">hour_by_type</span><span class="p">)</span>
</pre></table></code></div></div><p>​ <br /> <img data-src="/assets/img/blog/20201203/output_36_0.png" alt="png" data-proofer-ignore> ​</p><ul><li><p>人身侵犯, 性侵犯在中午过后几小时有热区</p><li><p>诈骗, 欺凌类型犯罪在上午和中午有热区</p></ul><p>其余犯罪均在18点过后, 即非工作时间存在热区.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">scale_and_plot</span><span class="p">(</span><span class="n">dayofweek_by_location</span><span class="p">)</span>
</pre></table></code></div></div><p>​ <br /> <img data-src="/assets/img/blog/20201203/output_38_0.png" alt="png" data-proofer-ignore> ​</p><p>工作日热区:</p><ul><li>停车场, 写字楼, 商店, 学校</ul><p>周五/周六热区:</p><ul><li>小巷, 人行道, 餐厅, 商业区停车场, 街道, 私家车, 住宅区, 住宅区走廊/门廊.</ul><p>周六周日热区:</p><ul><li>公寓, 油站, 住宅前/后院</ul><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">scale_and_plot</span><span class="p">(</span><span class="n">dayofweek_by_type</span><span class="p">)</span>
</pre></table></code></div></div><p>​ <br /> <img data-src="/assets/img/blog/20201203/output_40_0.png" alt="png" data-proofer-ignore> ​</p><p>工作日热区:</p><ul><li><p>人身侵犯</p><li><p>性骚扰</p><li><p>欺凌</p><li><p>非法入侵</p><li><p>卖淫</p></ul><p>节假日热区:</p><ul><li><p>妨碍公务</p><li><p>破坏(刑事破坏)</p><li><p>性侵犯</p><li><p>殴打/斗殴</p></ul><p>值得注意的是, 周五当天有几个明显的热区</p><ul><li><p>赌博</p><li><p>妨碍公共安全秩序</p><li><p>偷窃机动车</p><li><p>青少年犯罪</p><li><p>酒水买卖犯罪</p><li><p>枪械犯罪</p></ul><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">scale_and_plot</span><span class="p">(</span><span class="n">location_by_type</span><span class="p">,</span> <span class="n">xCol</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></table></code></div></div><p>​ <br /> <img data-src="/assets/img/blog/20201203/output_42_0.png" alt="png" data-proofer-ignore> ​</p><p>这个犯罪地点X犯罪类型的图, 每个交叉的热点都是某种特定的犯罪形式最可能发生的地点, 这里不做赘述.</p><p>只提两个点.</p><ul><li><p>斗殴和盗窃在所有地点都几乎是热区</p><li><p>加油站地点, 几乎无赌博, 性侵, 卖淫, 酒水买卖犯罪</p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/data/'>Data</a>, <a href='/categories/spark/'>Spark</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/data/" class="post-tag no-text-decoration" >data</a> <a href="/tags/hadoop/" class="post-tag no-text-decoration" >hadoop</a> <a href="/tags/spark/" class="post-tag no-text-decoration" >spark</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://telegram.me/share?text=Test Drive Spark/Hadoop using Chicago Crime Data - Mijazz Chan&url=https://mijazzchan.github.io/posts/Test-Drive-Spark-Hadoop-using-Chicago-Crime-Data/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://twitter.com/intent/tweet?text=Test Drive Spark/Hadoop using Chicago Crime Data - Mijazz Chan&url=https://mijazzchan.github.io/posts/Test-Drive-Spark-Hadoop-using-Chicago-Crime-Data/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://mijazzchan.github.io/posts/Test-Drive-Spark-Hadoop-using-Chicago-Crime-Data/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Test Drive Spark/Hadoop using Chicago Crime Data - Mijazz Chan&url=https://mijazzchan.github.io/posts/Test-Drive-Spark-Hadoop-using-Chicago-Crime-Data/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Documentation-for-cloudflare-ddns-edgeos/">Documentation for cloudflare-ddns-edgeos</a><li><a href="/posts/Utility-Functions-While-Leetcoding/">Some Utility Functions While Leetcoding</a><li><a href="/posts/Store-Multiple-Booleans-Using-Byte/">Store Multiple Booleans Using Single Variable</a><li><a href="/posts/Decision-Tree-Wine-Classification/">Decision Tree Wine Classification</a><li><a href="/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/">From Spring Boot Bean Validation to Python Wrapper</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/annotation/">annotation</a> <a class="post-tag" href="/tags/code/">code</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/pandas/">pandas</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Utility-Functions-While-Leetcoding/"><div class="card-body"> <em class="timeago small" date="2021-04-13 14:52:54 +0800" >Apr 13, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Some Utility Functions While Leetcoding</h3><div class="text-muted small"><p> Array Generator Secure.Random / ThreadLocalRandom 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 public static final ThreadLocalRandom randStream = ThreadLocalRandom.curren...</p></div></div></a></div><div class="card"> <a href="/posts/Store-Multiple-Booleans-Using-Byte/"><div class="card-body"> <em class="timeago small" date="2021-04-18 17:14:49 +0800" >Apr 18, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Store Multiple Booleans Using Single Variable</h3><div class="text-muted small"><p> Intro Inspired by a stackoverflow answer which is more than a decade old. StackOverflow-Answer1, StackOverflow - Answer2 @Jon Skeet there provide a way of measuring how much memory do byte, int a...</p></div></div></a></div><div class="card"> <a href="/posts/From-Spring-Boot-Bean-Validation-to-Python-Wrapper/"><div class="card-body"> <em class="timeago small" date="2021-06-03 12:59:54 +0800" >Jun 3, 2021</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>From Spring Boot Bean Validation to Python Wrapper</h3><div class="text-muted small"><p> Keywords in this post are as follows. Spring Boot Bean Validation JSR-303/349/380: Bean Validation Related Topic JSR Java Annotation Processing Custom Annotation Java Reflection API (ja...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Weather-Data-Extraction/" class="btn btn-outline-primary" prompt="Older"><p>Weather Data Extraction</p></a> <a href="/posts/Code-Scoping-in-Data-Practicing/" class="btn btn-outline-primary" prompt="Newer"><p>Code Scoping in Data Practicing</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/MijazzChan">Mijazz Chan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/data/">data</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/annotation/">annotation</a> <a class="post-tag" href="/tags/code/">code</a> <a class="post-tag" href="/tags/error/">error</a> <a class="post-tag" href="/tags/manjaro/">manjaro</a> <a class="post-tag" href="/tags/pandas/">pandas</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
